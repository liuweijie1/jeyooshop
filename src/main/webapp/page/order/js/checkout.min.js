"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],o=!0,n=!1,a=void 0;try{for(var s,r=e[Symbol.iterator]();!(o=(s=r.next()).done)&&(i.push(s.value),!t||i.length!==t);o=!0);}catch(e){n=!0,a=e}finally{try{!o&&r.return&&r.return()}finally{if(n)throw a}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function initApp(s,e){var t=e._yb.initCheckoutView(),i=e._yb.initAddressesView(),o=e._yb.initAddressView(),n=e._yb.initAddressAutoView(),a=_yb.initRecommendCartService();e._yb.initProductsService(),e._yb.initRecommendView({recommendCart:a}),e._yb.initRecommendAttrView({recommendCart:a});e.PospalModal=function(){this.showIndicator=function(){s.showLoading(_yb.t("common.processing"))},this.hideIndicator=function(){s.hideLoading()}};var r=Router({"/default":{once:function(){t.once()},before:function(){t.before()},on:function(){t.on()},after:function(){t.after()}},"/addresses":{once:function(){i.once()},before:function(){i.before()},on:function(){i.on()},after:function(){i.after()}},"/address/:id":{once:function(){o.once()},before:function(e){o.before(e)},on:function(e){o.on(e)},after:function(){o.after()}},"/addressMap":{once:function(e){n.once(e)},before:function(e){n.before(e)},on:function(e){n.on(e)},after:function(e){n.after(e)}}});if(r.configure({before:function(e,t,i){var o=this.getRoute(0);switch(console.log("allroutes",o),o){case"default":document.title=_yb.t("checkout.default_title");break;case"addresses":document.title=_yb.t("checkout.addresses_title");break;case"address":case"addressMap":document.title=_yb.t("checkout.address_title")}var n,a=s(".yb-page");(n=a.filter('[data-route="'+o+'"]')).length&&(a.hide(),n.show())}}),navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)){var c=!0;s("body").on("blur","input",function(){c=!0,setTimeout(function(){c&&(document.documentElement.scrollTop=document.body.scrollTop=0)},200)}),s("body").on("focus","input",function(){c=!1})}"zh"!=s("html").attr("lang")&&function(){s("body").addClass("langfor-en");var e=s(".langfor-en");s("#checkoutView .yb-checkout_ft #confirmPay",e).text(_yb.t("html.placeOrder")),s("#checkoutView .yb-checkout_ft .yb-foot-left",e).html('<span class="yb-foot-totalNum"><span class="totalCount"></span> item(s)</span>\n        Subtotal:<span class="yb-foot-price totalAmount"></span>'),s("#addressesView .yb-address-name",e).text(_yb.t("html.address1")),s("#addressesView #confirmAddrSel",e).text(_yb.t("html.confirm")),s(s("#addressView .yb-newAddres-hd .weui-cell__hd",e)[0]).text(_yb.t("html.address2")),s(s("#addressView .yb-newAddres-hd .weui-cell__hd",e)[1]).text(_yb.t("html.address3")),s(s("#addressView .yb-newAddres-hd .weui-cell__hd",e)[2]).text(_yb.t("html.address4")),s(s("#addressView .yb-newAddres-hd .weui-cell__hd",e)[3]).text(_yb.t("html.address5")),s(s("#addressView .yb-newAddres-bd .weui-cell__hd",e)[0]).text(_yb.t("html.address6")),s("#addressView #txtRecipient",e).attr("placeholder",_yb.t("html.address7")),s("#addressView #txtPhone",e).attr("placeholder",_yb.t("html.address8")),s("#addressView #txtDistrict",e).attr("placeholder",_yb.t("html.address9")),s("#addressView #txtAddress1",e).attr("placeholder",_yb.t("html.address10")),s("#checkoutView .actionsheetConfirm").text(_yb.t("modal.ok")),s("#addressView #btnDelete",e).text(_yb.t("html.address11")),s("#addressView #btnConfirm",e).text(_yb.t("html.confirm"))}(),_yb.isInWechat?_yb.services.checkout.loadWxConfig(function(e){!1!==e?(wx.config({debug:!1,appId:e.appId,url:e.url,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","getLocation","openLocation"]}),wx.ready(function(){_yb.wxConfigSuccess=!0,r.init("/default")}),wx.error(function(e){})):r.init("/default")}):r.init("/default")}!function(r,e){var t,i,o=function(e){this.initConfig(e),this.productsCache={},this.groupListCache=null,this.bargainListCache=null};o.prototype={initConfig:function(e){this.config=r.extend({},t,e)},search:function(e,t){var i=e.categoryUids||"",o=e.pageIdx||0,n=e.keywords||"",a=e.size||20,s={key:n,cUids:i,pageIdx:o,tags:e.tags||"",categories:e.categories||"",size:a,ignoreCart:!0,isSeries:void 0===e.isSeries||e.isSeries};1===e.orderType&&(s.orderType=1),e.isKillSon&&(s.includeSonCate=!1),!0===window.INCLUDEAPPTPRO?r.extend(s,{includeAppt:!0}):!1===window.INCLUDEAPPTPRO&&r.extend(s,{includeAppt:!1}),window.YB_ONLYSHOWTAG&&(s.alsoTags=window.YB_ONLYSHOWTAG),r.ajax({url:this.config.searchUrl,type:"POST",data:s,async:!0,global:!1,success:function(e){t&&t(e)}})},findAll:function(e,t){(e=e||{}).includeNew=!1;0<=["零售行业","母婴行业","服装鞋帽","批发行业"].indexOf(window.YB_INDUSTRY)&&(e.includeNew=!0);var i={isMultiCategory:e.isMultiCategory||!1,includeAttributes:e.includeAttributes||!1,includeAllProducts:e.includeAllProducts||!1,includeAllImages:e.includeAllImages||!1,isSeries:e.isSeries||!1,includeHotSale:e.includeHotSale||!0,includeCombo:e.includeCombo||!0,includeGroupSale:e.includeGroupSale||!0,includeBargainSale:e.includeBargainSale||!0,includeSeckillSale:e.includeSeckillSale||!0,includeNew:e.includeNew,size:e.size||50};window.YB_ONLYSHOWTAG&&(i.tags=window.YB_ONLYSHOWTAG),!0===window.INCLUDEAPPTPRO?r.extend(i,{includeAppt:!0}):!1===window.INCLUDEAPPTPRO&&r.extend(i,{includeAppt:!1}),r.ajax({url:this.config.findAllUrl,type:"POST",data:i,async:!0,global:!1,success:function(e){t&&t(e)}})},loadAll:function(e,t){var i={isMultiCategory:(e=e||{}).isMultiCategory||!1,includeAttributes:e.includeAttributes||!1,includeAllProducts:e.includeAllProducts||!1,includeAllImages:e.includeAllImages||!1,isSeries:e.isSeries||!0,includeHotSale:e.includeHotSale||!0,includeCombo:e.includeCombo||!0,includeGroupSale:e.includeGroupSale||!0,includeBargainSale:e.includeBargainSale||!0,includeSeckillSale:e.includeSeckillSale||!0,size:e.size||30,beginIndex:e.beginIndex||0,noCate:e.noCate||!1,includeProducts:e.includeProducts||!1,clearCache:e.clearCache||!1};r.ajax({url:this.config.loadAllUrl,type:"POST",data:i,async:!0,global:!1,success:function(e){t&&t(e)}})},findBannerProducts:function(e,t){r.ajax({url:this.config.bannerUrl,type:"POST",data:{bannerId:e},async:!0,global:!1,success:function(e){t&&t(e)}})},loadDetails:function(e,t){r.ajax({url:this.config.detailsUrl,type:"POST",data:{id:e,includeSales:!0===_yb.ISHOTSALECLICK},async:!0,success:function(e){t&&t(e)}})},loadSeriesProduct:function(e,t,i,o){var n={};0<e.indexOf("-")&&!0!==o?n.barcode=e:n.spu=e,i&&(n.pUids=i),r.ajax({url:this.config.barcodeUrl,type:"POST",data:n,async:!0,success:function(e){t&&t(e)}})},checkAttr:function(t,i,o){var n=this;n.productsCache[t]?i&&i(n.productsCache[t].hasAttr):(o||r.showLoading(_yb.t("productsService.pleaseWait")+"..."),r.ajax({url:this.config.checkAttrUrl,type:"POST",data:{id:t},async:!0,success:function(e){i&&(n.productsCache[t]={hasAttr:e.data},i(e.data))},complete:function(e){o||r.hideLoading()}}))},findAvailableCoupons:function(t){_yb.apiRequest(this.config.findCoupons,{},function(e){e?t&&t(e):t(!1)},function(e){t&&t(!1)})},loadCombo:function(e,t){_yb.apiRequest(this.config.loadComboAttr,{id:e},function(e){e?t&&t(e):t(!1)},function(e){t&&t(!1)})},getFreeCoupons:function(e,t){if("object"==(void 0===e?"undefined":_typeof(e)))e=e.join(",");_yb.apiRequest(this.config.getFreeCoupons,{cids:e},function(e){e?t&&t(e):t(!1)},function(e){t&&t(!1)})},loadGroupList:function(e,t){if(null==this.groupListCache){var i=this;r.showLoading(),r.ajax({url:this.config.groupListurl,type:"POST",data:e,async:!0,success:function(e){e.Success?(i.groupListCache=e,t&&t(e)):e.NeedLogin?r.alert(_yb.t("productsService.pleaseLogInAsMemberFirst"),function(){window.location.href="/m/accountv3"}):r.alert(e.Message)},complete:function(e){r.hideLoading()}})}else t(this.groupListCache)},loadBargainList:function(e,t){if(null==this.bargainListCache){var i=this;r.showLoading(),r.ajax({url:this.config.bargainListUrl,type:"POST",data:e,async:!0,success:function(e){e.Success||e.successed?(i.bargainListCache=e,t&&t(e)):200==e.errorCode?r.alert(_yb.t("productsService.pleaseLogInAsMemberFirst"),function(){window.location.href="/m/accountv3"}):r.alert(e.Message||e.message)},complete:function(e){r.hideLoading()}})}else t(this.bargainListCache)},loadProductComments:function(e,t,i){_yb.apiRequest(this.config.loadProductCommentsUrl,{productUid:e,pageIdx:t,size:20},function(e){e?i&&i(e):i(!1)},function(e){i&&i(!1)})},findLoginInfo:function(t){r.ajax({url:this.config.findLoginInfoUrl,type:"POST",async:!0,global:!1,success:function(e){t&&t(e)},complete:function(e){}})}},t={searchUrl:"/wxapi/product/ListMulti",detailsUrl:"/wxapi/product/Attributes",bannerUrl:"/wxapi/product/ListBanner",findAllUrl:"/wxapi/product/categories",loadAllUrl:"/wxapi/Product/LoadStoreCategoryProducts",barcodeUrl:"/wxapi/product/ListSeries",checkAttrUrl:"/wxapi/product/HasAttributesById",loadComboAttr:"/wxapi/product/combo",findCoupons:"/wxapi/Coupon/FindAvailableCoupons",getFreeCoupons:"/wxapi/MemberCouponProduct/SendFreeCoupons",groupListurl:"/wxapi/GroupPurchase/GrouppurchaseRules",bargainListUrl:"/wxapi/Bargain/LoadData",findLoginInfoUrl:"/wxapi/CustomerAccount/FindLoginInfo",loadProductCommentsUrl:"/wxapi/product/LoadProductComments"},_yb.initProductsService=function(e){return i=new o(e),_yb.services.products=i}}($,window),function(p,e){var t;function h(e){return!(void 0===e||!e||"y"===e||"n"===e)}var i=function(e){this.initConfig(e)};i.prototype={initConfig:function(e){var s=this;s.config=p.extend({},t,e),s.viewContainer=p(s.config.viewContainer),s.viewContent=p(".yb-recommendAttr-wrapper",s.config.viewContainer),s.overlay=p(".weui-popup__overlay",s.viewContainer),s.recommendCart=e.recommendCart,s.initData(),s.viewContainer.on("click",".select-item-attr",function(e){e.stopPropagation(),e.preventDefault();var t=p(this),i=String(t.data("uid"));s.selectAttr(i)?(s.solveConflict(i)&&p(".select-item-attr__on",t.parent()).removeClass("select-item-attr__on"),t.addClass("select-item-attr__on")):t.removeClass("select-item-attr__on"),s.processSelectionPrice(!0)}),s.overlay.on("click",function(){s.close()}),s.viewContainer.on("click",".select-item-series",function(e){var t=p(this),i=t.data("bid");if(!t.hasClass("select-item-series__off")&&(p(".select-item-series",s.viewContainer).removeClass("select-item-series__on"),t.addClass("select-item-series__on"),i)){for(var o={},n=0;n<s.products.length;n++){var a=s.products[n];if(i==a.barcode){o=a,s.productId=a.id;break}}s.products&&(s.attrMapping={}),s.selections=[],s.prevSelections=[],s.packages=[],s.specifications=o.attribute6,s.setInitData(o),s.processSelectionPrice(!0),s.updateAttibutes(o),p(".yb-product-title",s.viewContainer).text(o.productDisplayName),p(".yb-product-subTotal span",s.viewContainer).text(_yb.ft_c(o.sellPrice)),p(".info-img",this.viewContainer).prop("src",o.defaultproductimage.imagepath)}}),s.viewContainer.on("click",".recommendAttr-btn-left",function(e){s.viewContainer.trigger("recommendAttrClose")}),s.viewContainer.on("click",".recommendAttr-btn-right",function(e){e.stopPropagation(),e.preventDefault(),s.addSelToCart()})},cartEventHandler:function(e,t,i){switch(t){case"reload":this.updateAllItems();break;case"add":case"minus":case"update":this.updateItem(i)}},open:function(e,t){this.callback=t,this.before(),this.on(e)},initData:function(){this.products=[],this.currentProduct={},this.productId=0,this.productPrice=0,this.isOutOfStock=!1,this.attrMapping={},this.selections=[],this.prevSelections=[],this.packages=[],this.recommendAttr=[],this.cartInItem={},this.isEditItem=!1,this.specifications=""},setInitData:function(e){this.currentProduct=e,this.productId=e.id,this.productPrice=e.sellPrice,this.isOutOfStock=e.isOutOfStock,this.createMapping(e)},close:function(){this.after(),this.callback&&this.callback()},before:function(){console.log("attr before"),p.hideLoading(),this.initData(),this.viewContent.html(this.config.loadIndicator)},on:function(o){console.log("attr on",o);var n=this;(n.openType=o).noSeries?_yb.services.products.loadDetails(o.value,function(e){e.data&&(n.currentProduct=e.data,n.productId=e.data.id,n.productPrice=e.data.sellPrice,n.isOutOfStock=e.data.isOutOfStock,n.createMapping(e.data),n.renderResult(e.data),n.updateCartItem())}):_yb.services.products.loadSeriesProduct(o.value,function(e){n.products=n.sortBarcodeList(e.products);var t=n.products[0];if(o.spu)for(var i=0;i<n.products.length;i++)1==n.products[i].attribute7&&(t=n.products[i],n.specifications=t.attribute6,n.haveAttribute7=!0);n.currentProduct=t,n.renderBarcode(t)},o.pUids)},sortBarcodeList:function(e){for(var t=0;t<e.length;t++){var i=e[t];0<i.barcode.indexOf("-")&&(i.barcodeLater=i.barcode.split("-")[1])}return e[0].barcodeLater&&e.sort(function(e,t){return e.barcodeLater-t.barcodeLater}),e},updateCartItem:function(e){var t=this;if("{}"!=JSON.stringify(t.cartInItem)){var i=[];if(t.cartInItem.CartItemAttributes&&0<t.cartInItem.CartItemAttributes.length)for(var o in t.cartInItem.CartItemAttributes){var n=t.cartInItem.CartItemAttributes[o];i.push(n.txtproductAttributeUid)}if(e){for(var a=0;a<t.products.length;a++){var s=t.products[a];if(s.barcode==e){t.setInitData(s),t.renderBarcode(s);break}}p(".select-item-series",t.viewContainer).removeClass("select-item-series__on"),p('[data-bid="'+e+'"]').addClass("select-item-series__on")}t.selections=i,t.updateCartItemHasAttr()}},updateCartItemHasAttr:function(){var e=this.selections;for(var t in e)for(var i=e[t],o=0;o<p(".select-item-attr",this.viewContainer).length;o++){p(p(".select-item-attr",this.viewContainer)[o]).data("uid")==i&&p(p(".select-item-attr",this.viewContainer)[o]).addClass("select-item-attr__on")}},createMapping:function(e){for(var t in e.productattributepackages){var i=e.productattributepackages[t],o=e.productattributes[i.id];for(var n in o){var a=o[n];i.attrs=o,this.packages.push(i),this.attrMapping[a.uid]={attr:a,package:i}}}},selectAttr:function(e){if(this.isOutOfStock)return!1;if(!this.attrMapping[e])return!1;var t=this.selections.indexOf(e);return 0<=t?(this.selections.splice(t,1),!1):(this.selections.push(e),!0)},solveConflict:function(e){var t=this.attrMapping[e];if(!t)return!1;var i=t.package.packageType;if(1==i||3==i)return!1;var o=!1;for(var n in t.package.attrs){var a=t.package.attrs[n].uid;if(e!==a&&(o=this.removeSelection(a)))break}return o},findSelection:function(e){return this.selections.indexOf(e)},removeSelection:function(e){var t=this.findSelection(e);return 0<=t&&(this.selections.splice(t,1),!0)},processSelectionPrice:function(e){var t=this.productPrice;for(var i in this.selections){var o=this.attrMapping[this.selections[i]].attr,n=parseInt(o.attributeValue,10);0<n&&(t+=n)}var a=t*(parseInt(p(".yb-item-qty-one",this.viewContainer).text(),10)||1);return e&&(p(".info-price",this.viewContainer).text(_yb.ft_c(a.toFixed(2))),this.productPrice!=a?p(".yb-product-subTotal .del",this.viewContainer).hide():p(".yb-product-subTotal .del",this.viewContainer).show()),a},addSelToCart:function(e){if(this.productId){if(0<this.selections.length){if(!this.confirmSelections())return}else if(0==this.prevSelections.length&&!this.confirmSelections())return;var t=[];for(var i in this.selections){var o=this.selections[i];t.push({productAttributeUid:o,txtproductAttributeUid:o,attributeName:this.attrMapping[o].attr?this.attrMapping[o].attr.attributeName:"",attributeValue:this.attrMapping[o].attr?this.attrMapping[o].attr.attributeValue:""})}var n=this.currentProduct.stock,a=this.currentProduct.ignoreStock,s=this;this.recommendCart.addWithNum(this.productId,1,this.currentProduct.name,this.productPrice,t,!0,function(){s.viewContainer.trigger("recommendAttrClose",!0)},s.specifications,{stock:n,ignoreStock:a},s.currentProduct)}else p.alert(_yb.t("recommendAttrView.pleaseSelectItemVariables"))},confirmSelections:function(){var e=!1;for(var t in this.packages){var i=this.packages[t];if(1!=i.packageType&&2!=i.packageType){var o=!1;for(var n in i.attrs)if(0<=this.findSelection(i.attrs[n].uid)){o=!0;break}if(!o){e=!0,p.alert(_yb.t("recommendAttrView.pleaseSelectA")+"“"+i.packageName+"”"+_yb.t("recommendAttrView.options"));break}}}return!e},updateAttibutes:function(e){var t=[];for(var i in e.productattributepackages){var o=e.productattributepackages[i];for(var n in t.push('<div class="recommendAttr-select-item" data-attrtype="',o.packageType,'">'),t.push('<div class="select-item-tit">',o.packageName,""),1!=o.packageType&&2!=o.packageType&&t.push("<span>（"+_yb.t("recommendAttrView.required")+"）</span>"),t.push("</div>"),t.push('<div class="select-item-list">'),e.productattributes[o.id]){var a=e.productattributes[o.id][n],s=this.isAttrSelected(a);t.push('<div data-uid="',a.uid,'" class="select-item-attr',s?" select-item-attr__on":"",'" >'),t.push(a.attributeName),a.attributeValue&&0<a.attributeValue&&t.push("<i>",_yb.ft_c(a.attributeValue),"</i>"),t.push("</div>")}t.push("</div>"),t.push("</div>")}p(".yb-recommendAttr-select_attr",this.viewContainer).html(t.join(""))},neatenData:function(e){for(var t={},i={},o={},n=0;n<e.length;n++){var a=e[n];t[a.attribute1]=a.attribute1,i[a.attribute2]=a.attribute2,a.swiperIndex=n,o[a.attribute1+a.attribute2]=a}var s=[],r=[];for(var n in t)s.push(t[n]);for(var n in i)r.push(i[n]);return{colorArray:s,sizeArray:r,sizeProducts:o}},showClothes:function(e,t){if(!p(e).hasClass("product-selected")&&!p(e).hasClass("product-null")){if(p(e).hasClass("yb-series-color")){p(".yb-series-color").removeClass("product-selected"),p(".yb-series-size").removeClass("product-null");for(var i=p(".yb-series-size"),o=0;o<i.length;o++){var n=i[o],a=p(n).data("name"),s=p(e).data("name");this.products[s+""+a]||p(n).addClass("product-null")}}else if(p(e).hasClass("yb-series-size")){p(".yb-series-size").removeClass("product-selected"),p(".yb-series-color").removeClass("product-null");var r=p(".yb-series-color");for(o=0;o<r.length;o++){var c=r[o],d=p(c).data("name");s=p(e).data("name");this.products[d+""+s]||p(c).addClass("product-null")}}p(e).addClass("product-selected");var u=p(".yb-color-items").find(".product-selected").data("name")+""+p(".yb-size-items").find(".product-selected").data("name"),l=this.products[u];l&&(this.currentProduct=l,this.productId=l.id,p(".info-img",this.viewContainer).prop("src",l.defaultproductimage.imagepath),p(".info-name",this.viewContainer).text(l.productDisplayName),p(".info-desc",this.viewContainer).text(l.description),p(".info-price",this.viewContainer).text(_yb.ft_c(l.sellPrice)))}},renderBarcode:function(e){var t=[];t.push('<div class="yb-recommendAttr-product">'),this.renderProduct(e,t),t.push('<div class="yb-recommendAttr-select">'),this.renderSeries(this.products,t),this.renderAttibutes(e,t),t.push("</div>"),t.push("</div>"),t.push('<div class="yb-recommendAttr-footer">'),t.push('<div class="recommendAttr-btn recommendAttr-btn-left">'+_yb.t("recommendAttrView.back")+"</div>"),t.push('<div class="recommendAttr-btn recommendAttr-btn-right">'+_yb.t("recommendAttrView.confirm")+"</div>"),t.push("</div>");this.viewContent.html(t.join(""))},renderSeries:function(e,t){var i=this,o=e;if(this.openType.clothes){var n=this.neatenData(e);i.products=n.sizeProducts,t.push('<div class="yb-recommendAttr-select_series">'),t.push('<div class="recommendAttr-select-item">'),t.push('<div class="select-item-tit">'+_yb.t("recommendAttrView.color")+":"),t.push("</div>"),t.push('<div class="select-item-list yb-color-items">');for(var a=0;a<n.colorArray.length;a++){var s=n.colorArray[a];t.push(' <div class="select-item-clothes yb-series-color" data-name="'+s+'">'),t.push(s),t.push("</div>")}t.push("</div>"),t.push('<div class="select-item-tit">'+_yb.t("recommendAttrView.size")+":"),t.push("</div>"),t.push('<div class="select-item-list  yb-size-items">');for(a=0;a<n.sizeArray.length;a++){s=n.sizeArray[a];t.push(' <div class="select-item-clothes yb-series-size" data-name="'+s+'">'),t.push(s),t.push("</div>")}t.push("</div>"),t.push("</div>"),t.push("</div>"),i.viewContainer.on("click",".yb-series-color",function(e){var t=p(this).data("name");i.showClothes(this,t)}),i.viewContainer.on("click",".yb-series-size",function(e){var t=p(this).data("name");i.showClothes(this,t)})}if(this.openType.spu){t.push('<div class="yb-recommendAttr-select_series">'),t.push('<div class="recommendAttr-select-item">'),t.push('<div class="select-item-tit">规格:'),t.push("</div>"),t.push('<div class="select-item-list">');for(a=0;a<o.length;a++){var r="",c=null;1==(d=o[a]).attribute7&&this.haveAttribute7&&(c=d),this.haveAttribute7||0!=a||(c=d),0==d.stock&&0==d.ignoreStock&&!1===_yb.AllowStockBelowZero?r="select-item-series__off":c&&(r="select-item-series__on",i.specifications=d.attribute6,this.setInitData(d)),t.push('<div class="select-item-series ',r,'" data-bid="',d.barcode,'">'),t.push(d.attribute6),t.push("</div>")}t.push("</div>"),t.push("</div>"),t.push("</div>")}if(this.openType.normal){t.push('<div class="yb-recommendAttr-select_series">'),t.push('<div class="recommendAttr-select-item">'),t.push('<div class="select-item-tit">规格:'),t.push("</div>"),t.push('<div class="select-item-list">');for(a=0;a<o.length;a++){var d=o[a];0==a&&this.setInitData(d);var u="";0==a&&(u="select-item-series__on"),0==d.stock&&0==d.ignoreStock&&0==_yb.AllowStockBelowZero&&(u="select-item-series__off"),t.push('<div class="select-item-series ',u,'" data-bid="',d.barcode,'">');var l=[];h(d.attribute1)&&l.push(d.attribute1),h(d.attribute2)&&l.push(d.attribute2),h(d.attribute3)&&l.push(d.attribute3),h(d.attribute4)&&l.push(d.attribute4),0<l.length?t.push(l.join(",")):t.push(d.productDisplayName),t.push("</div>")}t.push("</div>"),t.push("</div>"),t.push("</div>")}},renderProduct:function(e,t){t.push('<div class="yb-recommendAttr-info">'),t.push('<img class="info-img" src="',e.defaultproductimage.imagepath,'" onerror="_yb.errProdImg(this)" alt="" />'),t.push('<div class="info-text">'),t.push('<div class="info-name">',e.productDisplayName,"</div>"),t.push('<div class="info-desc">',e.description,"</div>"),t.push('<div class="info-price">',_yb.ft_c(e.sellPrice),"</div>"),t.push("</div>"),t.push("</div>")},hideNumberByName:function(e){for(var t="",i=["0","1","2","3","4","5","6","7","8","9"],o=0;o<e.length;o++){var n=e[o];-1==i.indexOf(n)&&(t+=n)}return t},renderAttibutes:function(e,t,i){for(var o in t.push('<div class="yb-recommendAttr-select_attr">'),e.productattributepackages){var n=e.productattributepackages[o];for(var a in t.push('<div class="recommendAttr-select-item" data-attrtype="',n.packageType,'">'),t.push('<div class="select-item-tit">',n.packageName,":"),1!=n.packageType&&2!=n.packageType&&t.push("<span>（"+_yb.t("recommendAttrView.required")+"）</span>"),t.push("</div>"),t.push('<div class="select-item-list">'),e.productattributes[n.id]){var s=e.productattributes[n.id][a],r=this.isAttrSelected(s);t.push('<div data-uid="',s.uid,'" class="select-item-attr',r?" select-item-attr__on":"",'" >'),t.push(s.attributeName),s.attributeValue&&0<s.attributeValue&&t.push("<i>",_yb.ft_c(s.attributeValue),"</i>"),t.push("</div>")}t.push("</div>"),t.push("</div>")}t.push("</div>")},isAttrSelected:function(e){var t=!1,i=this.selections;if(i&&0<i.length)for(var o=0;o<i.length;o++)if(i[o]==e.uid){t=!0;break}return t},renderResult:function(e){var t=[];t.push('<div class="yb-recommendAttr-product">'),this.renderProduct(e,t),t.push('<div class="yb-recommendAttr-select">'),this.renderAttibutes(e,t),t.push("</div>"),t.push('<div class="yb-recommendAttr-footer">'),t.push('<div class="recommendAttr-btn recommendAttr-btn-left">'+_yb.t("recommendAttrView.back")+"</div>"),t.push('<div class="recommendAttr-btn recommendAttr-btn-right">'+_yb.t("recommendAttrView.confirm")+"</div>"),t.push("</div>"),t.push("</div>");this.viewContent.html(t.join(""))},after:function(){console.log("attr after"),this.viewContent.empty(),this.recommendCart.unsubscribe(this.cartEventHandler)},updateItem:function(e){},updateAllItems:function(){}},t={viewContainer:"#recommendView",loadIndicator:'<div class="weui-loadmore"><i class="weui-loading"></i> <span class="weui-loadmore__tips">'+_yb.t("common.loading")+"</span></div>"},e._yb.initRecommendAttrView=function(e){_yb.views.recommendAttr=new i(e)}}($,window),function(l,e){var t;var i=function(e){this.initConfig(e)};i.prototype={initConfig:function(e){var u=this;u.config=l.extend({},t,e),u.viewContainer=l(u.config.viewContainer),u.viewContent=l(".yb-recommend-wrapper",u.config.viewContainer),u.recommendCart=e.recommendCart,u.recommendCart.doLoad(),_yb.AllowStockBelowZero=!1,u.initData(),u.viewContainer.find(".yb-close-popup").on("click",function(e){l.closePopup(),u.close(),u.recommendCart.clear(function(){},!0),l(window).trigger("recommendDoSure",!1)}),u.viewContainer.on("click",".recommend-save",function(e){e.stopPropagation(),e.preventDefault(),u.recommendCart.syncCart(function(){l(window).trigger("recommendDoSure",!0),l.closePopup(),u.close()})}),u.viewContainer.on("click",".yb-cart-operate",function(e){e.stopPropagation(),e.preventDefault();var t=l(this),i=t.data("uid"),o=(t.data("barcode"),t.data("price")),n=t.data("stock"),a=t.data("ignore-stock"),s=(t.data("isseries"),t.data("opentype")),r=t.data("pn"),c=t.data("buybase"),d=l(e.target);if(d.hasClass("yb-cart-add")){if(d.hasClass("yb-isoutofstock-add"))return;if(s.noSeries)return void _yb.services.products.checkAttr(s.value,function(e){if("1"===e)u.tabToggle(s);else{var t=u.list.filter(function(e){return e.id==i});c?u.recommendCart.addWithNum(i,c,r,o,[],!0,function(){u.updateAllItems()},null,{stock:n,ignoreStock:a},t[0]):u.recommendCart.add(i,r,o,[],!0,function(){u.updateAllItems()},null,{stock:n,ignoreStock:a},t[0])}});if(s.clothes||s.normal||s.spu)return void u.tabToggle(s)}else d.hasClass("yb-cart-remove_home")&&u.removeRecommendCart(s)}),u.viewContainer.on("recommendAttrClose",function(e,t){u.tabToggle(),t&&u.updateAllItems()})},open:function(e,t){console.log("recommend open"),this.callback=t,this.before(),this.viewContainer.popup(),this.on(e),this.list=e},initData:function(){},close:function(){this.after(),this.callback&&this.callback()},before:function(){var t=this;_yb.services.checkout.getStoreData(function(e){e&&e.data?(t.storeData=e.data,_yb.AllowStockBelowZero=e.data.AllowStockBelowZero):t.storeData=!1}),l.hideLoading(),this.initData(),this.viewContent.html(this.config.loadIndicator)},on:function(e){this.renderResult(e)},renderResult:function(e){var t,i=this.renderProduct(e);t='<div class="yb-recommend-tit">'+_yb.t("recommendAttrView.youLike")+'</div>\n                    <div class="yb-recommend-text">'+_yb.t("recommendAttrView.moreProduct")+'</div>\n                    <div class="yb-recommend-list">\n                        '+i+'\n                    </div>\n                    <div class="yb-recommend-footer">\n                        <div class="recommend-save">'+_yb.t("recommendAttrView.select&order")+"</div>\n                    </div>",this.viewContent.html(t),this.updateAllItems()},renderProduct:function(e){for(var t="",i=0;i<e.length;i++){var o=e[i],n=o.id,a=o.defaultproductimage.imagepath.replace("_640x640","_200x200"),s=(o.name,o.baseQuantity?'data-buybase="'+o.baseQuantity+'"':""),r=o.sellPrice,c=_yb.ft_c(o.sellPrice),d=o.stock,u=o.barcode,l=this.getUniqueIdentify(o),p=o.ignoreStock,h="",m={};if(o.attribute8&&1==o.attribute8?(m.clothes=!0,m.value=o.attribute5):o.attribute5?(m.spu=!0,m.value=o.attribute5):o.barcode&&0<o.barcode.indexOf("-")?(window.YB_INDUSTRY&&"服装鞋帽"==window.YB_INDUSTRY?m.clothes=!0:m.normal=!0,m.value=o.barcode):(m.noSeries=!0,m.value=n),o.productSeries&&0<o.productSeries.length){m.pUids=o.uid;for(var v=0;v<o.productSeries.length;v++)m.pUids+="|"+o.productSeries[v].uid}else m.pUids=o.uid;var f=JSON.stringify(m),y=!!(o.barcode&&0<o.barcode.indexOf("-"))||"";o.isOutOfStock&&(h="yb-isoutofstock"),1==_yb.AllowStockBelowZero&&(h=""),o.productSeriesMinPrice&&o.productSeriesMaxPrice&&o.productSeriesMinPrice!=o.productSeriesMaxPrice&&(c=_yb.ft_c(0).charAt(0)+o.productSeriesMinPrice+"~"+o.productSeriesMaxPrice,!0),t+='<div class="yb-recommend-item '+h+'" p_fontbarcode="'+l+'">\n                            <div class="item_img">\n                                <img src="'+a+'" alt="" onerror="_yb.errProdImg(this)" />\n                                '+(h?'<div class="yb-outofstock"></div>':"")+'\n                            </div>\n                            <div class="item-info">\n                                <div class="item-name">'+o.name+'</div>\n                                <div class="item-desc">'+(o.description||"")+'</div>\n                                <div class="item-price">'+c+'</div>\n                                <div class="yb-cart-operate" data-uid="'+n+'" data-isseries="'+y+'" '+s+' data-price="'+r+'" data-pn="'+o.name+'" data-stock="'+d+'" data-barcode="'+u+'" data-ignore-stock="'+p+"\" data-opentype='"+f+'\'>\n                                    <span class="yb-cart-remove_home ">&nbsp;</span>\n                                    <input type="text" class="yb-item-qty" pattern="[0-9]*" maxlength="3" value="1" disabled="">\n                                    <span class="yb-cart-add '+h+'-add">&nbsp;</span>\n                                </div>\n                            </div>\n                        </div>'}return t},tabToggle:function(e){l(".yb-recommend-wrapper").hasClass("yb-recommend-wrapper_hide")?(l(".yb-recommend-wrapper").removeClass("yb-recommend-wrapper_hide"),l(".yb-recommendAttr-wrapper").removeClass("yb-recommendAttr-wrapper_show"),l(".yb-close-popup",this.viewContainer).show()):(_yb.views.recommendAttr.open(e),l(".yb-recommend-wrapper").addClass("yb-recommend-wrapper_hide"),l(".yb-recommendAttr-wrapper").addClass("yb-recommendAttr-wrapper_show"),l(".yb-close-popup",this.viewContainer).hide()),l.hideLoading()},after:function(){console.log("attr after"),this.viewContent.empty()},updateItem:function(e,t){var i=this.getUniqueIdentify(e),o=l("[p_fontbarcode='"+i+"']",this.viewContainer);0<o.length&&(l("input.yb-item-qty",o).val(e.ProductNum),e.ProductTotalNum&&e.ProductNum<e.ProductTotalNum&&l("input.yb-item-qty",o).val(e.ProductTotalNum),console.log(e.ProductTotalNum,e.ProductNum),0<e.ProductNum?o.removeClass("yb-item-empty").addClass("yb-recommend-item-has"):0==e.ProductTotalNum&&o.removeClass("yb-recommend-item-has").addClass("yb-item-empty"))},updateAllItems:function(){var o=this;console.log("updateAllItems");var e=o.recommendCart.find();console.log(e),0==e.length&&e&&l(".yb-recommend-item ","#recommendView").removeClass("yb-recommend-item-has");var n={};e.forEach(function(e){var t=e[0],i=o.getUniqueIdentify(t);n[i]?n[i]=n[i]+t.ProductNum:n[i]=t.ProductNum}),console.log(n);for(var t=0;t<e.length;t++){var i=e[t],a=i[0],s=o.getUniqueIdentify(a);void 0!==n[s]&&(i[0].ProductTotalNum=n[s]),null!=i[0].PackageSerial?o.updateItem(i[0],!0):o.updateItem(i[0])}},getUniqueIdentify:function(e){var t=e.Barcode||e.barcode,i=e.attribute8||e.Attribute8,o=e.attribute5||e.Attribute5;return i&&1==i?o:o||(t&&0<t.indexOf("-")?t.split("-")[0]:t)},removeRecommendCart:function(e){var i=this,t=this.recommendCart.findByFrontBarcode(e),o=this.renderRemoveItems(t),n='\n                    <div class="weui-dialog yb-recommendModal">\n                        <div class="recommendModal-tit">'+_yb.t("recommendView.pleaseDel")+'</div>\n                        <div class="recommendModal-list">\n                            '+o+'\n                        </div>\n                        <div class="recommendModal-footer">\n                            <div class="recommendModal-btn recommendModal-btn_left">'+_yb.t("modal.cancel")+'</div>\n                            <div class="recommendModal-btn recommendModal-btn-makesure">'+_yb.t("modal.ok")+"</div>\n                        </div>\n                    </div>";l.openModal(n),l(".recommendModal-btn_left").click(function(){l.closeModal()}),l(".recommendModal-btn-makesure").click(function(){var t=[];l("input:checked",".yb-recommendModal").each(function(e){t[e]=l(this).val()}),0<t.length?(t.forEach(function(e){i.recommendCart.minusByCartIdxWithNum(e,99999999,!1)}),i.updateAllItems(),l.toast(_yb.t("recommendView.delDone"),"text"),l.closeModal()):l.toast(_yb.t("recommendView.pleaseDel2"),"text")})},renderRemoveItems:function(e){for(var t="",i=0;i<e.length;i++){var o=[],n=e[i];if(0<n.ProductNum){if(n.CartItemAttributes&&0<n.CartItemAttributes.length)for(var a in this.makeManySizesAttrs(n,!1,!1)&&this.makeManySizesAttrs(n,!1,o),n.CartItemAttributes){var s=n.CartItemAttributes[a];o.push(" ["),o.push(s.attributeName),o.push("]")}else this.makeManySizesAttrs(n,!1,!1)&&this.makeManySizesAttrs(n,!0,o);t+='<div class="recommendModal-item">\n                                <input type="checkbox" id="'+n.cartIdx+'" value="'+n.cartIdx+'" name="">\n                                <label for="'+n.cartIdx+'">\n                                    <div class="recommendModal-item_point"></div>\n                                    <div class="recommendModal-item_name">'+n.ProductName+" "+o.join("")+'</div>\n                                    <div class="recommendModal-item_num"> x '+n.ProductNum+"</div>\n                                </label>\n                            </div>"}}return t},makeManySizesAttrs:function(e,t,i){var o="";if(e.Specifications)o=" ["+e.Specifications+"]";else{var n=[];n.push(e.Attribute1||e.attribute1),n.push(e.Attribute2||e.attribute2),n.push(e.Attribute3||e.attribute3),n.push(e.Attribute4||e.attribute4);for(var a=0;a<n.length;a++){var s=n[a];void 0!==s&&s&&"y"!==s&&"n"!==s&&(o+=" ["+s+"]")}}return""!=o&&(void 0===i||!1===i||void i.push(o))}},t={viewContainer:"#recommendView",loadIndicator:'<div class="weui-loadmore"><i class="weui-loading"></i> <span class="weui-loadmore__tips">'+_yb.t("common.loading")+"</span></div>"},e._yb.initRecommendView=function(e){_yb.views.selectRecommend=new i(e)}}($,window),function(y,e){var i,t=function(e){this.initConfig(e)};t.prototype={initConfig:function(e){var t=this;t.config=y.extend({},i,e),t.items=[],t.cacheItems=[],t.editItems=[],t.eventHandlers=[],t.needSync=!0,t.loaded=!1},loadOnce:function(e){console.log("load once",this.loaded),this.loaded?(this.notify("reload"),e&&e()):this.doLoad(e)},load:function(e){console.log("load",this.needSync),this.needSync?this.doLoad(e):(this.notify("reload"),e&&e())},doLoad:function(e){var t=this;t.loaded=!0,this.syncCart(function(){t.notify("reload"),e&&e()})},subscribe:function(e){this.eventHandlers.indexOf(e)<0&&this.eventHandlers.push(e)},unsubscribe:function(e){var t=this.eventHandlers.indexOf(e);0<=t&&this.eventHandlers.splice(t,1)},notify:function(t,i,o){this.eventHandlers.forEach(function(e){e(this,t,i,o)},this)},_add:function(e,t,i,o,n){var a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:{},s=arguments[6];o||(o=[]);var r={ProductId:e,ProductName:t,SellPrice:i,ProductNum:1,Specifications:n,CartItemAttributes:o,Stock:a.stock||0,IgnoreStock:a.ignoreStock||!1};return r=Object.assign(s,r),this.items.push(r),this.needSync=!0,r},_updateNum:function(e,t){e&&e.ProductNum!=t&&(e.ProductNum=t,this.needSync=!0)},_remove:function(e){for(var t=this.items.length;t--;)this.items[t]===e&&(this.items.splice(t,1),this.needSync=!0)},removeById:function(e,t,i){var o=this.findItemsById(e);for(var n in o){var a=o[n];0<a.ProductNum&&(a.ProductNum=0,this.needSync=!0)}t||this.syncCart(i,!1)},getEditItems:function(){return this.cacheItems=this.editItems,this.notify("editCombo",this.cacheItems),this.editItems},chooseData:function(e){for(var t=this.appendCombos(),i=0;i<t.length;i++){var o=t[i];null!=o[0].PackageSerial&&o[0].PackageSerial==e&&0<o[0].PackageUnitNum&&(this.editItems=o)}},appendCombos:function(){for(var e=[],t=[],i=0;i<this.items.length;i++)this.items[i].cartIdx=i,null!=this.items[i].PackageSerial&&void 0!==this.items[i+1]&&this.items[i].PackageSerial==this.items[i+1].PackageSerial?t.push(this.items[i]):(t.push(this.items[i]),e.push(t.slice(0)),t.length=0);return e},find:function(e,t){if(!e)return this.appendCombos();for(var i=0;i<this.items.length;i++){this.items[i].cartIdx=i;var o=this.items[i];if(null!=o.PackageSerial)n=!1;else if(o.ProductId==e){var n=!0;if(t&&0<t.length)if(o.CartItemAttributes&&o.CartItemAttributes.length==t.length){for(var a=0;a<t.length;a++)if(t[a].txtproductAttributeUid!=o.CartItemAttributes[a].txtproductAttributeUid){n=!1;break}}else n=!1;else n=!(o.CartItemAttributes&&0<o.CartItemAttributes.length);if(n)return o}}return null},findItemsById:function(e){for(var t=[],i=0;i<this.items.length;i++){var o=this.items[i];null==o.PackageSerial&&o.ProductId==e&&o.ProductNum&&0<o.ProductNum&&t.push(o)}return t},add:function(e,t,i,o,n,a,s){var r=7<arguments.length&&void 0!==arguments[7]?arguments[7]:{},c=arguments[8],d=this.find(e,o),u=null!==d?d.ProductNum:0;if("rejected"!==this.resolveStock({source:{ProductNum:u,Stock:r.stock,IgnoreStock:r.ignoreStock}}).status)return d?this._updateNum(d,d.ProductNum+1):d=this._add(e,t,i,o,s,r={},c),n?a&&a():this.syncCart(a,!1),this.notify("add",d),d;r&&"function"==typeof r.rejectCb&&r.rejectCb()},addWithNum:function(e,t,i,o,n,a,s,r){var c=8<arguments.length&&void 0!==arguments[8]?arguments[8]:{},d=arguments[9],u=this.find(e,n),l=null!==u?u.ProductNum+t:t;if("rejected"!==this.resolveStock({source:{ProductNum:l-1,Stock:c.stock,IgnoreStock:c.ignoreStock}}).status)return u?this._updateNum(u,u.ProductNum+t):(u=this._add(e,i,o,n,r,c,d),this._updateNum(u,t)),a?s&&s():this.syncCart(s,!1),this.notify("add",u),u},minus:function(e,t,i){var o=this.find(e);return o&&0<o.ProductNum&&(this._updateNum(o,o.ProductNum-1),t||this.syncCart(i,!1),this.notify("minus",o)),o},minusWithNum:function(e,t,i,o){var n=this.find(e);return n&&0<n.ProductNum&&(n.ProductNum>t?this._updateNum(n,n.ProductNum-t):this._updateNum(n,0),i||this.syncCart(o,!1),this.notify("minus",n)),n},update:function(e,t,i,o,n,a,s,r){var c=8<arguments.length&&void 0!==arguments[8]?arguments[8]:{},d=this.find(e);d||(d=this._add(e,i,o,n,r,c)),this._updateNum(d,t),a||this.syncCart(s,!1),this.notify("update",d)},clear:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];this.items=[],this.needSync=!0,this.syncCart(e,t),this.notify("reload")},findByFrontBarcode:function(a){var s=a.value,r=0<s.indexOf("-")?s.split("-")[0]:s,c=[];return this.items.forEach(function(e){var t=e.Barcode||e.barcode,i=0<t.indexOf("-")?t.split("-")[0]:t,o=e.attribute5||e.Attribute5,n=e.attribute8||e.Attribute8;a.clothes&&(n&&1==n&&s==o?c.push(e):r==i&&c.push(e)),a.spu&&s==o&&c.push(e),a.normal&&r==i&&c.push(e),a.noSeries&&s==e.ProductId&&c.push(e)}),c},findByIdx:function(e){return this.items[e]},findItemsByCartIdx:function(e){var t,i=this.appendCombos();e:for(var o=0;o<i.length;o++)for(var n=i[o],a=0;a<n.length;a++){var s=n[a];if(s.cartIdx==e){t=s;break e}}return t},addByCartIdx:function(e,t,i){var o=this.findItemsByCartIdx(e);if("rejected"!==this.resolveStock({product:o}).status)return o&&null==o.PackageSerial&&(this._updateNum(o,o.ProductNum+1),t&&this.syncCart(i,!1),this.notify("add",o,e)),o},addByCartIdxWithNum:function(e,t,i,o){var n=this.findItemsByCartIdx(e);return n&&null==n.PackageSerial&&(this._updateNum(n,n.PackageUnitNum+t),i&&this.syncCart(o,!1),this.notify("add",n,e)),n},minusByCartIdx:function(e,t,i){var o=this.findItemsByCartIdx(e);return o&&null==o.PackageSerial&&0<o.ProductNum&&(this._updateNum(o,o.ProductNum-1),t&&this.syncCart(i,!1),this.notify("minus",o,e)),o},minusByCartIdxWithNum:function(e,t,i,o){var n=this.findItemsByCartIdx(e);return n&&null==n.PackageSerial&&0<n.ProductNum&&(n.ProductNum>t?this._updateNum(n,n.ProductNum-t):this._updateNum(n,0),i&&this.syncCart(o,!1),this.notify("minus",n,e)),n},updateByCartIdx:function(e,t,i,o,n){var a=this.findItemsByCartIdx(e),s=this.resolveStock({product:a,source:{ProductNum:t}}),r=s.status,c=s.stock;if("rejected"!==r)return a&&(this._updateNum(a,t),i&&this.syncCart(o,!1),this.notify("update",a,e)),a;"function"==typeof n&&n({stock:c})},syncCart:function(i,e){var o=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],n=this;if(n.needSync){void 0===e&&(e=!0);var t=JSON.stringify(this.items);n.needSync=!1,_yb.apiRequest(n.config.syncUrl,{isMerge:e,shopcartItems:t},function(e){if(e&&e.Success){n.items=y.parseJSON(e.Result),n.message=e.Message;var t=e.InvalidBasketItems||[];n.message&&o&&n.alertInvalidMessage(t),i&&i(n.items,n.message,t)}else n.needSync=!0,i&&i(!1)},function(){n.needSync=!0,i&&i(!1)})}else i&&i(n.items)},goto:function(){y.showLoading(_yb.t("toast.dataloading"));var e=this;this.syncCart(function(){window.location=e.config.cartPageUrl,setTimeout(function(){y.hideLoading()},500)})},gotoOrderPage:function(){y.showLoading(_yb.t("toast.dataloading"));var n=this;this.syncCart(function(e){for(var t=[],i=0;i<e.length;i++){var o=e[i];o.MinQuantity&&o.MinQuantity>o.ProductTotalNum&&t.push(o.ProductName)}0<t.length?y.alert(_yb.t("recommendService.currentStockDoesNotMeetMinimumSaleAmount")+t.join(","),function(){window.location=n.config.cartPageUrl}):window.location=n.config.orderPageUrl,setTimeout(function(){y.hideLoading()},500)})},balance:function(o){var n=this;n.needSync=!0,n.syncCart(function(e,t,i){0===i.length?o():n.alertInvalidMessage(i)},!0,!1)},alertInvalidMessage:function(e){var t=[],i=[],o=[],n="",a="",s="",r=!0,c=!1,d=void 0;try{for(var u,l=e.entries()[Symbol.iterator]();!(r=(u=l.next()).done);r=!0){var p=_slicedToArray(u.value,2),h=(p[0],p[1]),m=h.ProductName,v=h.Stock;!0===h.MaterialOutOfStock&&!0===h.IsOutStock?i.push(m):!0===h.IsOutStock?t.push(m+"("+_yb.t("recommendService.stock")+"："+v+")"):o.push(m)}}catch(e){c=!0,d=e}finally{try{!r&&l.return&&l.return()}finally{if(c)throw d}}0!==i.length&&(s=_yb.t("recommendService.theBelowItemsDoestNotHaveEnoughIngredients")+"："+i.join("、")),0!==t.length&&(n=_yb.t("recommendService.theBelowItemsDoesNotHaveEnoughStock")+"："+t.join("、")),0!==o.length&&(a=_yb.t("recommendService.theBelowItemsCannotBePurchased")+"："+o.join("、"));var f=s+"<br/> "+n+"<br/> "+a;y.alert(f)},resolveStock:function(e){var t=e.isTips,i=void 0===t||t,o=e.product,n=e.source,a=Object.assign({},o,n),s=a.ProductNum,r=a.Stock,c=a.IgnoreStock;return!0===window._yb.AllowStockBelowZero?{status:"pending"}:!0===c?{status:"pending"}:r<=s?(!0===i&&y.alert(_yb.t("recommendService.insufficientStock")+"："+r),{status:"rejected",stock:r}):{status:"resloved",stock:r}}},i={syncUrl:"/wxapi/shopcart/syncshopcart"},_yb.initRecommendCartService=function(e){return new t(e)}}($,window),function($,w){var defaults,checkout=null,CheckoutService=function(e){this.initConfig(e)};CheckoutService.prototype={initConfig:function(e){var t=this;t.wxClientConfig=null,t.config=$.extend({},defaults,e),t.items=[],t.eventHandlers=[],t.loaded=!1},load:function(e){console.log("load",this.needSync),this.needSync?this.doLoad(e):(this.notify("reload"),e&&e())},checkout:function(e,t,o,i){for(var n=(t=t||"").split("&"),a={},s=0;s<n.length;s++)a[n[s].split("=")[0]]=n[s].split("=")[1];var r=$.extend({isMerge:!0,address:e,applyShoppingCard:!0,includeRecommend:!0,ifCacheDiscountResult:!0,includeApplyPoint:i},a);_yb.apiRequest(this.config.checkoutUrl,r,function(e){if(e.successed){var t=e.data,i={modeValue:e.storeModeValue,mode:e.storeMode};o&&o(t,i)}else o(!1)},function(){o&&o(!1)})},checkoutView:function(i){var e={};!0===window.YB_OPENCASHCOUPON&&(e.applyCashCoupon=!0),_yb.apiRequest(this.config.checkoutViewV2Url,e,function(e){if(e.successed){var t=e.data;i&&i(t)}else i(!1)},function(e){i&&i(!1)})},placeOrder:function placeOrder(data,callback){var self=this;_yb.apiRequest(self.config.placeOrder,data,function(result){result.successed||result.Success?(result.script?eval(result.script):result.Script&&eval(result.Script),callback&&callback(!0)):result.requiredLogin?$.confirm({text:_yb.t("checkoutView.pleaseLogin"),onOK:function(){var e=self.getQueryString("domain"),t=self.getQueryString("eattpye");e||(e=window.location.href.split(".")[0].split("//")[1]);var i="/m/accountv4?domain="+e+"&returnurl="+encodeURIComponent("/m/order?tmpl=1&eattpye="+t+"&domain="+e);window.location.href=i,callback&&callback(!1)},onCancel:function(){callback&&callback(!1)}}):result.message&&$.alert({text:result.message,onOK:function(){callback&&callback(!1)}})},function(){$.alert({text:_yb.t("modal.apiErr"),onOK:function(){callback&&callback(!1)}})})},getAvailableCoupons:function(e,t,i){_yb.apiRequest(this.config.getAvailableCouponsUrl,{includeCashCoupon:e||!0,discountCacheKey:t||""},function(e){e.successed?i&&i(e):i&&i(!1)},function(){$.alert({text:_yb.t("modal.apiErr"),onOK:function(){i&&i(!1)}})})},applyCoupon:function(e,t,i,o){var n=4<arguments.length&&void 0!==arguments[4]&&arguments[4];_yb.apiRequest(this.config.applyCoupon,{id:e,applyPoint:t,checkPayMethod:i,inputCode:n},function(e){if(e.successed){var t=e.data;o&&o(t)}else $.hideLoading(),e.message&&$.alert({text:e.message,onOK:function(){o&&o(!1)}})},function(){$.hideLoading(),$.alert({text:_yb.t("modal.apiErr"),onOK:function(){o&&o(!1)}})})},applyCoupons:function(e,t,i,o,n){_yb.apiRequest(this.config.applyCouponsUrl,{couponCodes:e,applyPoint:t,checkPayMethod:i,includeProducts:o},function(e){e.successed?n&&n(e):e.message&&$.alert({text:e.message,onOK:function(){n&&n(!1)}})},function(){$.alert({text:_yb.t("modal.apiErr"),onOK:function(){n&&n(!1)}})})},applyPoint:function(e,t,i,o){_yb.apiRequest(this.config.applyPointUrl,{couponId:e,applyPoint:t,checkPayMethod:i},function(e){if(e.successed){var t=e.data;o&&o(t)}else e.message&&$.alert({text:e.message,onOK:function(){o&&o(!1)}})},function(){$.alert({text:_yb.t("modal.apiErr"),onOK:function(){o&&o(!1)}})})},applyCashCoupon:function(e,t,i){_yb.apiRequest(this.config.applyCashCouponUrl,{id:e,txtUid:t},function(e){if(e.successed){var t=e.data;i&&i(t)}else e.message&&$.alert({text:e.message,onOK:function(){i&&i(!1)}})},function(){$.alert({text:_yb.t("modal.apiErr"),onOK:function(){i&&i(!1)}})})},appointment:function(e,t){_yb.apiRequest(this.config.appointment,{day:e},function(e){e?t&&t(e):t(!1)},function(e){t&&t(!1)})},loadWxConfig:function(t){var i=this;null===i.wxClientConfig?$.ajax({url:this.config.wxConfigUrl,headers:{PSPLVISITORAUTO:"YES"},type:"POST",async:!0,success:function(e){e&&e.data?i.wxClientConfig=e.data:i.wxClientConfig=!1,t&&t(i.wxClientConfig)}}):t&&t(i.wxClientConfig)},remindTimer:function(e,t){var i=this;if(!(e.offset().width<=t.offset().width)){var o={start:0,end:e.offset().width,gap:30,coun:function(){o.start++,o.start>=o.end?e.offset({left:t.offset().width}):i.isStopTime?i.isStopTime=!1:(o.start+5>o.end&&(o.start=-t.offset().width),e.offset({left:-o.start}),o.timeout())},timeout:function(){setTimeout(o.coun,o.gap)}};o.coun()}},search:function(e,t){var i=e.categoryUids||"",o=e.pageIdx||0,n=e.keywords||"",a=e.size||20,s={key:n,cUids:i,pageIdx:o,tags:e.tags||"",categories:e.categories||"",size:a,ignoreCart:!0,isSeries:e.isSeries||!0,pUids:e.pUids||""};$.ajax({url:this.config.searchUrl,type:"POST",data:s,async:!0,global:!1,success:function(e){t&&t(e)}})},getQueryString:function(e){var t=new RegExp("(^|&)"+e+"=([^&|#]*)(&|$|#)","i"),i=window.location.href.split("?")[1]?window.location.href.split("?")[1].match(t):null,o="";return o=null!=i?i[2]:null!=(i=window.location.href.split("?")[2]?window.location.href.split("?")[2].match(t):null)?i[2]:"",(i=t=null)==o||""==o||"undefined"==o?"":o},getStoreData:function(i){if(null==this.storeInfo){var o=this;_yb.apiRequest(o.config.getStoreData,{},function(e){if(e){var t=e;o.storeInfo=e,i&&i(t)}else i(!1)},function(e){i&&i(!1)})}else i&&i(this.storeInfo)},getMapKey:function(t){var i=this;i.mapKeyCache?t&&t(i.mapKeyCache):_yb.apiRequest(i.config.getQQMapKey,{},function(e){e?(i.mapKeyCache=e.result,t&&t(i.mapKeyCache)):t(!1)},function(e){t&&t(!1)})},loadChargeRules:function(t){var i=this;i.chargeRulesCache?t&&t(i.chargeRulesCache):_yb.apiRequest(i.config.loadChargeRulesUrl,{},function(e){e.successed?(i.chargeRulesCache=e,t&&t(e)):t(!1)},function(e){t&&t(!1)})},loadStoreList:function(e,t){e.forMiniAppOnly=!1,_yb.apiRequest(this.config.storeListUrl,e,function(e){e.successed?t&&t(e):t&&t(!1)},function(e){t&&t(!1)})}},defaults={checkoutUrl:"/wxapi/shopcart/Checkout",checkoutViewUrl:"/wxapi/checkout/index",checkoutViewV2Url:"/wxapi/checkout/IndexNoDiscount",placeOrder:"/wxapi/order/place",applyCoupon:"/wxapi/order/ApplyCouponCode",applyCouponsUrl:"/wxapi/order/applydiscount",applyCashCouponUrl:"/wxapi/order/ApplyCashCouponCode",applyPointUrl:"/wxapi/order/ApplyPoint",getAvailableCouponsUrl:"/wxapi/checkout/GetAvailableCoupons",getApplyPointInfoUrl:"/wxapi/checkout/GetApplyPointInfo",appointment:"/wxapi/checkout/FindPreTimes",wxConfigUrl:"/wxapi/store/WxApiConfig",searchUrl:"/wxapi/product/ListMulti",getStoreData:"/wxapi/store/GetStoreData",getQQMapKey:"/wxapi/store/TecentMapApiKey",loadChargeRulesUrl:"/wxapi/customeraccount/LoadChargeRules",storeListUrl:"/wxapi/store/NearbyStoreList"},_yb.initCheckoutService=function(e){return null===checkout&&(checkout=new CheckoutService(e),_yb.services.checkout=checkout),checkout}}($,window),$,window._yb.services.checkoutModeObj={modeObjectList:{RegularOrder:{takeout:[{name:"配送",modeDataName:"1",modeData:"storeMode=RegularOrder&storeModeValue=1",isShowTimePicker:!0,idName:"s13"},{name:"自取",modeDataName:"takeout",modeData:"storeMode=RegularOrder&storeModeValue=takeout",isShowTimePicker:!0,idName:"s14"}],1:[{name:"配送",modeDataName:"1",modeData:"storeMode=RegularOrder&storeModeValue=1",isShowTimePicker:!0,idName:"s13"},{name:"自取",modeDataName:"takeout",modeData:"storeMode=RegularOrder&storeModeValue=takeout",isShowTimePicker:!0,idName:"s14"}],package:[{name:"配送",modeDataName:"package",modeData:"storeMode=RegularOrder&storeModeValue=package",isShowTimePicker:!0,idName:"s13"},{name:"自取",modeDataName:"takeout",modeData:"storeMode=RegularOrder&storeModeValue=selftake",isShowTimePicker:!0,idName:"s14"}],selftake:[{name:"配送",modeDataName:"package",modeData:"storeMode=RegularOrder&storeModeValue=package",isShowTimePicker:!0,idName:"s13"},{name:"自取",modeDataName:"selftake",modeData:"storeMode=RegularOrder&storeModeValue=selftake",isShowTimePicker:!0,idName:"s14"}],valet:[{name:"配送",modeDataName:"valet",modeData:"storeMode=RegularOrder&storeModeValue=valet",isShowTimePicker:!0,idName:"s13"}],sco:[{name:"配送",modeDataName:"sco",modeData:"storeMode=RegularOrder&storeModeValue=sco",isShowTimePicker:!0,idName:"s13"}],config:{isShowTimePicker:!0,isSHowAddress:!0,isShowModeList:!0,orderModel:"外卖模式"}},AddressQRCode:{queue:[{name:"堂食",modeDataName:"queue",modeData:"storeMode=AddressQRCode&storeModeValue=queue",isShowTimePicker:!1,isSHowAddress:!1,isHideSelf:!1,idName:"s11"},{name:"外带",modeDataName:"takeout",modeData:"storeMode=AddressQRCode&storeModeValue=takeout",isShowTimePicker:!1,isSHowAddress:!1,isHideSelf:!1,idName:"s12"}],takeout:[{name:"堂食",modeDataName:"queue",modeData:"storeMode=AddressQRCode&storeModeValue=queue",isShowTimePicker:!1,isSHowAddress:!1,isHideSelf:!1,idName:"s11"},{name:"外带",modeDataName:"takeout",modeData:"storeMode=AddressQRCode&storeModeValue=takeout",isShowTimePicker:!1,isSHowAddress:!1,isHideSelf:!1,idName:"s12"}],zz:[{isHideSelf:!0,isSHowAddress:!1,isShowTimePicker:!1,modeDataName:"zz"}],config:{isShowTimePicker:!1,isSHowAddress:!1,isShowModeList:!0,orderModel:"手机点餐"}},SelfOrdering:{zz:[{isHideSelf:!0,isSHowAddress:!1,isShowTimePicker:!1,modeDataName:"zz"}],config:{isShowTimePicker:!1,isSHowAddress:!1,isShowModeList:!0,orderModel:"手机点餐"}},PickedUp:{default:[{name:"预约",modeDataName:"default",modeData:"storeMode=PickedUp&storeModeValue=",isShowTimePicker:!0,idName:"s15"}],config:{isShowTimePicker:!0,isSHowAddress:!1,isShowModeList:!0,orderModel:"预约模式"}},OrderAppt:{default:[{name:"预约",modeDataName:"default",modeData:"storeMode=OrderAppt&storeModeValue=",isShowTimePicker:!0,isSHowAddress:!0,idName:"s15"}],config:{isShowTimePicker:!0,isSHowAddress:!1,isShowModeList:!0,orderModel:"预约模式"}}}},function(v,e){var k=function(e){return e<10?"0"+e:String(e)},t=function(e){this.viewContainer=v(e.viewContainer),this.timeObj=e.orderTimesObj,this.orderTimeObj={},this.setTimeObj(this.timeObj)},p={},h={},m=!0;t.prototype={setTimeObj:function(e){var t=e.sefltakeTimes,i=e.bizTimes,o=e.cartPreparationTime,n=e.shippingRule.eshopShippingRule?e.shippingRule.eshopShippingRule:{fixedDeliveryTimeItem:[],maxReservationDay:0,selfTakeMaxReservationDay:0,preparationTime:0,selfTakePreparationTime:0},a=n.fixedDeliveryTimeItem||[],s=n.maxReservationDay||0,r=n.selfTakeMaxReservationDay||0,c=o,d=o;2==n.preparationTimeMode&&(c=60*n.preparationTime),2==n.selfTakePreparationTimeMode&&(d=60*n.selfTakePreparationTime);var u=10;s<=0&&!isNaN(t)&&""!=t&&(s=t);var l=s;if(0==a.length&&"string"==typeof t&&2<t.length&&""!=t){var p=t.split("m"),h=p[1].split("h");l=h[1].split("d")[0],c=60*h[0],u=p[0]}return s=l=0==l?1:l,r<=0&&(isNaN(t)||""==t||(r=t),r<=0&&(r=l<=0?1:l)),i=this.changeBizTime(i),this.orderTimeObj={_maxDay:l,maxReservationDay:s,bizTimes:i,preparationTime:c,fixedDeliveryTimeItem:a,_divideMinute:u,selfTakePreparationTime:d,selfTakeMaxReservationDay:r},this.orderTimeObj},changeBizTime:function(e){e=JSON.parse(JSON.stringify(e));var t=new Date,i=new Date(this._toLocaleDate(t)+" "+e[0].begin),o=new Date(this._toLocaleDate(t)+" "+e[0].end);if(1<e.length){var n=new Date(this._toLocaleDate(t)+" "+e[1].begin),a=new Date(this._toLocaleDate(t)+" "+e[1].end);n<i||a<o?e.reverse():+i==+o?e[0].end=e[0].end.substring(0,5)+":01":+n==+a&&(e[1].end=e[1].end.substring(0,5)+":01")}else if(+i==+o)e[0].end=e[0].end.substring(0,5)+":01";else if(+o<+i){e=[{begin:"00:00:00",end:e[0].end},{begin:e[0].begin,end:"23:59:59"}]}return e},getMaxReservationDay:function(e){return e?this.orderTimeObj.selfTakeMaxReservationDay:this.orderTimeObj._maxDay},getTimeBoole:function(e,t){var i={};return i.hasPreparationTime=0<this.orderTimeObj.preparationTime||0<this.orderTimeObj.selfTakePreparationTime,i.hasFixedTime=0<this.orderTimeObj.fixedDeliveryTimeItem.length,!0===e&&(i.hasFixedTime=!1),!0===t?i.hasPreparationTime||i.hasFixedTime:i},deliveryTimePicker:function(){m=!1,this._getSortTimeDate(this.orderTimeObj,!1)},takeoutTimePicker:function(){m=!0,this._getSortTimeDate(this.orderTimeObj,!0)},_insetIosTime:function(e){if("string"==typeof e){var t=e.split(/[- : \/]/);return new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5])}return e},_getSortTimeDate:function(e,t){var i=e.bizTimes,o=e.fixedDeliveryTimeItem,n=e._divideMinute,a=e._maxDay,s=e.preparationTime,r=new Date;if(0<s){r=new Date(this._insetIosTime(+r+60*s*1e3));var c=new Date(this._insetIosTime(this._toLocaleDate(r)+" "+i[0].begin)),d=new Date(this._insetIosTime(+c+60*s*1e3));i[0].beginBefore=i[0].begin,i[0].begin=d.toTimeString().split(" G")[0]}else i[0].begin=i[0].beginBefore?i[0].beginBefore:i[0].begin;!0===t&&(a=e.selfTakeMaxReservationDay,s=e.selfTakePreparationTime),this._getTimeNewFn({_maxDay:a,bizTimes:i,preparationTime:s,fixedDeliveryTimeItem:o,_divideMinute:n,isSelfTake:t})},_shortFixedPicker:function(e){var o=this,t=e.days.v,a=e.days.dv,s=e.todayTimes.horus.v,r=e.todayTimes.horus.dv,c=e.times.horus.v,d=e.times.horus.dv,i=[{displayValues:a,values:t,cssClass:"col-day"},{displayValues:r,values:s,cssClass:"col-hour-fixed"}],u=a[0],n=(r[0],v("#OrderAppointmentTime",o.viewContainer));if(0<n.length){var l=v(".yb-checkoutModeList input[checked]",o.viewContainer).parent().parent().data("modename");l=" "+_yb.t("checkoutView.takefoodtype.s1"+("配送"==l?3:4)),n.picker({cols:i,rotateEffect:!1,toolbarTemplate:'<div class=" yb-picker-head toolbar"><div class=" toolbar-inner">\n                    <div class="yb-picker__bd ">'+_yb.t("checkoutTime.pleaseSelectTime")+'</div>\n                    <a href="javascript:;" class="yb-picker__ft picker-button close-picker">'+_yb.t("modal.ok")+"</a></div></div>",cssClass:"yb-picker-order-time",onChange:function(e,t,i){var o=e.cols[0].displayValue,n=e.cols[1].displayValue;if(u!=o)return o==a[0]?e.cols[1].replaceValues(s.map(function(e){return e}),r.map(function(e){return e})):e.cols[1].replaceValues(c.map(function(e){return e}),d.map(function(e){return e})),n,u=o,e.updateValue(),!1},onClose:function(e){var t=e.value[0]+" "+e.value[1]+":00";if(e.value[0]==_yb.t("common.null")||e.value[1]==_yb.t("common.null")){var i="";return e.value[1]==_yb.t("common.null")&&(i=_yb.t("common.todayNo"),t=_yb.t("common.todayNo2")),v("#OrderAppointmentTime",o.viewContainer).val(i+l),void v("#OrderTime",o.viewContainer).text(t)}n.val(e.displayValue.join(" ")+l),v("#OrderTime",o.viewContainer).text(t),o.saveLastDateData({_inputsotr1:e.displayValue.join(" ")+l,_inputsotr2:t})}});var p=a[0]+r[0],h=t[0].split("/").join("-")+" "+s[0]+":00";s[0]==_yb.t("common.null")&&(!t[1]==_yb.t("common.null")||1==t.length?(p=_yb.t("common.todayNo"),h=_yb.t("common.todayNo2")):(p=a[1]+d[0],h=t[1]+" "+c[0]+":00")),n.val(p+l),v("#OrderTime",o.viewContainer).text(h),o.laodLastDateData(!1)}},_longTimePicker:function(e,t,i){var n=t._st,o=this,a=[{displayValues:["2019"+_yb.t("common.year"),"2020"+_yb.t("common.year"),"2021"+_yb.t("common.year"),"2022"+_yb.t("common.year"),"2023"+_yb.t("common.year")],textAlign:"center",values:["2019","2020","2021","2022","2023"]},{displayValues:_yb.t("checkoutTime.allMonth").split(" "),textAlign:"center",values:"01 02 03 04 05 06 07 08 09 10 11 12".split(" ")},{displayValues:function(){for(var e=[],t=1;t<=31;t++)e.push(k(t)+_yb.t("common.day"));return e}(),textAlign:"center",values:function(){for(var e=[],t=1;t<=31;t++)e.push(k(t));return e}()}],s=new Date(+n+84600*e*1e3),r=t;if(v("#TakeoutDayTime",o.viewContainer).picker({cols:a,toolbarTemplate:'<div class=" yb-picker-head toolbar"><div class=" toolbar-inner">                <a href="javascript:;" class="yb-picker__hd yb-cancel-picker">'+_yb.t("modal.cancel")+'</a>                <div class="yb-picker__bd ">'+_yb.t("checkoutTime.pleaseSelectTime")+'</div>                <a href="javascript:;" class="yb-picker__ft picker-button close-picker">'+_yb.t("modal.ok")+"</a></div></div>",cssClass:"yb-picker-order-time",onChange:function(e){var t=new Date(e.value.join("/")),i=e.value;if(t<n)e.setValue([k(n.getFullYear()),k(n.getMonth()+1),k(n.getDate())]);else if(s<=t)e.setValue([k(s.getFullYear()),k(s.getMonth()+1),k(s.getDate())]);else if(t.getFullYear()!=i[0]||t.getMonth()+1!=i[1]||t.getDate()!=i[2]){var o=e.cols[2];e.setValue([i[0],i[1],o.values[o.values.indexOf(o.value)-1]])}},onClose:function(e){v("#OrderDayTime",o.viewContainer).text(e.value.join("/")),v("#TakeoutDayTime",o.viewContainer).val(e.displayValue.join("")),o.saveLastDateData({orderDayTime:e.value.join("/"),takeoutDayTime:e.displayValue.join("")});var t=r.other;new Date(e.value.join("/")).getDate()==n.getDate()&&(t=r.today);var i=v("#TakeoutHourTime",o.viewContainer);i.empty(),0<t.v.length?o._longTime2InputViewFn(t):i.html('<input type="text" class="yb-cell__input-picker" disabled name="" value="'+_yb.t("checkoutTime.pleaseSelectTime")+'" placeholder="" >')}}),0<i){var c=r.other.dv[0],d=n.getFullYear()+_yb.t("common.year")+(n.getMonth()+1+_yb.t("common.month"))+k(new Date(+n+864e5).getDate())+_yb.t("common.day"),u=n.getFullYear()+"-"+(n.getMonth()+1)+"-"+new Date(+n+864e5).getDate();this._longTime2InputViewFn(r.other),r.today.dv[0]&&r.today.dv[0]!=_yb.t("checkoutTime.noTime")&&(c=r.today.dv[0],d=n.getFullYear()+_yb.t("common.year")+(n.getMonth()+1+_yb.t("common.month"))+k(n.getDate())+_yb.t("common.day"),u=n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate(),this._longTime2InputViewFn(r.today)),v("#TakeoutDayTime",o.viewContainer).val(d),v("#TakeoutHourTime input",o.viewContainer).val(c),v("#OrderDayTime",o.viewContainer).text(u),v("#OrderHourTime",o.viewContainer).text(c+":00")}this.laodLastDateData(!0,r)},saveLastDateData:function(e){m?(e.takeoutDayTime&&(p.takeoutDayTime=e.takeoutDayTime),e.orderDayTime&&(p.orderDayTime=e.orderDayTime),p.takeoutHourTime=e.takeoutHourTime,p.orderHourTime=e.orderHourTime,p._inputsotr1=e._inputsotr1,p._inputsotr2=e._inputsotr2):(e.takeoutDayTime&&(h.takeoutDayTime=e.takeoutDayTime),e.orderDayTime&&(h.orderDayTime=e.orderDayTime),h.takeoutHourTime=e.takeoutHourTime,h.orderHourTime=e.orderHourTime,h._inputsotr1=e._inputsotr1,h._inputsotr2=e._inputsotr2)},laodLastDateData:function(e,t){var i=this;if("{}"!=JSON.stringify(h)||"{}"!=JSON.stringify(p)){var o=void 0,n=void 0,a=void 0,s=void 0,r=void 0,c=void 0;if(m?(o=p.takeoutDayTime,n=p.orderDayTime,a=p.takeoutHourTime,s=p.orderHourTime,r=p._inputsotr1,c=p._inputsotr2):(o=h.takeoutDayTime,n=h.orderDayTime,a=h.takeoutHourTime,s=h.orderHourTime,r=h._inputsotr1,c=h._inputsotr2),e){o&&v("#TakeoutDayTime",i.viewContainer).val(o),n&&v("#OrderDayTime",i.viewContainer).text(n);var d=t.other,u=new Date;new Date(n).getDate()==u.getDate()&&(d=t.today);var l=v("#TakeoutHourTime",i.viewContainer);l.empty(),0<d.v.length?i._longTime2InputViewFn(d):l.html('<input type="text" class="yb-cell__input-picker" disabled name="" value="'+_yb.t("checkoutTime.noSelectTime")+'" placeholder="" >'),a&&v("#TakeoutHourTime input",i.viewContainer).val(a),s&&v("#OrderHourTime",i.viewContainer).text(s)}else r&&v("#OrderAppointmentTime",i.viewContainer).val(r),c&&v("#OrderTime",i.viewContainer).text(c)}},_longTime2InputViewFn:function(e){var t=this,i=v("#TakeoutHourTime",t.viewContainer);i.html('<input type="text" class="yb-cell__input-picker" name="" value="" placeholder="'+_yb.t("checkoutTime.pleaseSelectTime")+'" >'),i.find("input").picker({cols:[{textAlign:"center",values:e.v,displayValues:e.dv}],onChange:function(e){},onClose:function(e){v("#TakeoutHourTime input",t.viewContainer).val(e.displayValue.join("")),v("#OrderHourTime",t.viewContainer).text(e.value.join("")),t.saveLastDateData({takeoutHourTime:e.displayValue.join(""),orderHourTime:e.value.join("")})}})},_doPickerByShortTimes:function(r,c){var d=c[0].sub,u=c[1].sub,l=c[0].sub[0].sub,p=c[1].sub[0].sub,e=[],t=0<this.orderTimeObj.preparationTime,h=r.dv[0],m="",i="",o="",n=this,a=v("#OrderAppointmentTime",n.viewContainer);if(d&&l&&d[0]&&l[0]){if(e=[{displayValues:r.dv,values:r.v,cssClass:"col-day"},{displayValues:d.map(function(e){return e.dv}),values:d.map(function(e){return e.v}),cssClass:"col-hour"},{displayValues:l.map(function(e){return e.dv}),values:l.map(function(e){return e.v}),cssClass:"col-minute"}],m=d[0].dv,i=r.dv[0]+d[0].dv+l[0].dv,o=r.v[0].split("/").join("-")+" "+d[0].v+":"+l[0].v+":00",a.removeAttr("disabled"),0<a.length){var s=v(".yb-checkoutModeList input[checked]",n.viewContainer).parent().parent().data("modename");s=" "+_yb.t("checkoutView.takefoodtype.s1"+("配送"==s?3:4)),a.picker({cols:e,rotateEffect:!1,toolbarTemplate:'<div class=" yb-picker-head toolbar"><div class=" toolbar-inner">\n                    '+(t?"":'<a href="javascript:;" class="yb-picker__hd yb-cancel-picker">'+_yb.t("modal.cancel")+"</a>")+'\n                    <div class="yb-picker__bd ">'+_yb.t("checkoutTime.pleaseSelectTime")+'</div>\n                    <a href="javascript:;" class="yb-picker__ft picker-button close-picker">'+_yb.t("modal.ok")+"</a></div></div>",cssClass:"yb-picker-order-time",onChange:function(e,t,i){var o=e.cols[0].displayValue,n=e.cols[1].displayValue;if(h!=o)return o==r.dv[0]?(e.cols[1].replaceValues(d.map(function(e){return e.v}),d.map(function(e){return e.dv})),e.cols[2].replaceValues(l.map(function(e){return e.v}),l.map(function(e){return e.dv}))):(e.cols[1].replaceValues(u.map(function(e){return e.v}),u.map(function(e){return e.dv})),e.cols[2].replaceValues(p.map(function(e){return e.v}),p.map(function(e){return e.dv}))),m=n,h=o,e.updateValue(),!1;if(m!=n){var a=1;n==c[0].sub[0].dv&&(a=0);var s=c[a].sub.filter(function(e){return e.dv==n})[0].sub;return e.cols[2].replaceValues(s.map(function(e){return e.v}),s.map(function(e){return e.dv})),m=n,e.updateValue(),!1}},onClose:function(e){var t=e.value[0]+" "+e.value[1]+":"+e.value[2]+":00";a.val(e.displayValue.join(" ")+s),v("#OrderTime",n.viewContainer).text(t),n.saveLastDateData({_inputsotr1:e.displayValue.join(" ")+s,_inputsotr2:t})}}),t&&(a.val(i+s),v("#OrderTime",n.viewContainer).text(o)),n.laodLastDateData()}}else a.val(_yb.t("checkoutTime.noTime")).attr("disabled","true")},_getTimeNewFn:function(e){var t=e.bizTimes,i=e.preparationTime,o=e.fixedDeliveryTimeItem,n=e._divideMinute,a=e._maxDay,s=e.isSelfTake,r=this._getNowTime({bizTimes:t,pTime:i});if(7<a){var c=void 0;c=0<o.length?this._getFiexdTimes({_st:r,fItems:o}):this._getShortTimes({_st:r,bizTimes:t,dm:30,isLongTime:!0}),this._longTimePicker(a,{today:c.todayFiexdItems,other:c.fiexdItems,_st:r},i)}else{var d=this._getDaysNewFn({_st:r,maxDay:a});if(0<o.length&&!s){var u=this._getFiexdTimes({_st:r,fItems:o,days:d});0==u.todayFiexdItems.dv.length&&((d=this._getDaysNewFn({_st:r,maxDay:a+1})).dv.splice(0,1),d.v.splice(0,1),u.todayFiexdItems=u.fiexdItems),this._shortFixedPicker({days:d,todayTimes:{horus:u.todayFiexdItems},times:{horus:u.fiexdItems},pTime:i})}else this._doPickerByShortTimes(d,this._getShortTimes({maxDay:a,bizTimes:t,_st:r,dm:n,fItems:o}))}},_getNowTime:function(e){var a,s=this,t=e.bizTimes,i=e.pTime,o=0,r=new Date,c=(new Date,0);t.forEach(function(e,t){var i=e.beginBefore||e.begin,o=new Date(s._toLocaleDate(r)+" "+i),n=new Date(s._toLocaleDate(r)+" "+e.end);c+=(+n-+o)/1e3/60,a=n});var n=(a-r)/1e3/60,d=i-(n=n<0?0:n),u=new Date(+r+60*i*1e3);if(0==d){var l=new Date(+r+864e5);u=new Date(this._toLocaleDate(l)+" 00:00:00")}if(0<d){var p=parseInt(d/c,10)+1,h=d%c;o=p,t[0].begin=t[0].beginBefore||t[0].begin;var m=new Date(this._toLocaleDate(r)+" "+t[0].begin);i=h+((a-m)/1e3/60-c),u=new Date(+m+60*i*1e3+86400*o*1e3)}return u},_getShortTimes:function(e){for(var t=e._st,i=e.dm,o=e.bizTimes,n=!0===e.isLongTime,a=new Date(this._toLocaleDate(t)+" "+k(t.getHours())+":00:00");a<t;)a=new Date(+a+60*i*1e3);for(var s=[],r=0,c=a.getHours(),d=a.getDate(),u=!0,l=[_yb.t("common.sunday"),_yb.t("common.monday"),_yb.t("common.tuesday"),_yb.t("common.wednesday"),_yb.t("common.thursday"),_yb.t("common.friday"),_yb.t("common.saturday")];r<2;){for(var p=[],h=this._toLocaleDate(a);a.getDate()==d;){for(var m=[],v=k(a.getHours());a.getHours()==c;){if(u=this._checkInBiz(a,o)){var f=k(a.getMinutes());m.push({dv:f+_yb.t("common.minute"),v:f,hdv:v+_yb.t("common.hour")})}a=new Date(+a+60*i*1e3)}u&&p.push({dv:v+_yb.t("common.hour"),v:v,code:h+v,sub:[]});var y=p[p.length-1];y&&y.dv==(m[0]?m[0].hdv:"")&&(y.sub=m),c=a.getHours()}var b=p[p.length-1];!b||b.sub&&0!=b.sub.length||p.pop();var w=p[0];w&&w.sub&&0==w.sub.length&&p.shift(),s.push({dv:l[a.getDay()],v:this._toLocaleDate(a),code:h,sub:0<p.length?p:[{sub:[]}]}),d=a.getDate(),r++}if(n){var g={dv:[],v:[]},C={dv:[],v:[]};return s[0].sub.forEach(function(t){t.sub.forEach(function(e){C.dv.push(t.v+":"+e.v),C.v.push(t.v+":"+e.v)})}),s[1].sub.forEach(function(t){t.sub.forEach(function(e){g.dv.push(t.v+":"+e.v),g.v.push(t.v+":"+e.v)})}),{fiexdItems:g,todayFiexdItems:C}}return s},_getFiexdTimes:function(e){var n=this,t=e.fItems,a=e._st,s={dv:[],v:[]};t.forEach(function(e){var t=e.split("|"),i=new Date(n._insetIosTime(n._toLocaleDate(a).substring(0,10)+" "+t[0])),o=new Date(n._insetIosTime(n._toLocaleDate(a).substring(0,10)+" "+t[1]));+a<+o&&(+i<+a?(s.dv.push(k(a.getHours())+":"+k(a.getMinutes())+" ~ "+t[1].substring(0,5)),s.v.push(k(a.getHours())+":"+k(a.getMinutes()))):(s.dv.push(t[0].substring(0,5)+" ~ "+t[1].substring(0,5)),s.v.push(t[0].substring(0,5))))});var i={dv:[],v:[]};return t.forEach(function(e){var t=e.split("|");i.dv.push(t[0].substring(0,5)+" ~ "+t[1].substring(0,5)),i.v.push(t[0].substring(0,5))}),{fiexdItems:i,todayFiexdItems:s}},_getLongTimes:function(e){},_getDaysNewFn:function(e){var t=e._st,i=e.maxDay,o=[_yb.t("common.sunday"),_yb.t("common.monday"),_yb.t("common.tuesday"),_yb.t("common.wednesday"),_yb.t("common.thursday"),_yb.t("common.friday"),_yb.t("common.saturday")],n=new Date,a=new Date(+n+864e5),s=new Date(+a+864e5),r={};r[n.toDateString()]=_yb.t("common.today")+"("+o[n.getDay()]+")",r[a.toDateString()]=_yb.t("common.tomorrow")+"("+o[a.getDay()]+")",r[s.toDateString()]=_yb.t("common.afterTomorrow")+"("+o[s.getDay()]+")";for(var c={dv:[],v:[]},d=0;d<i;d++){var u=new Date(+t+86400*d*1e3),l=o[u.getDay()],p=u.toDateString();l=r[p]?r[p]:l,c.dv.push(l),c.v.push(this._toLocaleDate(u))}return c},_checkInBiz:function(a,e){var s=this,r=!1;return e.forEach(function(e,t){var i=e.begin,o=new Date(s._toLocaleDate(a)+" "+i),n=new Date(s._toLocaleDate(a)+" "+e.end);+o<=+a&&+a<=+n&&(r=!0)}),r},_toLocaleDate:function(e){return[e.getFullYear(),e.getMonth()+1,e.getDate()].join("/")}},_yb.mixins.ChechoutTimePicker=function(e){return new t(e)}}($,window),function(k,t){var i,o=function(e){this.initConfig(e)};o.prototype={initConfig:function(e){var n=this;n.config=k.extend({},i,e),window.afterPayment=function(e,t){var i="/m/order/receipt/"+e+"?hid="+t,o=n.orderService.getQueryString("domain");o&&(i="/m/order/receipt/"+e+"?hid="+t+"&domain="+o),setTimeout(function(){window.location.href=i},200)},n.viewContainer=k(n.config.viewContainer),n.cartContentView=k(".yb-order-content",n.viewContainer),n.checkoutMode="",n.nullCouponTotalMoney=0,n.loaded=!1,n.isPaying=!1,n.viewLoaded=!1,n.hasMinAmount=!0,n.withinShipping=!0,n.isCustomer=!1,n.changeCart=[],n.selectCoupons=[],n.coupons=[],n.regularTime="",n.beforePoint={},n.isApplyPoint=!1,n.allowApplyPoint=!1,n.isCustomerPayTxt="",n.recommendOnce=!0,window.OPENMOERCOUPONSUSE=!0,n.selectStore={},n.orderTimesObj={cartPreparationTime:0,shippingRule:{},sefltakeTimes:"",bizTimes:[{begin:"07:00:00",end:"23:00:59"}]},k("#OrderTime").remove(),n.AvailablePromotionCouponsShowTxt=_yb.t("checkoutView.couponsLoading")+"...",n.orderService=t._yb.initCheckoutService(),n.initActionSheet(),n.initPayment(),n.bindEventAll(),t._yb.services.applyAddress=function(e,t){if(n.recipient={name:e.Recipient,phone:e.Phone,district:e.District,address1:e.Address1,address:e.District+" "+e.Address1},t){n.createAddressView({IsCustomer:!1})}else n.createAddressView()}},once:function(){var t=this;console.log("checkout once");var i=this;k.showLoading(_yb.t("common.processing")),_yb.services.checkout.getStoreData(function(e){t.isOtherCountry=e.data.IsOtherCountry,t.industry=e.data.Industry,t.orderService.checkoutView(function(e){i.createAddressView(e),i.createBodyView(e),i.createPaymethodView(e),e.BizTimes&&0<e.BizTimes.length&&(i.orderTimesObj.bizTimes=e.BizTimes),i.allowApplyPoint=e.AllowApplyPoint,i.orderTimesObj.shippingRule=e.shippingConfigModel,i.isCustomerPayTxt="checkPayMethod=CustomerBalance",e.CustomerBalanceConsume&&e.EnableCustomerBalancePayMethod&&(i.CustomerBalanceConsume=e.CustomerBalanceConsume),i.orderView=e,i.viewLoaded=!0,e.ShippingRemark&&i.runRemark(e.ShippingRemark),i.customerBalance=e.CustomerBalance,i.isCustomer=e.IsCustomer,i.delivery={pickedUpInStores:e.pickedUpInStores,takeAway:e.takeAway,storeMode:e.storeMode,storeModeValue:e.storeModeValue},i.isFirstTime=!0,i.doCheckout("",e)})}),!0===window.SHOWSELFTAKESTORE&&this.laodStoreList()},before:function(e){console.log("checkout before")},on:function(e){console.log("checkout on");this.viewLoaded&&(k.showLoading(_yb.t("common.processing")),window.ISADDRESSESPAGEBACKE?this.doCheckout("addressBackNoLaodMode"):this.doCheckout(),window.ISADDRESSESPAGEBACKE=!1)},after:function(e){console.log("checkout after")},doCheckout:function(e,d,t){var u=this,l=(d=d||u.orderView,!0);"addressBackNoLaodMode"==e&&(l=!1,e="",this.recipient={name:k("#CustomerName",u.viewContainer).text(),phone:k("#CustomerPhoneNum",u.viewContainer).text(),address:k("#CustomerAddress",u.viewContainer).text()});e=e||"";var i=k("#CustomerAddress",u.viewContainer).text();"到店自提"==i&&0<e.indexOf("RegularOrder")&&(e.indexOf("takeout")<0||e.indexOf("selftake")<0)?i=this.recipient?this.recipient.address:"":0<e.indexOf("RegularOrder")&&(0<=e.indexOf("takeout")||0<=e.indexOf("selftake"))&&(i="到店自提"),this.isCustomer||(e+="&storeMember=o"),""!=this.isCustomerPayTxt&&-1==e.indexOf("checkPayMethod")&&(e+="&"+this.isCustomerPayTxt),k("#CouponUId",u.viewContainer).val(""),k("#CouponCode",u.viewContainer).val(""),this.selectCoupons=[],k("#couponSelects input[type=checkbox]",u.viewContainer).map(function(){this.checked=!1});var o=0<this.coupons.length?"<span>"+_yb.t("checkoutView.have")+this.coupons.length+_yb.t("checkoutView.canUesCoupons")+"</span>":"<span>"+u.AvailablePromotionCouponsShowTxt+"</span>";k(".yb-checkout-discount",u.viewContainer).html(o).removeClass("hasCouponNull"),k("#appliedPoint",u.viewContainer)[0].checked=!1,this.isApplyPoint=!1,u.beforePoint.AppliedCustomerPoint&&0<u.beforePoint.AppliedCustomerPoint&&u.allowApplyPoint&&(k("#YBCustomerPoint .yb-integral-sum",u.viewContainer).text(u.beforePoint.AppliedCustomerPoint),k("#YBCustomerPoint .yb-integral-price",u.viewContainer).text(u.beforePoint.AppliedMoneyFromCustomerPoint),k("#YBCustomerPoint",this.viewContainer).show()),u.hasMinAmount=!0;var n=!(u.withinShipping=!0);d.AllowApplyPoint&&d.IsCustomer&&(n=!0),"SelfOrderingPlus"==d.storeMode&&(e="storeMode=RegularOrder&storeModeValue=1"),u.orderService.checkout(i,e,function(e,t){if(k.hideLoading(),!1!==e){u.chargeRulesShow(e.TotalMoney,e.ShoppingCardMoney),e.RecommendProductUids&&u.recommendOnce&&u.orderService.search({pUids:e.RecommendProductUids},function(e){e.successed&&(e.data&&0<e.data.length&&_yb.views.selectRecommend.open(e.data),u.recommendOnce=!1)}),0<e.minAmount&&e.minAmount>e.sellPriceTotal&&(u.hasMinAmount=!1),u.withinShipping=!(!1===e.IsFreeShipping&&!1===e.withinShipping),e.PreparationTime&&(u.orderTimesObj.cartPreparationTime=e.PreparationTime);var i=["RegularOrder","package-","selftake-","PickedUp"];if(-1==i.indexOf(t.mode)&&-1==i.indexOf(t.modeValue)||(-1!=t.modeValue.indexOf("-")?u.orderTimesObj.sefltakeTimes=t.modeValue.split("-")[1]:"PickedUp"==t.mode&&(u.orderTimesObj.sefltakeTimes=Number(t.modeValue))),l&&u.checkModeShow(t),u.createAllItems(u.appendCart(e),t),u.loaded=!0,u.allowApplyPoint&&u.createPointView(e),e.ShoppingCardMoney&&0!=e.ShoppingCardMoney){var o=k('[for="pay2"]',u.viewContainer);0<o.find(".yb-shoppingCart-txt").length?o.find(".yb-shoppingCart-txt").html(_yb.t("checkoutView.shoppingCartUse")+e.ShoppingCardMoney+_yb.t("common.priceUnit")):o.find(".yb-paymethod-body").append('<span class="yb-shoppingCart-txt">'+_yb.t("checkoutView.shoppingCartUse")+e.ShoppingCardMoney+_yb.t("common.priceUnit")+"</span>")}var n=u.delivery,a=n.pickedUpInStores,s=n.takeAway,r=n.storeMode,c=n.storeModeValue;if(!0===u.isFirstTime){if(u.isFirstTime=!1,u.selectCustomerBalance(e.TotalMoney),u.createCouponView(d,e.DiscountCacheKey),a===s)return;if("RegularOrder"!==r)return;if(!["takeout","1","package","selftake",""].includes(c)&&!/^package-.*$/.test(c))return;!0===s?k(".yb-edibleWay").eq(0).trigger("click"):k(".yb-edibleWay").eq(1).trigger("click")}a!==s&&"RegularOrder"==r&&(!0===s?k(".yb-edibleWay").eq(1).hide():k(".yb-edibleWay").eq(0).hide())}else k.alert({text:_yb.t("checkout.cartEmptyInfo"),onOK:function(){window.history.back()}})},n)},appendCart:function(e){for(var t=[],i=[],o=0;o<e.CartOrderItems.length;o++)null!=e.CartOrderItems[o].packageSerial&&void 0!==e.CartOrderItems[o+1]&&e.CartOrderItems[o].packageSerial==e.CartOrderItems[o+1].packageSerial?i.push(e.CartOrderItems[o]):(i.push(e.CartOrderItems[o]),t.push(i.slice(0)),i.length=0);return e.CartOrderItems=t,e},doPayment:function(){var t=this;t.isPaying=!0;var e=k("#CustomerName",t.viewContainer).text(),i=k("#CustomerPhoneNum",t.viewContainer).text(),o=k("#CustomerAddress",t.viewContainer).text(),n=!1;if(e&&e&&o&&(n=!0),!n){var a="#/addresses";return this.isCustomer||(a="#/address/noLogin"),k.alert({text:_yb.t("checkoutView.pleaseSelectAddress"),onOK:function(){window.location.hash=a}}),void(t.isPaying=!1)}var s=k("#paymethodList input[type=radio]",t.viewContainer).filter(function(){return this.checked}).data("code"),r="",c="",d=k("input[checked]",".yb-checkoutModeList").parent().parent().data("mode"),u=k("#OrderTime",t.viewContainer),l=k("#OrderDayTime",t.viewContainer),p=k("#OrderHourTime",t.viewContainer),h="";if(l&&0<l.length&&p.length){h=l.text()+" "+p.text()+":00";var m=k("#TakeoutPhoneNumber",t.viewContainer);0<m.length&&0<m.val().length&&(i=m.val())}else h=u.text();"takeout"==d||"selftake"==d||-1!=t.checkoutMode.indexOf("PickedUp")||window.YB_SHOWappointmentName?c=h:r=h;k("#CouponUId",t.viewContainer).val(),k("#CouponCode",t.viewContainer).val();var v=k("#Comment",t.viewContainer).val(),f=k("#OtherComment",t.viewContainer).text(),y="";y=f&&v?f+"; "+v:f||v;var b=!1;k("#appliedPoint",t.viewContainer).filter(function(){b=this.checked});var w=!t.isCustomer;k.showLoading(_yb.t("checkoutView.isOrder"));var g={RecipientName:e,RecipientPhone:i,RecipientAddress:o,ReservationTime:c,DeliveryTime:r,Comment:y,PayMethod:s,CouponUId:"",CouponCode:"",SelectedCouponCodes:this.selectCoupons,ApplyPoints:b,skipCustomer:w,ApplyShoppingCard:!0};if(!0===window.SHOWSELFTAKESTORE){var C=k("input[checked]",".yb-checkoutModeList").parent().parent().data("modename");g.IsAssignMode=!0,"自取"==C&&(g.AssignStoreId=this.selectStore.StoreId)}t.orderService.placeOrder(g,function(e){t.isPaying=!1,k.hideLoading()})},runRemark:function(e){var t=k(".ybShippingRemark");if(1<t.length)for(var i=0;i<t.length;i++){var o=k(t[i]);t.addClass("yb-shipping-remark");var n=[];n.push('<div class="yb-remind-connet" >'),n.push('<span class="yb-remind-text"><span class="yb-remind-icons"></span> ',e,"</span>"),n.push("</div>"),o.html(n.join(""))}},checkModeShow:function(e){var t=this,i=k(".yb-checkoutModeList",t.viewContainer),o=e.modeValue,n=e.mode,a=t.config.mode[n];if((o.indexOf(!0)||-1!=o.indexOf("package"))&&o.indexOf(!0)&&"RegularOrder"==n&&(t.regularTime=o.split("-")[1],o=o.split("-")[0]),t.checkoutMode=n+"_"+o,t.innerAddress(n,o),a.config.isSHowAddress?-1!=o.indexOf("takeout")||-1!=o.indexOf("selftake")?k("#addressSection",t.viewContainer).removeClass("yb-address_show").addClass("yb-address_hide"):k("#addressSection",t.viewContainer).removeClass("yb-address_hide").addClass("yb-address_show"):k("#addressSection",t.viewContainer).removeClass("yb-address_show").addClass("yb-address_hide"),"手机点餐"!=a.config.orderModel||a[o]){if("手机点餐"==a.config.orderModel&&"zz"==o){s='<div class="yb-table-number"> '+_yb.t("checkoutView.tableNumber")+':<input typy="text" class="yb-table-input" placeholder=" '+_yb.t("checkoutView.pleaseFallTalbeNum")+'" id="TableNumber"></div>';return i.html(s),void(t.recommendOnce||k("#TableNumber").focus())}"外卖模式"!=a.config.orderModel||a[o]||(o="1",t.checkoutMode=n+"_"+o),"预约模式"!=a.config.orderModel||a[o]||(o="default",t.checkoutMode=n+"_"+o),a.config.isShowModeList&&t.createModeView(n,o,t.regularTime)}else if(-1==o.indexOf(".")){var s='<div class="yb-table-number">'+_yb.t("checkoutView.tableNumber")+":<span>"+o+"</span></div>";i.html(s)}else if(-1!=o.indexOf(".")){var r=o.split(".")[0],c=o.split(".")[1],s='<div class="yb-table-number">'+_yb.t("checkoutView.areaCode")+":<span>"+r+"</span>   "+_yb.t("checkoutView.tableNumber")+":<span>"+c+"</span></div>";i.html(s)}},innerAddress:function(e,t){var i=this,o=[];"RegularOrder"==e?"takeout"==t||"selftake"==t?0<k("#CustomerAddress",i.viewContainer).length?k("#CustomerAddress",i.viewContainer).text(_yb.t("checkoutView.selfPickAtStore")):(o.push('<div class="yb-address-name"><span id="CustomerName">',i.recipient.name?i.recipient.name:"-",'</span> <span id="CustomerPhoneNum">',i.recipient.phone?i.recipient.phone:"-","</span> </div>"),o.push('<div yb-address-adr><span id="CustomerAddress">'+_yb.t("checkoutView.selfPickAtStore")+"</span></div>"),k(".yb-address .yb-address-add",i.viewContainer).html(o.join(""))):""==i.recipient.address||"到店自提"==i.recipient.address?(o.push('<div class="yb-address-name">'+_yb.t("checkoutView.pleaseEnterAddress")+" </div>"),k(".yb-address .yb-address-add",i.viewContainer).html(o.join(""))):k("#CustomerAddress",i.viewContainer).text(i.recipient.address):"AddressQRCode"!=e&&"SelfOrdering"!=e||(o.push('<div class="yb-address-name"><span id="CustomerName">',i.recipient.name?i.recipient.name:"-",'</span> <span id="CustomerPhoneNum">',i.recipient.phone?i.recipient.phone:"-","</span> </div>"),"zz"==t?o.push('<div yb-address-adr><span id="CustomerAddress"></span></div>'):"queue"==t||"takeout"==t?o.push('<div yb-address-adr><span id="CustomerAddress">手机点餐</span></div>'):o.push('<div yb-address-adr><span id="CustomerAddress">',t,"</span></div>"),k(".yb-address .yb-address-add",i.viewContainer).html(o.join("")))},createModeView:function(e,t,i){var o="",n="",a=this.config.mode[e],s=a[t],r=[],c=k(".yb-checkoutModeList",this.viewContainer);r.push('<div class="yb-cell weui-cells_checkbox  yb-takeFood-type ">');for(var d=0;d<s.length;d++){var u=s[d];u.modeDataName==t&&(o=u.name,n=u.idName),r.push('<span class=" yb-edibleWay yb-raido_r1 " data-mode="',u.modeDataName,'" data-modename="',u.name,'">'),r.push('<label for="',u.idName,'" class="weui-check__label">'),r.push('<input type="radio" class="weui-check" name="checkbox1" id="',u.idName,'">'),r.push('<i class="weui-icon-checked"></i>'),r.push('<span class="yb-ridao_text">',_yb.t("checkoutView.takefoodtype."+u.idName),"</span>"),r.push("</label>"),r.push("</span>")}r.push("</div>"),this.hasTimeSelfTake=!1;var l=!(("宠物行业"==this.industry||"零售行业"==this.industry)&&"配送"==o);if(a.config.isShowTimePicker&&l){var p=_yb.mixins.ChechoutTimePicker({viewContainer:this.viewContainer,orderTimesObj:this.orderTimesObj}),h="配送"==o?p.getMaxReservationDay(!1):p.getMaxReservationDay(!0);if(-1!=t.indexOf("selftake")){r.push('<div class="yb-cell">'),r.push('<div class="yb-cell__hd">'),r.push('<div class="yb-takeout-phone">'+_yb.t("checkoutView.phoneType")+"</div>"),r.push("</div>"),r.push('<div class="yb-cell__bd">'),r.push("</div>"),r.push('<div class="yb-cell__ft">');var m=' value="" ';this.recipient.phone&&(m=' value="'+this.recipient.phone+'"'),r.push('<input class="" ',m,' name=""  type="tel" pattern="\\d{11}" maxlength="11" placeholder="'+_yb.t("checkoutView.pleaseEnterYourMobilePhoneNumber")+'" id="TakeoutPhoneNumber">'),r.push("</div>"),r.push("</div>")}return 7<h?(r.push('<div class="yb-cell_unline"></div>'),r.push(' <div class="yb-cell arrows  yb-appointment">'),r.push('<div class="yb-cell__hd">'),r.push('<div class="yb-appointment-icon">'+_yb.t("checkoutView.Date")+"</div>"),r.push("</div>"),r.push('<div class="yb-cell__bd">'),r.push("</div>"),r.push('<div class="yb-cell__ft">'),r.push('<input type="text" class="yb-cell__input-picker" name="" value="" placeholder="'+_yb.t("checkoutView.pleaseSelectDayTime")+'" id="TakeoutDayTime">'),r.push("</div>"),r.push('<span style="display:none;" id="OrderDayTime"></span>'),r.push("</div>"),r.push(' <div class="yb-cell arrows  yb-appointment">'),r.push('<div class="yb-cell__hd">'),r.push('<div class="yb-appointment-icon">'+_yb.t("checkoutView.Time")+"</div>"),r.push("</div>"),r.push('<div class="yb-cell__bd">'),r.push("</div>"),r.push('<div class="yb-cell__ft">'),r.push('<div class="" id="TakeoutHourTime" >'),r.push('<input type="text" class="yb-cell__input-picker" disabled name="" value="" placeholder="'+_yb.t("checkoutView.pleaseSelectHourTime")+'" > </div>'),r.push("</div>"),r.push('<span style="display:none;" id="OrderHourTime"></span>')):(r.push(' <div class="yb-cell arrows  yb-appointment">'),r.push('<div class="yb-cell__hd">'),r.push('<div class="yb-appointment-icon"></div>'),r.push("</div>"),r.push('<div class="yb-cell__bd">'),r.push('<input type="text" class="" name="" value="" placeholder="'+_yb.t("checkoutView.orderAppointmentTimeNow"),_yb.t("checkoutView.takefoodtype."+n),'" id="OrderAppointmentTime">'),r.push("</div>"),r.push('<div class="yb-cell__ft">'),r.push("</div>"),r.push('<span style="display:none;" id="OrderTime"></span>')),r.push("</div>"),!0===window.SHOWSELFTAKESTORE&&"自取"==o&&r.push('\n                     <div class="yb-cell arrows yb-select-store-list">\n                        <div class="yb-cell__hd">\n                         <img class="store-icon" src="//imgw.pospal.cn/we/nearyByStore/img/shop.svg" />\n                        </div>\n                        <div class="yb-cell__bd">\n                            <div class="store-name">'+(this.selectStore.StoreName||"")+'</div>\n                            <div class="store-address">'+(this.selectStore.Address||_yb.t("checkoutView.laodingStores"))+'</div>\n                        </div>\n                        <div class="yb-cell__ft">\n                            '+(this.selectStore.DistanceInKmTxt||"")+"\n                        </div>\n                    </div>\n                    "),c.html(r.join("")),c.find('[data-mode="'+t+'"]').find("input").attr("checked","true"),k("#OtherComment",this.viewContainer).text(o),void("配送"==o?(p.deliveryTimePicker(),this.hasTimeSelfTake=p.getTimeBoole(!1,!0)):(p.takeoutTimePicker(),this.hasTimeSelfTake=p.getTimeBoole(!0,!0)))}c.html(r.join("")),c.find('[data-mode="'+t+'"]').find("input").attr("checked","true"),k("#OtherComment",this.viewContainer).text(o)},createBodyView:function(e){var t=[];t.push('<div id="checkoutItems">'),t.push("</div>"),t.push('<div class="weui-cell yb-checkout-integral" id="YBCustomerPoint" style="display:none;">'),t.push('<div class="weui-cell__bd ">'),t.push("</div>"),t.push('<div class="weui-cell__ft">'),t.push('<input type="checkbox" id="appliedPoint" class="weui-switch yb-checkout-tog">'),t.push("</div>"),t.push("</div>"),t.push('<div id="showCouponSelects" class="weui-cell weui-cell_access yb-checkout-list">'),t.push('<div class="weui-cell__hd">'),t.push(_yb.t("checkoutView.coupons")),t.push("</div>"),t.push('<div class="weui-cell__bd">'),t.push('<div class="yb-checkout-discount"><span>'+_yb.t("checkoutView.couponsLoading")+"</span></div>"),t.push("</div>"),t.push('<div class="weui-cell__ft">'),t.push("</div>"),t.push("</div>"),t.push('<input id="CouponUId" type="hidden" value="">'),t.push('<input id="CouponCode" type="hidden" value="">'),e.IsValet&&(k("#confirmPay",this.viewContainer).text(_yb.t("checkout.confirmOrder")),k("#paymethodList",this.viewContainer).hide()),t.push('<div class="weui-cell yb-checkout-list">'),t.push('<div class="weui-cell__hd">'),t.push(_yb.t("checkout.addNote")),t.push("</div>"),t.push('<div class="weui-cell__bd"> </div>'),t.push('<div class="weui-cell__ft">'),t.push('<input type="text" class="yb-checkout-say" id="Comment" placeholder="'+_yb.t("checkout.comment")+'">'),t.push("</div>"),t.push("</div>"),t.push('<div style="display:none" class="weui-cell yb-checkout-list minAmountDiv">'),t.push('<div class="weui-cell__hd">'),t.push(_yb.t("checkout.minOrder")),t.push("</div>"),t.push('<div class="weui-cell__bd"> </div>'),t.push('<div class="weui-cell__ft minAmount">'),t.push("</div>"),t.push("</div>"),t.push('<div class="weui-cell  yb-total ">'),t.push('<div class="weui-cell__hd" style="margin-right: 0.4rem">'),t.push(_yb.t("checkout.totalCount")),t.push("</div>"),t.push('<div class="weui-cell__ft yb-total_ft">'),t.push('<div class="yb-total-totalSell">',_yb.t("checkout.subtotalSell"),':<span class="yb-total-price totalSellPrice"></span></div>'),t.push("<div>"),t.push(_yb.t("checkout.subtotal"),':<span class="yb-total-price totalAmount"></span><span class="yb-total-postage"></span>'),t.push("</div>"),t.push("</div>"),t.push("</div>"),k("#checkoutBody",this.viewContainer).html(t.join(""))},createAddressView:function(e){var t=[],i=this;!i.recipient&&e&&(i.recipient={name:e.CustomerName,phone:e.CustomerPhoneNum,address:e.CustomerAddress});var o="#/addresses";e&&!e.IsCustomer&&(o="#/address/noLogin"),t.push('<a class="weui-cell weui-cell_access yb-address" href="',o,'">'),t.push('<div class="weui-cell__hd yb-address-ico">'),t.push("</div>"),t.push('<div class="weui-cell__bd yb-address-add">'),i.recipient&&i.recipient.address?(t.push('<div class="yb-address-name"><span id="CustomerName">',i.recipient.name,'</span> <span id="CustomerPhoneNum">',i.recipient.phone,"</span> </div>"),t.push('<div yb-address-adr><span id="CustomerAddress">',i.recipient.address,"</span></div>")):t.push('<div class="yb-address-name">'+_yb.t("checkoutView.pleaseEnterAddress")+" </div>"),t.push("</div>"),t.push('<div class="weui-cell__ft"> </div>'),t.push("</a>"),k("#addressSection",this.viewContainer).html(t.join("")).addClass("yb-address_hide")},createCouponView:function(e,t){var o=this,i=[];e.IsCustomer?this.orderService.getAvailableCoupons(!0,t,function(e){var t=e.result,i=[];t.AvailablePromotionCoupons&&(t.AvailablePromotionCoupons.forEach(function(e){e.iaCash=!1}),i=t.AvailablePromotionCoupons),t.AvailableCashCoupons&&(t.AvailableCashCoupons.forEach(function(e){e.iaCash=!0,e.Code="cash"+e.Code}),i=t.AvailablePromotionCoupons.concat(t.AvailableCashCoupons)),o.coupons=i,o.laodCouponsToView(o.coupons),o.AvailablePromotionCouponsShowTxt=_yb.t("checkoutView.couponsNumber1")+" "+o.coupons.length+" "+_yb.t("checkoutView.couponsNumber2")+" ",k(".yb-checkout-discount",o.viewContainer).html("<span>"+o.AvailablePromotionCouponsShowTxt+"</span>").removeClass("hasCouponNull")}):(i.push('<div class="yb-couponWarning"><img src="//imgw.pospal.cn/we/westroe/img/icons/coupon_null.png" class="yb-searchWarning_img"> <p class="yb-searchWarning_title">'+_yb.t("checkoutView.noCoupons")+"</p></div>"),k("#couponSelects .yb-actionsheet-list",this.viewContainer).html(i.join("")),this.AvailablePromotionCouponsShowTxt=_yb.t("checkoutView.noCoupons2"),k(".yb-checkout-discount",this.viewContainer).html("<span>"+_yb.t("checkoutView.noCoupons2")+"</span>").addClass("hasCouponNull")),0==k(".yb-coupon-addinpunt",this.viewContainer).length&&(k("#couponSelects .weui-actionsheet__title",this.viewContainer).html('\n                <p class="weui-actionsheet__title-text">'+_yb.t("checkoutView.chooseCoupons")+'</p>\n                <div class="yb-coupon-addnew"><span></span> '+_yb.t("checkoutView.redeemCoupons")+'</div> <d class="yb-coupon-close"></d iv>\n                ').addClass("yb-coupons-head"),k("#couponSelects",this.viewContainer).append('\n                    <div class="yb-coupon-addinpunt" >\n                        <div class="yb-coupon-useTitle">\n                            <div class="">'+_yb.t("checkoutView.redeemCoupons")+'</div>\n                            <div class="yb-coupon-useCancel">'+_yb.t("modal.cancel")+'</div>\n                        </div> \n                        <div class="yb-coupon-usebody">\n                            <div class="yb-coupon-input">\n                                <input type="number" placeholder="'+_yb.t("checkoutView.pleaseEnterCouponCode")+'" />\n                            </div>\n                            <div class="yb-coupon-confirm">'+_yb.t("checkoutView.redeem")+"</div>\n                        </div> \n                    </div>\n                "))},laodCouponsToView:function(e){var t=[];if(0<e.length)for(var i in e){var o=e[i];t.push('<label class="yb-actionsheet-item weui-cell weui-check__label" for="x',o.Code,'">'),t.push('<div class="weui-cell__hd">'),t.push('<div class="yb-actionsheet-title">',o.Name,"<span>",o.amount?o.amount:"","</span></div>"),t.push('<div class="yb-actionsheet-text">',o.Description,"</div>"),t.push("</div>"),t.push('<div class="weui-cell__ft yb-actionsheet-origin">'),t.push('<input type="checkbox" name="couponName" data-cname="',o.Name,'"  data-cuid="',o.TxtUId,'"  data-code="',o.Code,'" class="weui-check" id="x',o.Code,'" ',o.isChecked?'checked="checked"':"",">"),t.push('<i class="weui-icon-checked"></i>'),t.push("</div>"),t.push("</label>")}else t.push('\n                <div class="yb-couponWarning">                    \n                    <img src="//imgw.pospal.cn/we/westroe/img/icons/coupon_null.png" class="yb-searchWarning_img"> <p class="yb-searchWarning_title">'+_yb.t("checkoutView.noCoupons")+"</p></div>\n                ");k("#couponSelects .yb-actionsheet-list",this.viewContainer).html(t.join(""))},createPaymethodView:function(e){var t=[],i=[];if(console.log("paymethods",e),e.IsValet&&e.EnableAfterPayMethod)i.push({Name:"代客支付",Code:10,displayName:_yb.t("checkoutView.payMethondAfterPay10")});else{if(e.EnableAfterPayMethod&&(window.ShowEnableAfterPayMethodName?i.push({Name:window.ShowEnableAfterPayMethodName,Code:10,displayName:window.ShowEnableAfterPayMethodName}):i.push({Name:"预先下单",Code:10,displayName:_yb.t("checkoutView.payMethondAfterPay")})),e.EnableWxPayMethod&&i.push({Name:"微信支付",Code:4,displayName:_yb.t("checkoutView.payMethondWechat")}),e.EnableCashPayMethod&&i.push({Name:"当面付款",Code:1,displayName:_yb.t("checkoutView.payMethondCash")}),e.EnableAliPayMethod&&!_yb.isInWechat&&i.push({Name:"支付宝",Code:3,displayName:_yb.t("checkoutView.payMethondAli")}),e.EnableThirdPartyPayMethod&&e.ThirdPartyPayMethods&&0<e.ThirdPartyPayMethods.length)for(var o=0;o<e.ThirdPartyPayMethods.length;o++){var n=e.ThirdPartyPayMethods[o];_yb.isInWechat&&"微信支付"==n.Name?i.push({Name:n.Name,Code:n.Code,displayName:_yb.t("checkoutView.payMethondWechat")}):_yb.isInWechat||"微信支付"==n.Name||"支付宝"!=n.Name?"微信支付"!=n.Name&&"支付宝"!=n.Name&&i.push({Name:n.Name,Code:n.Code,displayName:n.Name}):i.push({Name:n.Name,Code:n.Code,displayName:_yb.t("checkoutView.payMethondAli")})}if(e.EnableCustomerBalancePayMethod){var a=_yb.t("checkoutView.payMethondCustomer");window.CUSTOMBALANCEPAYNAME&&(a=window.CUSTOMBALANCEPAYNAME),e.IsCustomer?a+='<span class="yb-paymethod-cb">（'+(window.CUSTOMBALANCEPAYNAME_TXT?window.CUSTOMBALANCEPAYNAME_TXT:_yb.t("checkoutView.customerBalance"))+"："+e.CustomerBalance+_yb.t("common.priceUnit")+"）</span>":a+='<span class="yb-paymethod-cb">'+_yb.t("checkoutView.unLogin")+"</span>",i.push({Name:"会员余额",Code:2,displayName:a})}}for(var o in i){var s=i[o];s.iconUrl=this.config.paymentodsIconUrls[s.Name]?this.config.paymentodsIconUrls[s.Name].url:"//imgw.pospal.cn/we/weidian/img/payicons/payAo@2x.png";var r=' \n                    <label class="yb-paymethod-item weui-cells_checkbox " for="pay'+s.Code+'">\n                        <div class="yb-paymethod-head">\n                            <img src="'+s.iconUrl+'" alt="">\n                        </div>\n                        <div class="yb-paymethod-body">\n                            <div class="yb-paymethod-name">'+s.displayName+"</div>\n                            "+(2==s.Code&&_yb.isInWechat?'<div class="yb-charge-rules"> </div>':"")+'\n                        </div>\n                        <div class="yb-paymethod-foot  yb-actionsheet-origin">\n                            <input type="radio" name="paymethodName" data-code="'+s.Code+'"  data-name="'+s.Name+'"  id="pay'+s.Code+'" class="weui-check">\n                            <i class="weui-icon-checked"></i>\n                        </div>\n                    </label>';2==s.Code&&_yb.isInWechat&&(r='<div class="yb-charge-list willBeRich" id="UseBalance" >\n                        '+r+'\n                        <div class="yb-charge-info"> \n                            <button class="yb-charge-btn">'+_yb.t("checkoutView.recharge")+'</button>\n                            <div class="yb-charge-rules"> </div>\n                        </div> \n                    </div>'),t.push(r)}0==i.length&&t.push('<div  class="yb-paymethod-item" > <div class="yb-paymethod-head">  <img src="//imgw.pospal.cn/we/weidian/img/icons/paymentNull.png" alt=""></div>                <div class="yb-paymethod-body"> <div class="yb-paymethod-name">',_yb.t("checkout.onlinePaymentUnsupport"),"</div></div>                </div>"),k("#paymethodList",this.viewContainer).html(t.join(""))},createPointView:function(e){var i=this;if("string"==typeof e)this.orderService.getApplyPointInfo(e,function(e){var t=e.result;0<t.AppliedMoneyFromCustomerPoint&&k("#YBCustomerPoint",i.viewContainer).show().find(".weui-cell__bd").html("<div> "+_yb.t("checkoutView.canUse")+'<span class="yb-integral-sum">'+t.AppliedCustomerPoint+"</span>"+_yb.t("checkoutView.integralUse")+'<span class="yb-integral-price">'+t.AppliedMoneyFromCustomerPoint+"</span>"+_yb.t("common.priceUnit")+"</div>")});else{var t=e;t.AppliedMoneyFromCustomerPoint||0<t.AppliedMoneyFromCustomerPoint?(this.beforePoint={AppliedCustomerPoint:t.AppliedCustomerPoint,AppliedMoneyFromCustomerPoint:t.AppliedMoneyFromCustomerPoint},k("#YBCustomerPoint",this.viewContainer).show().find(".weui-cell__bd").html("<div> "+_yb.t("checkoutView.canUse")+'<span class="yb-integral-sum">'+t.AppliedCustomerPoint+"</span>"+_yb.t("checkoutView.integralUse")+'<span class="yb-integral-price">'+t.AppliedMoneyFromCustomerPoint+"</span>"+_yb.t("common.priceUnit")+"</div>")):k("#YBCustomerPoint",this.viewContainer).hide()}},createAllItems:function(e,t){var i=[];for(var o in e.CartOrderItems)if(null!=e.CartOrderItems[o][0].packageSerial){var n=e.CartOrderItems[o],a=0,s=[];for(var r in i.push('<div class="weui-cell yb-checkout-cont yb-cell-noDowmLine ">'),i.push('<div class="weui-cell__hd ">'),i.push('<img class="yb-checkout-img" src="',n[0].packageImg,'" alt="">'),i.push("</div>"),i.push('<div class="weui-cell__bd"><div>'),i.push('<span class="yb-checkout-name">',n[0].packageName,"</span>"),n){a+=n[r].subTotal;var c=n[r].productName;if(n[r].cartItemAttributes&&0<n[r].cartItemAttributes.length)for(var d in n[r].cartItemAttributes){c+="("+(h=n[r].cartItemAttributes[d]).attributeName+")"}s.push(c+"x"+n[r].productNum)}var u=[].concat(_toConsumableArray(new Set(s)));i.push('<span class="yb-checkout-attrs">',u.join(",  "),"</span>"),i.push('</div><div class="yb-checkout-Num">x',n[0].packageNum,"</div>"),i.push("</div>"),i.push('<div class="weui-cell__ft">'),i.push('<div class="yb-checkout-price">',_yb.ft_c(a),"</div>"),i.push("</div>"),i.push("</div>")}else{n=e.CartOrderItems[o][0];if(i.push('<div class="weui-cell yb-checkout-cont yb-cell-noDowmLine ">'),i.push('<div class="weui-cell__hd ">'),i.push('<img class="yb-checkout-img" src="',n.imageName,'" alt="">'),i.push("</div>"),i.push('<div class="weui-cell__bd"><div>'),i.push('<span class="yb-checkout-name">',n.productName,"</span>"),n.cartItemAttributes&&0<n.cartItemAttributes.length){var l=[];for(var p in this.makeManySizesAttrs(n,!1,!1)&&this.makeManySizesAttrs(n,!1,l),n.cartItemAttributes){var h=n.cartItemAttributes[p];l.push("["+h.attributeName+"]")}i.push('<span class="yb-checkout-attrs">',l.join(" "),"</span>")}else this.makeManySizesAttrs(n,!1,!1)&&this.makeManySizesAttrs(n,!0,i);n.remark&&i.push('<div class="yb-checkout-remark">',n.remark,"</div>"),i.push('</div><div class="yb-checkout-Num">x',n.productNum,"</div>"),i.push("</div>"),i.push('<div class="weui-cell__ft">');var m=_yb.ft_c(n.productSellPrice*n.productNum),v=_yb.ft_c(n.subTotal);i.push('<div class="yb-checkout-price">',v,"</div>"),m!==v&&i.push('<del class="yb-checkout-origin-price">',m,"</del>"),i.push("</div>"),i.push("</div>")}k("#checkoutItems",this.viewContainer).html(i.join("")),k(".totalCount",this.viewContainer).text(e.TotalCount),k(".totalAmount",this.viewContainer).data("totalamount",e.TotalMoney).text(_yb.ft_c(e.TotalMoney)),this.nullCouponTotalMoney=e.TotalMoney,k(".minAmount",this.viewContainer).text(_yb.ft_c(e.minAmount)),k(".totalSellPrice",this.viewContainer).text(_yb.ft_c(e.sellPriceTotal)),0<e.minAmount?k(".minAmountDiv",this.viewContainer).show():k(".minAmountDiv",this.viewContainer).hide(),e.ShippingFee&&0<e.ShippingFee?(k(".yb-total-postage",this.viewContainer).html("("+_yb.t("checkoutView.asShipping")+"<span>"+_yb.ft_c(e.ShippingFee)+"</span>)"),k(".shippingFeePrice",this.viewContainer).html("("+_yb.t("checkoutView.asShipping")+"<span>"+_yb.ft_c(e.ShippingFee)+"</span>)")):(k(".yb-total-postage",this.viewContainer).html(""),k(".shippingFeePrice",this.viewContainer).html(""))},makeManySizesAttrs:function(e,t,i){var o="";if(e.specifications)o=" ["+e.specifications+"]";else{var n=[];n.push(e.attribute1),n.push(e.attribute2),n.push(e.attribute3),n.push(e.attribute4);for(var a=0;a<n.length;a++){var s=n[a];void 0!==s&&s&&"y"!==s&&"n"!==s&&(o+=" ["+s+"]")}}return""!=o&&(void 0===i||!1===i||void(!0===t?(i.push('<span class="yb-checkout-attrs">'),i.push(o),i.push("</span>")):i.push(o)))},closeActionSheet:function(){k(".yb-page-mask",this.viewContainer).attr("style","opacity: 0; display: none;"),k(".weui-actionsheet",this.viewContainer).removeClass("weui-actionsheet_toggle"),k("#couponSelects",this.viewContainer).removeClass("showCouponInput")},initActionSheet:function(){var n=this;n.viewContainer.on("click","#showCouponSelects",function(){k(".yb-page-mask",n.viewContainer).attr("style","opacity: 1;"),k("#couponSelects",n.viewContainer).addClass("weui-actionsheet_toggle"),0<n.selectCoupons.length&&(k("#couponSelects input[type=checkbox]",n.viewContainer).map(function(){this.checked=!1}),n.selectCoupons.forEach(function(e){k("#couponSelects",n.viewContainer).find("#x"+e)[0].checked=!0}))}),k("#couponSelects",this.viewContainer).on("click",".yb-coupon-addnew",function(){k("#couponSelects",n.viewContainer).addClass("showCouponInput"),k(".yb-coupon-input input",n.viewContainer).focus()}),k("#couponSelects",this.viewContainer).on("click",".yb-coupon-confirm",function(){k(this);if(k(".yb-coupon-addinpunt",n.viewContainer).hasClass("input__in")){var t=k(".yb-coupon-input input",n.viewContainer).val();if(1==n.coupons.filter(function(e){return e.Code==t}).length)return!0!==window.OPENMOERCOUPONSUSE&&k("#couponSelects .yb-actionsheet-item input",n.viewContainer).map(function(){this.checked=!1}),k("#couponSelects  #x"+t,n.viewContainer)[0].checked=!0,void k("#couponSelects",n.viewContainer).removeClass("showCouponInput");k.showLoading(_yb.t("checkoutView.couponsLoading")+"..."),n.orderService.applyCoupon(t,n.isApplyPoint,n.isCustomerPayTxt.split("=")[1],function(e){k.hideLoading(),!1!==e&&(n.coupons.unshift({Code:e.CouponCode,TxtUId:e.CoupoanUid,UId:e.CoupoanUid,Name:e.CouponName,Description:_yb.t("checkoutView.manualCoupon"),iaCash:!1}),n.laodCouponsToView(n.coupons),!0!==window.OPENMOERCOUPONSUSE&&k("#couponSelects .yb-actionsheet-item input",n.viewContainer).map(function(){this.checked=!1}),k("#couponSelects  #x"+t,n.viewContainer)[0].checked=!0,k("#couponSelects",n.viewContainer).removeClass("showCouponInput"),k("#couponSelects .yb-coupon-input input",n.viewContainer).val(""))},!0)}}),k("#couponSelects",this.viewContainer).on("input",".yb-coupon-input input",function(){var e=k(this);5<=String(e.val()).length?k(".yb-coupon-addinpunt",n.viewContainer).addClass("input__in"):k(".yb-coupon-addinpunt",n.viewContainer).removeClass("input__in")}),k("#couponSelects",this.viewContainer).on("click",".yb-coupon-useCancel",function(){k("#couponSelects",n.viewContainer).removeClass("showCouponInput")}),k("#couponSelects",this.viewContainer).on("click",".yb-coupon-close",function(){n.closeActionSheet()}),k("#couponSelects",this.viewContainer).on("click",".yb-actionsheet-item",function(e){e.stopPropagation(),e.preventDefault();var t=k(this).find("input");!0!==window.OPENMOERCOUPONSUSE&&k("#couponSelects .yb-actionsheet-item input",n.viewContainer).map(function(){t.data("code")!=k(this).data("code")&&(this.checked=!1)}),t[0].checked=!t[0].checked}),k(".yb-page-mask",n.viewContainer).on("click",function(){n.closeActionSheet()}),n.viewContainer.on("click","#appliedPoint",function(){var e=Number(k(".yb-integral-price",n.viewContainer).text()),t=Number(k(".totalAmount",n.viewContainer).data("totalamount")),i=t-e;if(i=i<=0?"0":i,n.isApplyPoint=this.checked,!this.checked&&0==n.selectCoupons.length)return k(".totalAmount",n.viewContainer).html(_yb.ft_c(t)),this.checked=!1,void(n.isApplyPoint=this.checked);k.showLoading(_yb.t("checkoutView.checkedIntegral"));var o=this;n.checkedCouponsCanIuse(n.selectCoupons,function(e){0==e.IsPointApplied&&(o.checked=!1,n.isApplyPoint=o.checked)})}),k("#couponSelects .actionsheetConfirm",n.viewContainer).on("click",function(){var e=k("#couponSelects input[type=checkbox]",n.viewContainer).filter(function(){return this.checked}),i=[];e.forEach(function(e,t){i.push(e.dataset.code)});e.map(function(e,t){return t.dataset.cuid});0<i.length?(n.selectCoupons=i,k.showLoading(_yb.t("checkoutView.checkedCoupon")),n.checkedCouponsCanIuse(i)):(n.selectCoupons=[],k(".totalAmount",n.viewContainer).data("totalamount",n.nullCouponTotalMoney).text(_yb.ft_c(n.nullCouponTotalMoney)),k(".yb-checkout-discount",n.viewContainer).html("<span>"+n.AvailablePromotionCouponsShowTxt+"</span>").removeClass("hasCouponNull"),n.beforePoint.AppliedCustomerPoint&&0<n.beforePoint.AppliedCustomerPoint&&n.allowApplyPoint&&(k("#YBCustomerPoint .yb-integral-sum",n.viewContainer).text(n.beforePoint.AppliedCustomerPoint),k("#YBCustomerPoint .yb-integral-price",n.viewContainer).text(n.beforePoint.AppliedMoneyFromCustomerPoint),k("#YBCustomerPoint",this.viewContainer).show()),n.closeActionSheet())}),k("#couponSelects .yb-coupon-cancel",n.viewContainer).on("click",function(){k("#CouponUId",n.viewContainer).val(""),k("#CouponCode",n.viewContainer).val(""),k(".totalAmount",n.viewContainer).data("totalamount",n.nullCouponTotalMoney).text(_yb.ft_c(n.nullCouponTotalMoney)),k(".yb-checkout-discount",n.viewContainer).html("<span>"+n.AvailablePromotionCouponsShowTxt+"</span>"),k("#paymethodSelects input[type=radio]",n.viewContainer).removeAttr("checked"),n.closeActionSheet()})},checkedCouponsCanIuse:function(e,s){var r=this;this.orderService.applyCoupons(e,this.isApplyPoint,this.isCustomerPayTxt.split("=")[1],!1,function(e){if(s&&s(e),r.closeActionSheet(),k.hideLoading(),!1===e)return r.selectCoupons=[],void k("#couponSelects input[type=checkbox]",r.viewContainer).forEach(function(e){e.checked=!1});var t=e.result;r.chargeRulesShow(t.TotalMoney,t.ShoppingCardMoney);var i="",o=t.InvalidCouponCodes;if(o&&0<o.length){var n="";r.coupons.filter(function(e){return 0<=o.indexOf(e.Code)}).forEach(function(e,t){k('#couponSelects input[data-code="'+e.Code+'"]',r.viewContainer)[0].checked=!1,n='<div style="text-align: left;font-size:0.7rem">'+_yb.t("checkoutView.couponName")+"："+e.Name+' <div style="font-size:0.5rem">'+_yb.t("checkoutView.couponNum")+e.Code+";</div></div>"+n}),o.forEach(function(e){var t=r.selectCoupons.indexOf(e);0<=t&&r.selectCoupons.splice(t,1)}),k.toast.prototype.defaults.duration=3e3,k.toast('<div style=" white-space: nowrap;margin-bottom: 0.5rem;">'+_yb.t("checkoutView.unUseCouponList")+"</div>"+n,"text")}t.ShippingFee&&0<t.ShippingFee&&(i="("+_yb.t("checkoutView.asShipping")+"<span>"+_yb.ft_c(t.ShippingFee)+"</span>)"),t.AppliedCustomerPoint&&0<t.AppliedCustomerPoint&&r.allowApplyPoint?(k("#YBCustomerPoint .yb-integral-sum",r.viewContainer).text(t.AppliedCustomerPoint),k("#YBCustomerPoint .yb-integral-price",r.viewContainer).text(t.AppliedMoneyFromCustomerPoint),k("#YBCustomerPoint",r.viewContainer).show()):0==t.AppliedCustomerPoint&&k("#YBCustomerPoint",r.viewContainer).hide(),k(".yb-total-postage",r.viewContainer).html(i),k(".shippingFeePrice",r.viewContainer).html(i),k(".totalAmount",self.viewContainer).text(_yb.ft_c(t.TotalMoney));var a=r.coupons.filter(function(e){return 0<=r.selectCoupons.indexOf(e.Code)}).map(function(e){return e.Name}).join("; ");a&&k(".yb-checkout-discount",self.viewContainer).html("<span>"+a+"</span>").addClass("hasCouponNull")})},initPayment:function(){var c=this;k("#confirmPay",c.viewContainer).click(function(){if(c.loaded&&!c.isPaying&&!k(this).hasClass("confirmPayNull")){if(0<k(".yb-orde-time",c.viewContainer).find("input[checked]").length)if(""==k(".yb-orde-time",c.viewContainer).find("#OrderTime").text())return void k.alert({text:_yb.t("checkoutView.appointmentTimeNull"),onOK:function(){}});if(c.withinShipping)if("无法配送"!=k("#OrderTime",c.viewContainer).text())if(c.hasMinAmount){if("AddressQRCode_zz"==c.checkoutMode||"SelfOrdering_zz"==c.checkoutMode)if(""==k("#CustomerAddress",c.viewContainer).text())return void k.alert({text:_yb.t("checkoutView.pleaseFallTalbeNum"),onOK:function(){k("#TableNumber").focus()}});if(-1!=c.checkoutMode.indexOf("selftake")||this.hasTimeSelfTake){var e=k("#OrderDayTime",c.viewContainer).text(),t=k("#OrderHourTime",c.viewContainer).text(),i=k("#TakeoutPhoneNumber",c.viewContainer),o=i.val();if(0<i.length){for(var n=String(o),a=!(6<n.length&&n.length<13),s=0;s<n.length;s++){var r=n[s];if(-1=="0123456789-+".indexOf(r)){a=!0;break}}if(a)return void k.alert({text:_yb.t("addressView.pleaseEnterTheCorrectPhone"),onOK:function(){i.focus()}});k("#CustomerPhoneNum",c.viewContainer).text(o)}if(""==e||""==t)return void k.alert({text:_yb.t("checkoutView.timeIsMandatory"),onOK:function(){}})}k.confirm({title:_yb.t("checkout.confirmOrder"),onOK:function(){c.loaded&&!c.isPaying&&c.doPayment()},onCancel:function(){}})}else k.alert({text:_yb.t("checkoutView.overShippingPrice"),onOK:function(){}});else k.alert({text:_yb.t("checkoutView.selectAppointmentTime"),onOK:function(){}});else k.alert({text:_yb.t("checkoutView.overShippingAddress"),onOK:function(){}})}})},bindEventAll:function(){var d=this;k(".yb-checkoutModeList",d.viewContainer).on("click",".yb-edibleWay",function(e){var t=k(this),i=t.data("mode"),o=k("input[type=radio]",".yb-edibleWay");if(!(o.length<=1)){var n=d.checkoutMode.split("_")[0],a=d.checkoutMode.split("_")[1],s=d.config.mode[n][a];o.removeAttr("checked"),t.find("input").attr("checked","true"),k.showLoading(_yb.t("common.processing"));for(var r=0;r<s.length;r++){if((n=s[r]).modeDataName==i){if(k("#OtherComment",d.viewContainer).text(n.name),"RegularOrder"==d.m&&k("#OrderAppointmentTime").attr("placeholder",_yb.t("checkoutView.orderAppointmentTimeNow")+_yb.t("checkoutView.takefoodtype."+n.idName)),k(".yb-checkoutModeList",d.viewContainer).data("customordertime"))var c="";else c=d.regularTime?"-"+d.regularTime:"";d.doCheckout(n.modeData+c,d.orderView);break}}}}),k("body").on("click",".yb-picker-order-time .yb-cancel-picker",function(){k.closePicker(function(){k("#OrderAppointmentTime",d.viewContainer).val(""),k("#OrderTime",d.viewContainer).text("")})}),d.viewContainer.on("change","#TableNumber",function(e){var t=e.target.value;k("#CustomerAddress",d.viewContainer).text(t)});var i=d.orderService.getQueryString("domain");i||(i=window.location.href.split(".")[0].split("//")[1]),d.viewContainer.on("click",".yb-charge-btn",function(e){var t=new Date;t.setHours(t.getHours()+1),d.setCookieItem("chargeorderretrundomain",i,t,"/","pospal.cn"),window.location.href="/m/accountv4?redirect=recharge&domain="+i});var o="/m/accountv4?domain="+i+"&returnurl="+encodeURIComponent("/m/order?tmpl=1&domain="+i);d.viewContainer.on("change",".yb-paymethod-item",function(e){e.stopPropagation(),e.preventDefault();var t=k(this).find("input").data("code"),i=k(this).find("input");i[0].checked=!0,k("#confirmPay",this.viewContainer).removeClass("confirmPayNull"),2!=t||d.isCustomer||k.confirm({text:_yb.t("checkoutView.pleaseLogin"),onOK:function(){window.location.href=o},onCancel:function(){k("#confirmPay",this.viewContainer).addClass("confirmPayNull"),i[0].checked=!1}}),!0===d.CustomerBalanceConsume&&(2==t?(d.isCustomerPayTxt="checkPayMethod=CustomerBalance",d.doCheckout("checkPayMethod=CustomerBalance","",!0)):"checkPayMethod=Cash"!=d.isCustomerPayTxt&&(d.isCustomerPayTxt="checkPayMethod=Cash",d.doCheckout("checkPayMethod=Cash","",!0)))}),k(window).on("recommendDoSure",function(e,t){t&&d.once();var i=k("#TableNumber");0<i.length&&0==String(i.val()).length&&k("#TableNumber").focus(),d.recommendOnce=!1})},selectCustomerBalance:function(e){var t=k(".yb-paymethod-item #pay2",this.viewContainer);(this.customerBalance>=e||this.CustomerBalanceConsume)&&this.isCustomer&&0<t.length?(k(".yb-paymethod-item input",this.viewContainer).removeAttr("checked"),t.attr("checked","checked")):this.isCustomer?(k(".yb-paymethod-item input",this.viewContainer).removeAttr("checked"),k(k(".yb-paymethod-item input",this.viewContainer)[0]).attr("checked","checked")):k("#confirmPay",this.viewContainer).addClass("confirmPayNull")},chargeRulesShow:function(e,t){var i=this;if(_yb.isInWechat){var o=this.customerBalance;this.orderView&&this.orderView.ApplyShoppingCard&&(o+=t);var n=e<=o,a=k("#UseBalance",this.viewContainer);a.addClass("willBeRich").find(".yb-paymethod-cb").html("("+_yb.t("checkoutView.balance")+this.customerBalance+")"),n?a.removeClass("willBeRich"):a.find(".yb-paymethod-cb").html("("+_yb.t("checkoutView.notEnough")+"："+this.customerBalance+")"),this.orderService.loadChargeRules(function(e){if(!1!==e&&0<e.chargeRules.length){var t=e.chargeRules.map(function(e){if(e.StartDate){var t=new Date(e.StartDate.split("-").join("/"));if(+new Date<+t)return""}return""+_yb.t("checkoutView.toUp")+Number(e.ChargeAmount)+_yb.t("checkoutView.giveAs")+e.GiftDesc+"  "});n&&k(".yb-charge-rules",i.viewContainer).show(),k(".yb-charge-rules",i.viewContainer).html(t.join(""))}else k(".yb-charge-rules",i.viewContainer).hide()})}},setCookieItem:function(e,t,i,o,n,a){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var s="";if(i)switch(i.constructor){case Number:s=i===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+i;break;case String:s="; expires="+i;break;case Date:s="; expires="+i.toUTCString()}return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+s+(n?"; domain="+n:"")+(o?"; path="+o:"")+(a?"; secure":""),!0},laodStoreList:function(){var o=this;_yb.isInWechat?wx.getLocation({success:function(e){var t=e.latitude,i=e.longitude;o.loadStores(t,i)},fail:function(e){console.log("fail res what is_",e),k.alert("需要授权地址："+e.errMsg||JSON.stringify(e)),o.loadStores()},complete:function(e){console.log("completa  res  what is ",e)}}):this.loadStores(),this.viewContainer.on("click",".yb-select-store-list",function(e){o.showStoresLsitView()})},loadStores:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";this.orderService.loadStoreList({latitude:e,longitude:i},function(e){e&&e.successed&&(t.nearStoreList=e.data.stores.map(function(e){return e.DistanceInKmTxt=e.DistanceInKm?e.DistanceInKm+"KM":_yb.t("checkoutView.unknown"),e}),t.selectStore=t.nearStoreList[0],t.createStoreInfo())})},createStoreInfo:function(){var e=k(".yb-select-store-list",this.viewContainer);k(".store-name",e).text(this.selectStore.StoreName),k(".store-address",e).text(this.selectStore.Address),k(".yb-cell__ft",e).text(this.selectStore.DistanceInKmTxt)},createStoreList:function(e){return e.map(function(e,t){return'<label class="yb-near-item  weui-cells_checkbox " for="store_'+e.StoreId+'" >\n                <input type="radio" class="weui-check" name="store-list" id="store_'+e.StoreId+'"  data-idx="'+t+'" '+(0==t?'checked="checked"':"")+'>\n                <i class="weui-icon-checked"></i>\n                    <div class="yb-shop-info">\n                        <div class="yb-shop-name">'+e.StoreName+'</div>\n                        <div class="yb-shop-addr">'+e.Address+'</div>\n                    </div>\n                    <div class="yb-shop-distance">'+e.DistanceInKmTxt+"</div>\n                </label>"}).join("")},showStoresLsitView:function(){var e='\n            <div class="yb-popups-contian weui-dialog " id="StoreListView">\n                <div class="yb-popups-inner">\n                    <div class="yb-popups_hd">\n                        <div class="yb-popups-title">'+_yb.t("checkoutView.storeList")+"</div>\n                        "+(10<this.nearStoreList.length?'<div class="yb-search-input">\n                        <div class="input-contian">\n                            <span class="yb-input-icon"></span>\n                            <input type="text" id="Search" name="">\n                        </div>\n                        <div class="input-cancel">'+_yb.t("modal.cancel")+"</div>\n                    </div>":"")+'\n                    </div>\n                    <div class="yb-popups_bd weui-cells_checkboxs ">\n                        '+this.createStoreList(this.nearStoreList)+'\n                    </div>\n                    <div class="yb-popups_ft">\n                        <div class="store-confirm">'+_yb.t("modal.ok")+"</div>\n                    </div>\n                </div>\n            </div>\n            ";k.openModal(e);var o=k(".yb-popups-contian");k(".weui-mask").click(function(){k.closeModal()});var n=this;k(".store-confirm",o).click(function(){var e=k(".yb-near-item input",o).filter(function(){return this.checked}).data("idx");e&&(n.selectStore=n.nearStoreList[e],n.createStoreInfo()),k.closeModal()}),k(".input-cancel",o).click(function(){k("#Search",o).val(""),k(".yb-popups_bd",o).html(n.createStoreList(n.nearStoreList))}),k("#Search",o).on("input",function(e){var t=e.target.value,i=n.nearStoreList.filter(function(e){return-1!=e.StoreName.indexOf(t)||-1!=e.Address.indexOf(t)});k(".yb-popups_bd",o).html(n.createStoreList(i))})}},i={viewContainer:"#checkoutView",modeObject:_yb.services.checkoutModeObj.modeObject,mode:_yb.services.checkoutModeObj.modeObjectList,paymentodsIconUrls:{"当面付款":{url:"//imgw.pospal.cn/we/westroe/img/payments/bank_pay@2x.png"},"会员余额":{url:"//imgw.pospal.cn/we/westroe/img/payments/balance_pay@2x.png"},"支付宝":{url:"//imgw.pospal.cn/we/westroe/img/payments/ali_pay@2x.png"},"微信支付":{url:"//imgw.pospal.cn/we/westroe/img/payments/wechat_pay@2x.png"},"代客支付":{url:"//imgw.pospal.cn/we/westroe/img/payments/after_pay@2x.png"}}},t._yb.initCheckoutView=function(e){return new o(e)}}($,window),function(n,o){var i,t=function(e){this.initConfig(e)};t.prototype={initConfig:function(e){var t=this;t.config=n.extend({},i,e),t.viewContainer=n(t.config.viewContainer),t.cartContentView=n("#yb-address-list",t.viewContainer)},refresh:function(){},once:function(){console.log("addresses once");var i=this;n("#confirmAddrSel",i.viewContainer).on("click",function(){if(i.addresses&&0<i.addresses.length){var e=n("input[type=radio]",i.cartContentView).filter(function(){return this.checked}).data("index"),t=i.addresses[0];void 0!==e&&(t=i.addresses[e],i.addrIndexSelected=e),_yb.services.applyAddress&&_yb.services.applyAddress(t),window.location.href="#/default",window.ISADDRESSESPAGEBACKE=!0}});var e=n(".yb-remind-connet",i.viewContainer),t=n(".yb-remind-text",i.viewContainer);0<e.length&&0<t.length&&o._yb.services.checkout.remindTimer(t,e)},before:function(e){console.log("addresses before");var t=this;_yb.apiRequest("/wxapi/CustomerAddress/MyAddresses",{},function(e){e.addresses&&e.addresses.length<=0&&(history.pushState({page:3},_yb.t("checkout.default_title"),"#/default"),window.ISADDRESSESPAGEBACKE=!0,window.location.href="#/address/0"),t.addresses=e.addresses,t.buildView(e)},function(){})},on:function(e){console.log("addresses on")},after:function(e){console.log("addresses after")},buildView:function(e){var i=[],o=this;n.each(e.addresses,function(e,t){i.push('<div class="weui-cell yb-address-item weui-cell_access">'),i.push('<label class="weui-cell__hd weui-check_label" for="addr',t.Id,'">'),void 0!==o.addrIndexSelected?i.push('<input type="radio" class="weui-check" name="customerAddr" data-index="',e,'" id="addr',t.Id,'" ',o.addrIndexSelected==e?'checked="checked"':""," />"):i.push('<input type="radio" class="weui-check" name="customerAddr" data-index="',e,'" id="addr',t.Id,'" ',t.IsDefault?'checked="checked"':""," />"),i.push('<i class="weui-icon-checked"></i>'),i.push("</label>"),i.push('<a class="weui-cell__bd"  href="#/address/',t.Id,'">'),i.push('<div class="yb-address-itemName">',t.Recipient," ",t.Phone,t.IsDefault?"<span> ["+_yb.t("addresses.defaultAddress")+"]</span>":""," </div>"),i.push('<div class="yb-address-itemTitle">',t.Province||"",t.City||"",t.District||""," ",t.Address1||"",t.Address2||"","</div>"),i.push("</a>"),i.push('<a class="weui-cell__ft" href="#/address/',t.Id,'"></div>'),i.push("</a>")}),this.cartContentView.html(i.join(""))}},i={viewContainer:"#addressesView"},o._yb.initAddressesView=function(e){return new t(e)}}($,window),function(u,n){var i,t=function(e){this.initConfig(e)};t.prototype={initConfig:function(e){var t=this;t.config=u.extend({},i,e),t.viewContainer=u(t.config.viewContainer),t.cartContentView=u(".yb-order-content",t.viewContainer),this.noLogin=!1,this.overSeaUesr=!1,window.ISOPENTENGXUMAPADDRESS=!0,this.isLoadMap=!1,u("#btnConfirm",t.viewContainer).click(function(){t.saveAddress()}),u("#btnDelete",t.viewContainer).click(function(){t.removeAddress()})},refresh:function(){},once:function(){var o=this;console.log("address once");var c=this;u.showLoading(),_yb.services.checkout.getStoreData(function(e){u.hideLoading(),e.data&&!0===e.data.IsOtherCountry&&(o.overSeaUesr=!0),o.cityPickerFn(),o.overSeaUesr||(u(".yb-newAddres-add_hd").click(function(){u("input",c.viewContainer).blur(),u("textarea",c.viewContainer).blur()}),!0===window.ISOPENTENGXUMAPADDRESS&&(u("#txtDistrict",o.viewContainer).click(function(){window.location.href=" #/addressMap"}),window.addEventListener("message",function(e){var t=e.data;if(t&&"locationPicker"==t.module){console.log("location",t);var o=t.poiaddress,n=t.poiname,a=o,s=n;if("我的位置"==n)return void c.latlngToAddress(t.latlng,function(e){if(e&&e.address&&(o=e.address,n=""),0<=o.indexOf("区")){var t=o.indexOf("区");a=o.substring(0,t+1),s=o.substring(t+1)+" "+n}else if(0<=o.indexOf("市")){var i=o.indexOf("市");a=o.substring(0,i+1),s=o.substring(i+1)+" "+n}u("#txtDistrict").val(a),u("#txtAddress1").val(s),window.YB_AutoAddressBack=!0,window.history.back()});if(0<=o.indexOf("区")){var i=o.indexOf("区");a=o.substring(0,i+1),s=o.substring(i+1)+" "+n}else if(0<=o.indexOf("市")){var r=o.indexOf("市");a=o.substring(0,r+1),s=o.substring(r+1)+" "+n}u("#txtDistrict").val(a),u("#txtAddress1").val(s),window.YB_AutoAddressBack=!0,window.history.back()}},!1)));var t=u(".yb-remind-connet",o.viewContainer),i=u(".yb-remind-text",o.viewContainer);0<t.length&&0<i.length&&n._yb.services.checkout.remindTimer(i,t)})},latlngToAddress:function(e,t){_yb.apiRequest("/wxapi/order/LngLatToAddress",{latitude:e.lat,longitude:e.lng},function(e){t&&t(e)},function(){t&&t(!1)})},before:function(){console.log("address before")},on:function(e){console.log("address on, id=",e),this.addressId=e;!0!==window.YB_AutoAddressBack?("noLogin"==e?(this.noLogin=!0,u("#btnDelete",this.viewContainer).hide(),u(".yb-newAddres-bd",this.viewContainer).hide(),this.lookupAddressByWx()):"auto"==e?u("#chkDefault")[0].checked=!1:_yb.apiRequest("/wxapi/CustomerAddress/FindAddress/"+e,{},function(e){if(e.address){var t=e.address;u("#txtRecipient").val(t.Recipient||""),u("#txtPhone").val(t.Phone||""),u("#txtDistrict").val(t.District||""),u("#txtAddress1").val(t.Address1||""),u("#chkDefault")[0].checked=t.IsDefault}},function(){}),0===Number(e)?(u("#txtRecipient").val(""),u("#txtPhone").val(""),u("#txtDistrict").val(""),u("#txtAddress1").val(""),u("#chkDefault")[0].checked=!1,this.lookupAddressByWx()):this.laodMapSrc()):window.YB_AutoAddressBack=!1},after:function(e){console.log("address after")},selectDistrict:function(){},saveAddress:function(){console.log("add address");for(var e=u("#txtRecipient").val(),t=u("#txtPhone").val(),i=u("#txtDistrict").val(),o=u("#txtAddress1").val(),n=u("#chkDefault")[0].checked,a=String(t),s=!(6<a.length&&a.length<13),r=0;r<a.length;r++){var c=a[r];if(-1=="0123456789-+".indexOf(c)){s=!0;break}}if(s)u.alert({text:_yb.t("addressView.pleaseEnterTheCorrectPhone")});else if(e&&t&&i&&o)if(this.noLogin){var d={Recipient:e,Phone:t,District:i,Address1:o};_yb.services.applyAddress(d,this.noLogin),window.ISADDRESSESPAGEBACKE=!0,window.history.back()}else this.doSaveAddress(e,t,i,o,n);else u.alert({text:_yb.t("addressView.pleaseFillInSuccessAddress")})},doSaveAddress:function(e,t,i,o,n){u.showLoading(_yb.t("common.processing")),this.addressId&&0<this.addressId?_yb.apiRequest("/wxapi/CustomerAddress/UpdateAddress",{Id:this.addressId,Recipient:e,Phone:t,District:i,Address1:o,IsDefault:n},function(e){u.hideLoading(),window.location.href="#/addresses"},function(){u.hideLoading()}):_yb.apiRequest("/wxapi/CustomerAddress/AddAddress",{Recipient:e,Phone:t,District:i,Address1:o,IsDefault:n},function(e){u.hideLoading(),window.location.href="#/addresses"},function(){u.hideLoading()})},cityPickerFn:function(){_yb.wxConfigSuccess||this.overSeaUesr||!0===window.ISOPENTENGXUMAPADDRESS?this.overSeaUesr&&(u(".yb-newAddres-hd",this.viewContainer).find(".weui-cell_access").removeClass("weui-cell_access"),u("#txtDistrict",this.viewContainer).attr("placeholder",_yb.t("addressView.pleaseFillInAddress")).css("text-align","left")):u("#txtDistrict").cityPicker({title:_yb.t("addressView.pleaseSelectDeliveryAddress")})},removeAddress:function(){u.showLoading(_yb.t("common.processing")),_yb.apiRequest("/wxapi/CustomerAddress/RemoveAddress",{Id:this.addressId},function(e){u.hideLoading(),window.location.href="#/addresses"},function(){u.hideLoading()})},lookupAddressByWx:function(){var o=this;_yb.wxConfigSuccess?wx.getLocation({success:function(e){var t=e.latitude,i=e.longitude;o.coordObj={latitude:t,longitude:i},o.getAddressByQQmap(t,i),o.laodMapSrc(t+","+i)},fail:function(e){u.hideLoading(),o.cityPickerFn(),o.laodMapSrc()},complete:function(e){console.log("completa getlocation res what is ",e)}}):o.laodMapSrc()},getAddressByQQmap:function(e,t){var n=this;if("undefined"!=typeof qq&&void 0!==qq.maps){var i=new qq.maps.Geocoder({complete:function(e){if(u.hideLoading(),console.log("results map..",e),e){var t={"重庆市":"重庆","北京市":"北京","上海市":"上海","天津市":"天津"},i=[];if(e.detail&&e.detail.addressComponents){var o=e.detail.addressComponents;t[o.province]?i.push(t[o.province]):i.push(o.province),i.push(o.city),i.push(o.district),u("#txtDistrict").val(i.join(" ")),u("#txtAddress1").val(o.town?o.town:""+o.street?o.street:"")}n.cityPickerFn()}else n.cityPickerFn()},error:function(e){u.hideLoading(),n.cityPickerFn()}}),o=new qq.maps.LatLng(e,t);i.getAddress(o)}else n.cityPickerFn()},laodMapSrc:function(e){var o=this;if(!this.isLoadMap){var n=e?"&coordtype=1&coord="+e:"",a=this;this.isLoadMap=!0,_yb.services.checkout.getMapKey(function(e){var t=e.split("|"),i="https://apis.map.qq.com/tools/locpicker?type=1&key="+t[0]+"&referer="+t[1]+n;0==u("#QQMAPSCRIPT").length&&(window.QQMAPYBinit=function(){if(void 0!==a.coordObj){var e=a.coordObj,t=e.latitude,i=e.longitude;a.getAddressByQQmap(t,i)}},_yb.services.checkout.getMapKey(function(e){var t=document.createElement("script");t.type="text/javascript",t.id="QQMAPSCRIPT",t.src="//map.qq.com/api/js?v=2.exp&callback=QQMAPYBinit&key="+e.split("|")[0],t.onerror=null,document.head.appendChild(t)})),o.createIframe(i,function(e){console.log("加载成功"),u.hideLoading(),o.isLoadMap=!0},function(e){o.isLoadMap=!1,u("#addressAutoListview").html(""),console.log("30s..加载失败"),u.hideLoading()})})}},createIframe:function(e,t,i){var o=setTimeout(function(){clearTimeout(o),i.apply(this,arguments)},3e4),n=document.createElement("iframe");return n.id="mapPage",n.width="100%",n.height="100%",n.frameborder=0,n.src=e,n.attachEvent?n.attachEvent("onload",function(){clearTimeout(o),t.apply(this,arguments)}):n.onload=function(){clearTimeout(o),t.apply(this,arguments)},document.querySelector("#addressAutoListview").appendChild(n),n}},i={viewContainer:"#addressView"},n._yb.initAddressView=function(e){return new t(e)}}($,window),function(n,i){var o,t=function(e){this.initConfig(e)};t.prototype={initConfig:function(e){var t=this;t.config=n.extend({},o,e),t.viewContainer=n(t.config.viewContainer),t.orderService=i._yb.initCheckoutService(),t.city="",t.province=""},once:function(e){console.log("addressAuto once")},before:function(){var o=this;console.log("addressAuto before"),0==n("#mapPage").lenth&&(n.showLaoding(),_yb.services.checkout.getMapKey(function(e){n.hideLoading();var t=e.split("|"),i="https://apis.map.qq.com/tools/locpicker?type=1&key="+t[0]+"&referer="+t[1];o.createIframe(i,function(e){console.log("加载成功"),n.hideLoading()},function(e){console.log("30s..加载失败"),n.hideLoading()})}))},on:function(e){},after:function(e){console.log("addressAuto after")},createIframe:function(e,t,i){var o=setTimeout(function(){clearTimeout(o),i.apply(this,arguments)},3e4),n=document.createElement("iframe");return n.id="mapPage",n.width="100%",n.height="100%",n.frameborder=0,n.src=e,n.attachEvent?n.attachEvent("onload",function(){clearTimeout(o),t.apply(this,arguments)}):n.onload=function(){clearTimeout(o),t.apply(this,arguments)},document.querySelector("#addressAutoListview").appendChild(n),n}},o={viewContainer:"#addressAutoListview"},i._yb.initAddressAutoView=function(e){return new t(e)}}($,window);