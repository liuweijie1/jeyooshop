"use strict";
var _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ?
function(t) {
	return typeof t
} : function(t) {
	return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t
};

function initApp(o, t) {
	var e, i, a, s, n, r;
	_yb.initStoreService(), e = _yb.initCartService(), _yb.initProductsService(), a = _yb.initShoppingView({
		shoppingCart: e
	}), i = _yb.initCartView({
		shoppingCart: e
	}), s = _yb.initDetailsView({
		shoppingCart: e
	}), _yb.initAttrView({
		shoppingCart: e
	}), _yb.initTasteView({
		shoppingCart: e
	}), n = _yb.initCategoriesView({
		shoppingCart: e
	}), r = _yb.initPackagesView({
		shoppingCart: e
	});
	var c = Router({
		"/home": {
			once: function() {
				a.once()
			},
			before: function() {
				a.before()
			},
			on: function() {
				a.on()
			},
			after: function() {
				a.after()
			}
		},
		"/category/:id": {
			before: function(t) {
				a.beforeCategory(decodeURIComponent(t))
			},
			on: function(t) {
				a.onCategory(decodeURIComponent(t))
			},
			after: function() {
				a.afterCategory()
			}
		},
		"/search": {
			before: function() {
				a.beforeSearch()
			},
			on: function() {
				a.onSearch()
			},
			after: function() {
				a.afterSearch()
			}
		},
		"/details/:pid": {
			once: function() {
				s.once()
			},
			before: function(t) {
				s.before(t)
			},
			on: function(t) {
				s.on(t)
			},
			after: function() {
				s.after()
			}
		},
		"/cart": {
			once: function() {
				i.once()
			},
			before: function() {
				i.before()
			},
			on: function() {
				i.on()
			},
			after: function() {
				i.after()
			}
		},
		"/categories": {
			once: function() {
				n.once()
			},
			before: function() {
				n.before()
			},
			on: function() {
				n.on()
			},
			after: function() {
				n.after()
			}
		},
		"/packages/:pid/:edit": {
			once: function() {
				r.once()
			},
			before: function(t, e) {
				r.before(t, e)
			},
			on: function(t, e) {
				r.on(t, e)
			},
			after: function(t, e) {
				r.after(t, e)
			}
		}
	});
	c.configure({
		before: function(t, e, i) {
			var a = this.getRoute(0);
			switch (console.log("allroutes", a), a) {
			case "home":
				document.title = "绾夸笂鍟嗗煄";
				break;
			case "category":
				a = "home", document.title = "鍒嗙被";
				break;
			case "details":
				document.title = "浜у搧璇︽儏";
				break;
			case "search":
				a = "home", document.title = "鎼滅储";
				break;
			case "cart":
				document.title = "璐墿";
				break;
			case "categories":
				document.title = "鍏ㄩ儴鍒嗙被";
				break;
			case "packages":
				document.title = "濂楅閫夋嫨"
			}
			var s, n = o(".yb-page");
			(s = n.filter('[data-route="' + a + '"]')).length && (n.hide(), s.show())
		}
	}), -1 != window.location.href.indexOf("?wechatdenied=") && o.alert("寰簵鏈紑閫氾紝璇疯仈绯诲鏈?", function() {}), _yb.services.store.loadInfo(function(i) {
		if (i) {
			var t = o(".yb-header-tpl");
			t.find(".yb-store-name").text(i.CompanyName), i.StoreLogo.endsWith("/") || t.find(".yb-logo").attr("src", i.StoreLogo), i.RemindMessage && void 0 === window.YB_REMINDMESSAGE && (window.YB_REMINDMESSAGE = i.RemindMessage), i.DaySeq && o.alert('<span class="yb-JQalert-mun">' + i.DaySeq + "</span>", "鎮ㄧ殑鍙栭鍙?", function() {}), !1 === i.isWeChatShop && o.alert("寰俊搴楅摵鏈紑閫氾紝璇疯仈绯诲鏈?", function() {});
			window.IsOpenRepeatedlySyncShopCart = 0 <= ["鎵瑰彂琛屼笟"].indexOf(i.Industry), _yb.services.store.handleBizClosed()
		}
		_yb.isInWechat && _yb.services.store.loadWxConfig(function(t) {
			!1 !== t && (wx.config({
				debug: !1,
				appId: t.appId,
				url: t.url,
				timestamp: t.timestamp,
				nonceStr: t.nonceStr,
				signature: t.signature,
				jsApiList: ["onMenuShareTimeline", "onMenuShareAppMessage", "getLocation"]
			}), wx.ready(function() {
				_yb.wxConfigSuccess = !0, _yb.wxSharing(null), console.log("wx config ready")
			}), wx.error(function(t) {
				console.log("wx config err", t)
			}), _yb.wxSharing = function(t) {
				if (!0 === _yb.wxConfigSuccess) if (t) {
					var e = t.name;
					t.description && (e = e + ": " + t.description), wx.onMenuShareTimeline({
						title: t.name,
						desc: t.description,
						link: i.StoreBaseUrl + "m/product/detail/" + t.id,
						imgUrl: t.defaultproductimage.imagepath,
						success: function() {
							o.alert("鎴愬姛鍒嗕韩鍒版湅鍙嬪湀!", "鍒嗕韩鎻愮ず")
						},
						cancel: function() {
							o.alert("鏈兘鍒嗕韩鍒版湅鍙嬪湀!", "鍒嗕韩鎻愮ず")
						},
						fail: function(t) {}
					}), wx.onMenuShareAppMessage({
						title: t.name,
						desc: t.description,
						link: i.StoreBaseUrl + "m/product/detail/" + t.id,
						imgUrl: t.defaultproductimage.imagepath,
						success: function() {
							o.alert("鎴愬姛鍒嗕韩鍒版湅鍙嬪湀!", "鍒嗕韩鎻愮ず")
						},
						cancel: function() {
							o.alert("鏈兘鍒嗕韩鍒版湅鍙嬪湀!", "鍒嗕韩鎻愮ず")
						},
						fail: function(t) {}
					})
				} else wx.onMenuShareTimeline({
					title: i.CompanyName,
					desc: "娉ㄥ唽浼氬憳璧㈠ソ绀?",
					link: i.StoreBaseUrl + "m",
					imgUrl: i.StoreLogo,
					success: function() {
						o.alert("鎴愬姛鍒嗕韩鍒版湅鍙嬪湀!", "鍒嗕韩鎻愮ず")
					},
					cancel: function() {
						o.alert("鏈兘鍒嗕韩鍒版湅鍙嬪湀!", "鍒嗕韩鎻愮ず")
					},
					fail: function(t) {}
				}), wx.onMenuShareAppMessage({
					title: i.CompanyName,
					desc: "娉ㄥ唽浼氬憳璧㈠ソ绀?",
					link: i.StoreBaseUrl + "m",
					imgUrl: i.StoreLogo,
					type: "link",
					dataUrl: "",
					success: function() {
						o.alert("鎴愬姛鍒嗕韩缁欐湅鍙嬶紒", "鍒嗕韩鎻愮ず")
					},
					cancel: function() {
						o.alert("鎮ㄥ凡鍙栨秷鍒嗕韩缁欐湅鍙嬶紒", "鍒嗕韩鎻愮ず")
					}
				})
			})
		}), c.init(window.DefaultRoute || "/home")
	})
}!
function(a, t) {
	var e, i, s = function(t) {
			this.initConfig(t)
		};
	s.prototype = {
		initConfig: function(t) {
			this.config = a.extend({}, e, t), this.storeData = null, this.wxClientConfig = null
		},
		loadInfo: function(e) {
			var i = this;
			null === i.storeData ? a.ajax({
				url: this.config.storeInfoUrl,
				headers: {
					PSPLVISITORAUTO: "YES"
				},
				type: "POST",
				async: !0,
				success: function(t) {
					t && t.data ? i.storeData = t.data : i.storeData = !1, e && e(i.storeData)
				}
			}) : e && e(i.storeData)
		},
		loadBanners: function(e, i) {
			this.loadInfo(function(t) {
				if (i) if (t.Banners) {
					if (!e) return i(t.Banners), t.Banners;
					i(t.Banners.filter(function(t) {
						return -1 !== t.Name.indexOf(e)
					}))
				} else i(!1)
			})
		},
		loadWxConfig: function(e) {
			var i = this;
			null === i.wxClientConfig ? a.ajax({
				url: this.config.wxConfigUrl,
				headers: {
					PSPLVISITORAUTO: "YES"
				},
				type: "POST",
				async: !0,
				success: function(t) {
					t && t.data ? i.wxClientConfig = t.data : i.wxClientConfig = !1, e && e(i.wxClientConfig)
				}
			}) : e && e(i.wxClientConfig)
		},
		handleBizClosed: function(t) {
			if (this.storeData.IsBizClosed) return a.alert("闈炶惀涓氭椂闂翠笉鍙笅鍗?!"), !0
		}
	}, e = {
		storeInfoUrl: "/wxapi/store/GetStoreData",
		wxConfigUrl: "/wxapi/store/WxApiConfig"
	}, _yb.initStoreService = function(t) {
		return i = new s(t), _yb.services.store = i
	}
}($, window), function(n, i) {
	var a, e, s = function(t) {
			this.initConfig(t)
		};
	s.prototype = {
		initConfig: function(t) {
			var e = this;
			e.config = n.extend({}, a, t), e.items = [], e.cacheItems = [], e.editItems = [], e.eventHandlers = [], e.needSync = !0, e.loaded = !1, n(i).bind("beforeunload", function() {
				e.syncCart()
			})
		},
		loadOnce: function(t) {
			console.log("load once", this.loaded), this.loaded ? (this.notify("reload"), t && t()) : this.doLoad(t)
		},
		load: function(t) {
			console.log("load", this.needSync), this.needSync ? this.doLoad(t) : (this.notify("reload"), t && t())
		},
		doLoad: function(t) {
			var e = this;
			e.loaded = !0, this.syncCart(function() {
				e.notify("reload"), t && t()
			})
		},
		subscribe: function(t) {
			this.eventHandlers.indexOf(t) < 0 && this.eventHandlers.push(t)
		},
		unsubscribe: function(t) {
			var e = this.eventHandlers.indexOf(t);
			0 <= e && this.eventHandlers.splice(e, 1)
		},
		notify: function(e, i, a) {
			this.eventHandlers.forEach(function(t) {
				t(this, e, i, a)
			}, this)
		},
		_add: function(t, e, i, a, s) {
			a || (a = []);
			var n = {
				ProductId: t,
				ProductName: e,
				SellPrice: i,
				ProductNum: 1,
				Specifications: s,
				CartItemAttributes: a
			};
			return this.items.push(n), this.needSync = !0, n
		},
		_updateNum: function(t, e) {
			t && t.ProductNum != e && (t.ProductNum = e, this.needSync = !0)
		},
		_remove: function(t) {
			for (var e = this.items.length; e--;) this.items[e] === t && (this.items.splice(e, 1), this.needSync = !0)
		},
		removeById: function(t, e, i) {
			var a = this.findItemsById(t);
			for (var s in a) {
				var n = a[s];
				0 < n.ProductNum && (n.ProductNum = 0, this.needSync = !0)
			}
			e || this.syncCart(i, !1)
		},
		getEditItems: function() {
			return this.cacheItems = this.editItems, this.notify("editCombo", this.cacheItems), this.editItems
		},
		chooseData: function(t) {
			var e = this.appendCombos();
			console.log("changeCombos", e);
			for (var i = 0; i < e.length; i++) {
				var a = e[i];
				null != a[0].PackageSerial && a[0].PackageSerial == t && 0 < a[0].PackageUnitNum && (this.editItems = a)
			}
		},
		appendCombos: function() {
			for (var t = [], e = [], i = 0; i < this.items.length; i++) null != this.items[i].PackageSerial && void 0 !== this.items[i + 1] && this.items[i].PackageSerial == this.items[i + 1].PackageSerial ? e.push(this.items[i]) : (e.push(this.items[i]), t.push(e.slice(0)), e.length = 0);
			return t
		},
		find: function(t, e) {
			if (!t) return this.appendCombos();
			for (var i = 0; i < this.items.length; i++) {
				var a = this.items[i];
				if (null != a.PackageSerial) s = !1;
				else if (a.ProductId == t) {
					var s = !0;
					if (e && 0 < e.length) if (a.CartItemAttributes && a.CartItemAttributes.length == e.length) {
						for (var n = 0; n < e.length; n++) if (e[n].txtproductAttributeUid != a.CartItemAttributes[n].txtproductAttributeUid) {
							s = !1;
							break
						}
					} else s = !1;
					else s = !(a.CartItemAttributes && 0 < a.CartItemAttributes.length);
					if (s) return a
				}
			}
			return null
		},
		findItemsById: function(t) {
			for (var e = [], i = 0; i < this.items.length; i++) {
				var a = this.items[i];
				null == a.PackageSerial && a.ProductId == t && a.ProductNum && 0 < a.ProductNum && e.push(a)
			}
			return e
		},
		add: function(t, e, i, a, s, n, o) {
			var r = this.find(t, a);
			return r ? this._updateNum(r, r.ProductNum + 1) : r = this._add(t, e, i, a, o), s || this.syncCart(n, !1), this.notify("add", r), r
		},
		addWithNum: function(t, e, i, a, s, n, o, r) {
			var c = this.find(t, s);
			return c ? this._updateNum(c, c.ProductNum + e) : (c = this._add(t, i, a, s, r), this._updateNum(c, e)), n || this.syncCart(o, !1), this.notify("add", c), c
		},
		minus: function(t, e, i) {
			var a = this.find(t);
			return a && 0 < a.ProductNum && (this._updateNum(a, a.ProductNum - 1), e || this.syncCart(i, !1), this.notify("minus", a)), a
		},
		minusWithNum: function(t, e, i, a) {
			var s = this.find(t);
			return s && 0 < s.ProductNum && (s.ProductNum > e ? this._updateNum(s, s.ProductNum - e) : this._updateNum(s, 0), i || this.syncCart(a, !1), this.notify("minus", s)), s
		},
		update: function(t, e, i, a, s, n, o, r) {
			var c = this.find(t);
			c || (c = this._add(t, i, a, s, r)), this._updateNum(c, e), n || this.syncCart(o, !1), this.notify("update", c)
		},
		clear: function(t) {
			this.items = [], this.needSync = !0, this.syncCart(t, !1), this.notify("reload")
		},
		summary: function() {
			for (var t, e = this.appendCombos(), i = 0, a = 0, s = 0, n = 0; n < e.length; n++) null != (t = e[n])[0].PackageSerial ? (i = t[0].PackageNum, s += t[0].PackageNum, a += t[0].PackageNum * t[0].PackagePrice) : (s += i = t[0].ProductNum, a += i * this.totalPrice(t[0]));
			return a = Number(a).toFixed(2), {
				amount: a = parseInt(100 * a, 10) / 100,
				quantity: s
			}
		},
		totalPrice: function(t, e) {
			var i = 1 == e ? 0 : t.SellPrice;
			if (0 < t.CartItemAttributes.length) {
				for (var a = 0, s = t.CartItemAttributes, n = 0; n < s.length; n++) s[n].attributeValue && (a += Number(s[n].attributeValue));
				i += a
			}
			return i
		},
		findByIdx: function(t) {
			return this.items[t]
		},
		addByCartIdx: function(t, e, i) {
			var a = this.appendCombos()[t][0];
			return a && null == a.PackageSerial && (this._updateNum(a, a.ProductNum + 1), e && this.syncCart(i, !1), this.notify("add", a, t)), a
		},
		addCombosByCartIdx: function(t, e, i) {
			var a = this.appendCombos()[t];
			for (var s in a) this.updateCombosNum(a[s], a[s].PackageNum + 1);
			return this.syncCart(i, !1), this.notify("add", a, t), a
		},
		addByCartIdxWithNum: function(t, e, i, a) {
			var s = this.appendCombos()[t][0];
			return s && null == s.PackageSerial && (this._updateNum(s, s.PackageUnitNum + e), i && this.syncCart(a, !1), this.notify("add", s, t)), s
		},
		minusByCartIdx: function(t, e, i) {
			var a = this.appendCombos()[t][0];
			return a && null == a.PackageSerial && 0 < a.ProductNum && (this._updateNum(a, a.ProductNum - 1), e && this.syncCart(i, !1), this.notify("minus", a, t)), a
		},
		minusCombosByCartIdx: function(t, e, i) {
			var a = this.appendCombos()[t];
			for (var s in a) this.updateCombosNum(a[s], a[s].PackageNum - 1);
			this.syncCart(i, !1), this.notify("minus", a, t)
		},
		minusByCartIdxWithNum: function(t, e, i, a) {
			var s = this.appendCombos()[t][0];
			return s && null == s.PackageSerial && 0 < s.ProductNum && (s.ProductNum > e ? this._updateNum(s, s.ProductNum - e) : this._updateNum(s, 0), i && this.syncCart(a, !1), this.notify("minus", s, t)), s
		},
		updateByCartIdx: function(t, e, i, a) {
			var s = this.items[t];
			return s && (this._updateNum(s, e), i && this.syncCart(a, !1), this.notify("update", s, t)), s
		},
		updateCombosByCartIdx: function(t, e, i, a) {
			var s = this.appendCombos()[t];
			for (var n in s) this.updateCombosNum(s[n], e);
			this.syncCart(a, !1), this.notify("update", s, t)
		},
		syncCart: function(e, t) {
			var i = this;
			if (i.needSync) {
				void 0 === t && (t = !0), console.log("shopcartItems", this.items);
				var a = JSON.stringify(this.items);
				i.needSync = !1, _yb.apiRequest(i.config.syncUrl, {
					isMerge: t,
					shopcartItems: a
				}, function(t) {
					t && t.Success ? (i.items = n.parseJSON(t.Result), i.message = t.Message, i.message && n.alert(i.message), e && e(i.items, i.message)) : (i.needSync = !0, e && e(!1))
				}, function() {
					i.needSync = !0, e && e(!1)
				})
			} else e && e(i.items)
		},
		goto: function() {
			n.showLoading("鏁版嵁鍔犺浇涓?..");
			var t = this;
			this.syncCart(function() {
				window.location = t.config.cartPageUrl, setTimeout(function() {
					n.hideLoading()
				}, 500)
			})
		},
		gotoOrderPage: function() {
			n.showLoading("鏁版嵁鍔犺浇涓?..");
			var s = this;
			this.syncCart(function(t) {
				for (var e = [], i = 0; i < t.length; i++) {
					var a = t[i];
					a.MinQuantity && a.MinQuantity > a.ProductTotalNum && e.push(a.ProductName)
				}
				0 < e.length ? n.alert("瀛樺湪鏁伴噺鏈揪璧峰敭閲忕殑鍟嗗搧" + e.join(","), function() {
					window.location = s.config.cartPageUrl
				}) : window.location = s.config.orderPageUrl, setTimeout(function() {
					n.hideLoading()
				}, 500)
			})
		},
		updateCombosNum: function(t, e) {
			t && (0 == e ? (t.ProductNum = e, t.PackageNum = e) : t.ProductNum = t.PackageUnitNum * e, t.PackageNum = e, this.needSync = !0)
		},
		deleteCombos: function(t) {
			var e = -1,
				i = !1;
			for (var a in this.items) this.items[a].PackageSerial == t && 0 == i && (e = a, i = !0);
			for (var s = this.items.length; s--;) this.items[s].PackageSerial == t && this.items.splice(s, 1);
			return console.log("deleteCombos", this.items), -1 != e && e
		},
		updateCombos: function(t, e) {
			for (var i = this, a = this.deleteCombos(e), s = t.length - 1; 0 <= s; s--) this.items.splice(a, 0, t[s]);
			this.needSync = !0, this.syncCart(function() {
				i.notify("reload"), location.replace("#/cart")
			}, !1)
		},
		addCombos: function(t) {
			var e = this;
			for (var i in t) this.items.push(t[i]);
			console.log(this.items), this.needSync = !0, this.syncCart(function() {
				e.notify("reload"), location.replace("#/cart")
			})
		},
		combosEmpty: function() {
			this.cacheItems = []
		},
		combosClear: function(t) {
			for (var e = this.cacheItems.length; e--;) this.cacheItems[e].ProductId == t && this.cacheItems.splice(e, 1)
		},
		combosAdd: function(t, e, i, a, s, n, o) {
			if (void 0 === o && (o = 1), 0 == n) this.notify("updateCombo", this.cacheItems, t);
			else {
				s || (s = []);
				var r = {
					ProductId: t.toString(),
					ProductName: e,
					SellPrice: 0,
					ProductSellPrice: i,
					markupPrice: a,
					ProductNum: n * o,
					CartItemAttributes: s,
					PackageUnitNum: n
				};
				this.cacheItems.push(r)
			}
			return this.notify("updateCombo", this.cacheItems, t), r
		},
		combosMinus: function(t, e) {
			if ("minus" != e) {
				var i = [];
				for (var a in this.cacheItems) this.cacheItems[a].ProductId == t && i.push(a);
				1 < this.cacheItems[i[i.length - 1]].PackageUnitNum ? this.cacheItems[i[i.length - 1]].PackageUnitNum-- : this.cacheItems.splice(i[i.length - 1], 1)
			} else {
				var s = this.combosFind(t);
				!1 !== s && (1 < this.cacheItems[s].PackageUnitNum ? this.cacheItems[s].PackageUnitNum-- : this.cacheItems.splice(s, 1))
			}
			this.notify("updateCombo", this.cacheItems, t)
		},
		combosFind: function(t) {
			for (var e = 0; e < this.cacheItems.length; e++) {
				if (this.cacheItems[e].ProductId == t) return e
			}
			return !1
		}
	}, a = {
		syncUrl: "/wxapi/shopcart/syncshopcart",
		cartPageUrl: "#/cart",
		orderPageUrl: YB_ORDERPAGEURL
	}, _yb.initCartService = function(t) {
		return e = new s(t), _yb.services.cart = e
	}
}($, window), function(d, t) {
	var e, i, a = function(t) {
			this.initConfig(t), this.productsCache = {}
		};
	a.prototype = {
		initConfig: function(t) {
			this.config = d.extend({}, e, t)
		},
		search: function(t, e) {
			var i = t.categoryUids || "",
				a = t.pageIdx || 0,
				s = t.keywords || "",
				n = t.size || 20,
				o = t.tags || "",
				r = t.categories || "",
				c = t.isSeries || !0;
			d.ajax({
				url: this.config.searchUrl,
				type: "POST",
				data: {
					key: s,
					cUids: i,
					pageIdx: a,
					tags: o,
					categories: r,
					size: n,
					ignoreCart: !0,
					isSeries: c
				},
				async: !0,
				global: !1,
				success: function(t) {
					e && e(t)
				}
			})
		},
		findAll: function(t, e) {
			t = t || {}, d.ajax({
				url: this.config.findAllUrl,
				type: "POST",
				data: {
					isMultiCategory: t.isMultiCategory || !1,
					includeAttributes: t.includeAttributes || !1,
					includeAllProducts: t.includeAllProducts || !1,
					includeAllImages: t.includeAllImages || !1,
					isSeries: t.isSeries || !1,
					includeHotSale: t.includeHotSale || !0,
					includeCombo: t.includeCombo || !0,
					includeGroupSale: t.includeGroupSale || !0,
					includeBargainSale: t.includeBargainSale || !0,
					size: t.size || 50
				},
				async: !0,
				global: !1,
				success: function(t) {
					e && e(t)
				}
			})
		},
		findBannerProducts: function(t, e) {
			d.ajax({
				url: this.config.bannerUrl,
				type: "POST",
				data: {
					bannerId: t
				},
				async: !0,
				global: !1,
				success: function(t) {
					e && e(t)
				}
			})
		},
		loadDetails: function(t, e) {
			d.ajax({
				url: this.config.detailsUrl,
				type: "POST",
				data: {
					id: t
				},
				async: !0,
				success: function(t) {
					e && e(t)
				}
			})
		},
		loadSeriesProduct: function(t, e) {
			var i = {}; - 1 != t.indexOf("-") ? i.barcode = t : i.spu = t, d.ajax({
				url: this.config.barcodeUrl,
				type: "POST",
				data: i,
				async: !0,
				success: function(t) {
					e && e(t)
				}
			})
		},
		checkAttr: function(e, i, a) {
			var s = this;
			s.productsCache[e] ? i && i(s.productsCache[e].hasAttr) : (a || d.showLoading("璇风◢鍚?..."), d.ajax({
				url: this.config.checkAttrUrl,
				type: "POST",
				data: {
					id: e
				},
				async: !0,
				success: function(t) {
					i && (s.productsCache[e] = {
						hasAttr: t.data
					}, i(t.data))
				},
				complete: function(t) {
					a || d.hideLoading()
				}
			}))
		},
		findAvailableCoupons: function(e) {
			_yb.apiRequest(this.config.findCoupons, {}, function(t) {
				t ? e && e(t) : e(!1)
			}, function(t) {
				e && e(!1)
			})
		},
		loadCombo: function(t, e) {
			_yb.apiRequest(this.config.loadComboAttr, {
				id: t
			}, function(t) {
				t ? e && e(t) : e(!1)
			}, function(t) {
				e && e(!1)
			})
		},
		getFreeCoupons: function(t, e) {
			if ("object" == (void 0 === t ? "undefined" : _typeof(t))) t = t.join(",");
			_yb.apiRequest(this.config.getFreeCoupons, {
				cids: t
			}, function(t) {
				t ? e && e(t) : e(!1)
			}, function(t) {
				e && e(!1)
			})
		},
		loadGroupList: function(t, e) {
			d.showLoading(), d.ajax({
				url: this.config.groupListurl,
				type: "POST",
				data: t,
				async: !0,
				success: function(t) {
					t.Success ? e && e(t) : t.NeedLogin ? d.alert("璇峰厛鐧诲叆浼氬憳", function() {
						window.location.href = "/m/accountv3"
					}) : d.alert(t.Message)
				},
				complete: function(t) {
					d.hideLoading()
				}
			})
		},
		loadBargainList: function(t, e) {
			d.showLoading(), d.ajax({
				url: this.config.bargainListUrl,
				type: "POST",
				data: t,
				async: !0,
				success: function(t) {
					t.Success || t.successed ? e && e(t) : 200 == t.errorCode ? d.alert("璇峰厛鐧诲叆浼氬憳", function() {
						window.location.href = "/m/accountv3"
					}) : d.alert(t.Message || t.message)
				},
				complete: function(t) {
					d.hideLoading()
				}
			})
		},
		findLoginInfo: function(e) {
			d.ajax({
				url: this.config.findLoginInfoUrl,
				type: "POST",
				async: !0,
				global: !1,
				success: function(t) {
					e && e(t)
				},
				complete: function(t) {}
			})
		}
	}, e = {
		searchUrl: "/wxapi/product/ListMulti",
		detailsUrl: "/wxapi/product/Attributes",
		bannerUrl: "/wxapi/product/ListBanner",
		findAllUrl: "/wxapi/product/categories",
		barcodeUrl: "/wxapi/product/ListSeries",
		checkAttrUrl: "/wxapi/product/HasAttributesById",
		loadComboAttr: "/wxapi/product/combo",
		findCoupons: "/wxapi/Coupon/FindAvailableCoupons",
		getFreeCoupons: "/wxapi/MemberCouponProduct/SendFreeCoupons",
		groupListurl: "/wxapi/GroupPurchase/GrouppurchaseRules",
		bargainListUrl: "/wxapi/Bargain/LoadData",
		findLoginInfoUrl: "/wxapi/CustomerAccount/FindLoginInfo"
	}, _yb.initProductsService = function(t) {
		return i = new a(t), _yb.services.products = i
	}
}($, window), function(o, t) {
	var r = null,
		e = {
			configCart: function() {
				var n = this;
				n.shoppingCart = n.config.shoppingCart, n.cartEventHandler = n.cartEventHandler.bind(n), n.movesc = o(n.config.movesc), n.movescbox = o(n.config.movescbox), n.cartContainer = o(n.config.cartContainer, n.viewContainer), n.cartMiniView = o(n.config.cartMiniView, n.viewContainer), n.cartQty = o(".yb-cart-qty", n.cartMiniView), n.cartAmount = o(".yb-cart-money", n.cartMiniView), n.viewContainer.on("click", ".yb-cart-operate", function(t) {
					t.stopPropagation(), t.preventDefault();
					var e = o(this),
						i = e.data("uid");
					if (e.data("isseries")) location.href = " #/details/" + i;
					else if (i) {
						var a = e.data("price"),
							s = o(t.target);
						s.hasClass("yb-cart-add") ? _yb.services.products.checkAttr(i, function(t) {
							"1" === t ? _yb.views.selectAttr.open(i) : (o.toast("鍔犲叆璐墿杞?", 500), n.shoppingCart.add(i, "", a, [], !1))
						}) : s.hasClass("yb-item-plus") ? n.shoppingCart.add(i, "", a, [], !0) : s.hasClass("yb-item-minus") ? n.shoppingCart.minus(i) : s.hasClass("yb-cart-remove_home") && _yb.services.products.checkAttr(i, function(t) {
							"1" != t ? n.shoppingCart.minus(i) : o.confirm({
								title: "鎻愮ず",
								text: "鏄惁鍒拌喘鐗╄溅鎿嶄綔",
								onOK: function() {
									window.location.hash = "#/cart"
								},
								onCancel: function() {}
							})
						})
					}
				}), n.viewContainer.on("change", ".qval", function(t, e) {
					var i = o(this),
						a = parseFloat(i.val(), 10);
					if (0 <= a && ($c = i.parent(".yb-cart-operate"), e = $c.data("uid"))) {
						var s = $c.attr("p_price");
						n.shoppingCart.update(e, a, "", s)
					}
				}), o(n.config.orderLink, n.viewContainer).on("click", function(t) {
					return t.stopPropagation(), t.preventDefault(), 0 == n.shoppingCart.find().length ? o.alert("褰撳墠璐墿杞︿负绌猴紒") : (o.showLoading("鏁版嵁鍔犺浇涓?"), n.shoppingCart.syncCart(function() {
						setTimeout(function() {
							o.hideLoading()
						}, 2e3), window.location = n.config.orderPageUrl
					})), !1
				})
			},
			animateAddingCart: function(t, e) {
				null !== r && clearTimeout(r);
				var i = t.offset(),
					a = this.cartMiniView.offset(),
					s = this.movesc,
					n = this.movescbox,
					o = this.cartContainer;
				s.css("left", i.left + "px"), n.css("top", i.top + "px").addClass("do"), r = setTimeout(function() {
					s.css("left", a.left + 5 + "px"), n.css("top", a.top + 18 + "px"), r = setTimeout(function() {
						n.removeClass("do"), o.removeClass("yb-cart-empty").addClass("yb-cart-has"), e && e(), r = null
					}, 610)
				}, 5)
			},
			cartEventHandler: function(t, e, i) {
				switch (e) {
				case "reload":
					this.updateAllItems();
					break;
				case "add":
				case "minus":
				case "update":
					this.updateItem(i)
				}
				this.updateSummary(t.summary())
			},
			updateSummary: function(t) {
				(0 == this.cartContainer.length || this.cartMiniView && 0 == this.cartMiniView.length) && (this.cartContainer = o(this.config.cartContainer, this.viewContainer), this.cartMiniView = o(this.config.cartMiniView, this.viewContainer), this.cartQty = o(".yb-cart-qty", this.cartMiniView), this.cartAmount = o(".yb-cart-money", this.cartMiniView)), this.cartQty.text(t.quantity), this.cartAmount.text(_yb.ft_c(t.amount)), 0 == t.quantity ? this.cartContainer.removeClass("yb-cart-has").addClass("yb-cart-empty") : this.cartContainer.removeClass("yb-cart-empty").addClass("yb-cart-has")
			},
			updateItem: function(t, e) {
				var i;
				(console.log("shoppingCartFns"), 1 == e) ? 0 < (i = o("[p_uid='" + t.PackageId + "']", this.viewContainer)).length && (o("input.yb-item-qty", i).val(t.PackageNum), t.PackageTotalNum ? (o("input.yb-item-qtys", i).val(t.PackageTotalNum), t.PackageNum > t.PackageTotalNum && o("input.yb-item-qtys", i).val(t.PackageNum)) : o("input.yb-item-qtys", i).val(t.PackageNum), 0 < t.PackageNum ? i.removeClass("yb-item-empty").addClass("yb-item-has") : i.removeClass("yb-item-has").addClass("yb-item-empty")) : 0 < (i = o("[p_uid='" + t.ProductId + "']", this.viewContainer)).length && (o("input.yb-item-qty", i).val(t.ProductNum), t.ProductTotalNum ? (o("input.yb-item-qtys", i).val(t.ProductTotalNum), t.ProductNum > t.ProductTotalNum && o("input.yb-item-qtys", i).val(t.ProductNum)) : o("input.yb-item-qtys", i).val(t.ProductNum), 0 < t.ProductNum ? i.removeClass("yb-item-empty").addClass("yb-item-has") : i.removeClass("yb-item-has").addClass("yb-item-empty"))
			},
			updateAllItems: function() {
				console.log("shoppingCartFns");
				var t = this.shoppingCart.find();
				0 == t.length && t && (o(".yb-item", ".yb-shopping").removeClass("yb-item-has"), o(".yb-item", "#categoriesView").removeClass("yb-item-has"));
				for (var e = 0; e < t.length; e++) {
					var i = t[e];
					null != i[0].PackageSerial ? this.updateItem(i[0], !0) : this.updateItem(i[0])
				}
			}
		};
	_yb.mixins.ShoppingCartFns = e
}($, window), function(i, a) {
	var s, n = null;

	function o(t, e, i, a) {
		var s = this;
		this.id = setTimeout(function() {
			i(), _yb.services.products.search({
				keywords: t,
				size: 50
			}, function(t) {
				s.cleared || a(t)
			})
		}, e)
	}
	o.prototype = {
		id: null,
		cleared: !1,
		clear: function() {
			clearTimeout(this.id), this.cleared = !0, this.id = null
		}
	};
	var t = {
		configSearch: function(t) {
			var e = this;
			e.keywords = "", e.searchView = i(e.config.searchView || s.searchView, e.viewContainer), e.searchResult = i(e.config.searchResult || s.searchResult, e.searchView), e.tplSearch = i.t7.compile(this.config.tplSearch || s.tplSearch), i(".yb-search-cancel", e.searchView).on("click", function() {
				console.log("search cancel"), e.handleSearch(""), a.history.back()
			}), i(".yb-search-clear", e.searchView).on("click", function() {
				console.log("search clear"), e.handleSearch("")
			}), i(".yb-search-input", e.searchView).on("blur", function() {}).on("input", function() {
				e.handleSearch(this.value)
			})
		},
		beforeSearch: function() {
			console.log("search before"), this.viewContainer.removeClass("yb-search-off").addClass("yb-search-on"), this.shoppingCart.subscribe(this.cartEventHandler), this.shoppingCart.loadOnce()
		},
		onSearch: function() {
			console.log("search on"), this.viewContainer.find(".weui-search-bar").addClass("weui-search-bar_focusing").find("input").focus()
		},
		afterSearch: function() {
			console.log("search after"), this.viewContainer.removeClass("yb-search-on").addClass("yb-search-off"), this.shoppingCart.unsubscribe(this.cartEventHandler)
		},
		handleSearch: function(e) {
			var t = 50;
			null !== n && (n.clear(), t = 500);
			var i = this;
			if (!e || 0 == e.length) return i.searchResult.empty(), void(n = null);
			n = new o(e, t, function() {
				i.searchResult.html(i.config.loadIndicator)
			}, function(t) {
				i.renderSearch(t, e), n = null
			})
		},
		renderSearch: function(t, e) {
			this.keywords = e, console.log("search result", t);
			for (var i = 0; i < t.data.length; i++) {
				var a = t.data[i];
				a.isHasSeries = -1 != a.barcode.indexOf("-") && a.productSeries, a.isHasSeries && a.productSeries && (a.productsSeriesLength = a.productSeries.length + 1), a.isHasUnitName = !! a.unitName, a.isHasUnitName && (a.unitName = "/" + a.unitName)
			}
			this.searchResult.html(this.tplSearch(t))
		}
	};
	s = {
		searchLink: ".yb-search-lnk",
		searchView: ".yb-search",
		searchResult: ".yb-search-result",
		tplSearch: '{{#data}}            <div class="yb-product" p_uid="{{id}}">                <div class="yb-product-inner">                    <div class="yb-product__hd">                        <a class="yb-product-photo" href="#/details/{{id}}">                            <img src="{{defaultproductimage.imagepath}}" onerror="_yb.errProdImg(this)"/>                        </a>                    </div>                    <div class="yb-product__bd">                        <div class="yb-product-title">{{productDisplayName}}</div>                        <div class="yb-product-desc">{{description}}</div>                    </div>                    <div class="yb-product__ft">                        <div class="yb-product-price">{{ft_c sellPrice}} {{#if isHasUnitName}}<span class="yb-product-unit">{{unitName}}</span>{{/if}}{{#if hasDiscount}}<del>{{ft_c productOriginalPrice}}</del>{{#if isHasUnitName}}<span class="yb-product-unit">{{unitName}}</span>{{/if}}{{/if}}</div>                        <div class="yb-cart-operate" data-uid="{{id}}" {{#if isHasSeries}} data-isSeries="true" {{/if}} data-price="{{sellPrice}}"><span class="yb-cart-add"></span></div>                        {{#if isHasSeries}} <span class="yb-product-series">鍏? {{productsSeriesLength}} 娆?</span> {{/if}}                    </div>                </div>            </div>            {{/data}}'
	}, _yb.mixins.ShoppingSearchFns = t
}($, window), function(a, t) {
	var i, e = {
		configCategory: function(t) {
			var e = this;
			e.categoryView = a(e.config.categoryView || i.categoryView, e.viewContainer), e.categoryResult = a(e.config.categoryResult || i.categoryResult, e.categoryView), e.tplCategory = a.t7.compile(this.config.tplCategory || i.tplCategory)
		},
		beforeCategory: function(t) {
			0 == t.indexOf("banner_") || 0 == t.indexOf("bannerw_") ? this.viewContainer.find(".yb-category-name").text("鐑崠") : 0 == t.indexOf("wide_") || 0 == t.indexOf("wtag_") ? this.viewContainer.find(".yb-category-name").text(t.substring(5)) : 0 == t.indexOf("all_s") || this.viewContainer.find(".yb-category-name").text(t), this.viewContainer.removeClass("yb-category-off").addClass("yb-category-on"), this.shoppingCart.subscribe(this.cartEventHandler), this.shoppingCart.loadOnce()
		},
		onCategory: function(e) {
			console.log("category on");
			var i = this;
			i.categoryResult.html(_yb.views.loadIndicator), 0 == e.indexOf("banner_") ? _yb.services.products.findBannerProducts(e.substring(7), function(t) {
				i.renderCategory(t, e)
			}) : 0 == e.indexOf("bannerw_") ? _yb.services.products.findBannerProducts(e.substring(8), function(t) {
				a.each(t.data, function(t, e) {
					e.defaultproductimage && e.defaultproductimage.imagepath && (e.defaultproductimage.imagepath = e.defaultproductimage.imagepath.replace("_200x200", "_640x640"))
				}), i.renderCategory(t, e)
			}) : 0 == e.indexOf("wide_") ? _yb.services.products.search({
				categories: e.substring(5),
				size: 30
			}, function(t) {
				a.each(t.data, function(t, e) {
					e.defaultproductimage && e.defaultproductimage.imagepath && (e.defaultproductimage.imagepath = e.defaultproductimage.imagepath.replace("_200x200", "_640x640"))
				}), t.className = "yb-products-wide", i.renderCategory(t, e.substring(5))
			}) : 0 == e.indexOf("wtag_") ? _yb.services.products.search({
				tags: e.substring(5),
				size: 30
			}, function(t) {
				a.each(t.data, function(t, e) {
					e.defaultproductimage && e.defaultproductimage.imagepath && (e.defaultproductimage.imagepath = e.defaultproductimage.imagepath.replace("_200x200", "_640x640"))
				}), t.className = "yb-products-wide", i.renderCategory(t, e.substring(5))
			}) : 0 == e.indexOf("all_s") ? _yb.services.products.findAll({}, function(t) {
				tepData = t, i.innerTp(), bindEvent()
			}) : _yb.services.products.search({
				categories: e,
				size: 30
			}, function(t) {
				i.renderCategory(t, e)
			})
		},
		afterCategory: function() {
			console.log("category after"), this.viewContainer.removeClass("yb-category-on").addClass("yb-category-off"), this.shoppingCart.unsubscribe(this.cartEventHandler)
		},
		renderCategory: function(t, e) {
			for (var i = 0; i < t.data.length; i++) {
				var a = t.data[i];
				a.isHasSeries = !! (a.productSeries && 0 < a.productSeries.length), a.isHasSeries && (a.productsSeriesLength = a.productSeries.length + 1), a.isHasUnitName = !! a.unitName, a.isHasUnitName && (a.unitName = "/" + a.unitName)
			}
			this.categoryResult.html(this.tplCategory(t))
		}
	};
	i = {
		categoryLink: ".yb-category-lnk",
		categoryView: ".yb-category",
		categoryResult: ".yb-category-result",
		tplCategory: '<div class="{{className}}">{{#data}}            <div class="yb-product" p_uid="{{id}}">                <div class="yb-product-inner">                    <div class="yb-product__hd">                        <a class="yb-product-photo" href="#/details/{{id}}">                            <img src="{{defaultproductimage.imagepath}}" onerror="_yb.errProdImg(this)"/>                        </a>                        {{#if isOutOfStock}}<div class="yb-outofstock"></div>{{/if}}                    </div>                    <div class="yb-product__bd">                        <div class="yb-product-title">{{productDisplayName}}</div>                        <div class="yb-product-desc">{{description}}</div>                    </div>                    <div class="yb-product__ft">                        <div class="yb-product-price">{{ft_c sellPrice}} {{#if isHasUnitName}}<span class="yb-product-unit">{{unitName}}</span>{{/if}}{{#if hasDiscount}}<del>{{ft_c productOriginalPrice}}</del>{{#if isHasUnitName}}<span class="yb-product-unit">{{unitName}}</span>{{/if}}{{/if}}</div>                        <div class="yb-cart-operate" data-uid="{{id}}" data-price="{{sellPrice}}" {{#if isHasSeries}} data-isSeries="true" {{/if}}>                            {{#if isOutOfStock}}<span class="yb-cart-addDisabled"></span>{{else}}<span class="yb-cart-add"></span>{{/if}}                        </div>                        {{#if isHasSeries}} <span class="yb-product-series">鍏? {{productsSeriesLength}} 娆?</span> {{/if}}                    </div>                </div>            </div>            {{/data}}</div>'
	}, _yb.mixins.CategoryFns = e
}($, window), function(p, t) {
	var i, d, o = {},
		r = {},
		e = function(t) {
			this.initConfig(t)
		};

	function c(t, e, i, a) {
		r[t] || (r[t] = {}), r[t][e] = {
			status: i,
			data: a
		}
	}
	e.prototype = {
		initConfig: function(t) {
			var e = this;
			e.config = p.extend({}, i, t), e.leverAlldata = {}, e.tagsData = "", e.shoppingCart = t.shoppingCart, e.cartEventHandler = e.cartEventHandler.bind(e), e.viewContainer = p(e.config.viewContainer), e.cartContentView = p(".yb-cart-content", e.viewContainer), e.cartQty = p(".yb-cart-qty", e.viewContainer), e.cartAmount = p(".yb-cart-money", e.viewContainer), e.cartContainer = p(".yb-cart-view", e.viewContainer), e.productView = p(".yb-deals_righ .yb-scrollable", e.viewContainer), e.productListView = p(".yb-deals_righ .yb-items", e.viewContainer), e.loadingIndicator = p(".yb-loadingData", e.viewContainer), e.allCategories = [], e.loadCategoryAll()
		},
		once: function() {
			console.log("categoriesView once");
			var r = this;
			p("#categoriesContianer").hasClass("yb-deals_tpl_4") && this.loadAddBanners(), this.imgSize = p(".yb-deals_homeLoad").data("imgSize");
			p(".yb-deals_left").on("click", ".yb-item", function(t) {
				var e = p(this);
				r.itemClickHandler(r, t, this, ""), e.parent().hasClass("yb-items") ? (p(".yb-deals_left .yb-item").removeClass("yb-act").removeClass("yb-act-color"), e.addClass("yb-act").addClass("yb-act-color")) : (p(".yb-deals_left .yb-item").removeClass("yb-act-color"), e.addClass("yb-act-color"))
			}), p("#categoriesContianer").on("click", ".yb-item-sub", function(t) {
				var e = p(this);
				r.itemClickHandler(r, t, this, ""), p(".yb-item-sub").removeClass("yb-item-sub-active"), e.addClass("yb-item-sub-active")
			}), r.viewContainer.on("click", ".yb-cart-operate", function(t) {
				t.stopPropagation(), t.preventDefault();
				var e = p(this),
					i = e.data("uid");
				if (e.data("isseries")) location.href = " #/details/" + i;
				else {
					var a = e.data("iscombo"),
						s = e.data("buybase");
					e.data("minbuy");
					if (a && i) {
						if ((n = p(t.target)).hasClass("yb-cart-add")) return void(location.href = " #/packages/" + i + "/add");
						n.hasClass("yb-cart-remove_home") && p.confirm({
							title: "鎻愮ず",
							text: "鏄惁鍒拌喘鐗╄溅鎿嶄綔",
							onOK: function() {
								window.location.hash = "#/cart"
							},
							onCancel: function() {}
						})
					} else if (i) {
						var n, o = e.data("price");
						(n = p(t.target)).hasClass("yb-cart-add") ? _yb.services.products.checkAttr(i, function(t) {
							"1" === t ? _yb.views.selectAttr.open(i) : (window.IsOpenRepeatedlySyncShopCart || p.toast("鍔犲叆璐墿杞?", 500), s ? r.shoppingCart.addWithNum(i, s, "", o, [], !window.IsOpenRepeatedlySyncShopCart) : r.shoppingCart.add(i, "", o, [], !window.IsOpenRepeatedlySyncShopCart))
						}) : n.hasClass("yb-cart-remove_home") && _yb.services.products.checkAttr(i, function(t) {
							"1" != t ? s ? r.shoppingCart.minusWithNum(i, s) : r.shoppingCart.minus(i) : p.confirm({
								title: "鎻愮ず",
								text: "鏄惁鍒拌喘鐗╄溅鎿嶄綔",
								onOK: function() {
									window.location.hash = "#/cart"
								},
								onCancel: function() {}
							})
						})
					}
				}
			}), r.viewContainer.on("change", ".qval", function(t, e) {
				var i = p(this),
					a = parseFloat(i.val(), 10);
				if (0 <= a && ($c = i.parent(".yb-cart-operate"), e = $c.data("uid"))) {
					var s = $c.attr("p_price");
					r.shoppingCart.update(e, a, "", s)
				}
			}), p(r.config.orderLink, r.viewContainer).on("click", function(t) {
				t.stopPropagation(), t.preventDefault();
				var e = r.shoppingCart.find();
				return !_yb.services.store.handleBizClosed() && (0 == e.length ? (p.alert("褰撳墠璐墿杞︿负绌猴紒"), !1) : void r.shoppingCart.gotoOrderPage())
			});
			var t = p(".ybRemindMssage", r.viewContainer);
			if (0 < t.length && void 0 !== window.YB_REMINDMESSAGE && "" != window.YB_REMINDMESSAGE) {
				t.addClass("yb-remind-message"), t.removeClass("yb-remind-hide").addClass("yb-remind-show");
				var e = [];
				e.push('<div class="yb-remind-connet" >'), e.push('<span class="yb-remind-text"><span class="yb-remind-icons"></span> ', window.YB_REMINDMESSAGE, "</span>"), e.push("</div>"), t.html(e.join(""));
				var i = p(".yb-remind-connet", t),
					a = p(".yb-remind-text", t);
				r.remindTimer(a, i, function() {
					t.removeClass("yb-remind-show").addClass("yb-remind-hide")
				})
			}
			var s, n = p(window),
				o = r.productView,
				c = r.productListView;
			s = n.height() + 100, r.productView.scroll(function() {
				s + o.scrollTop() >= c.height() - n.height() && r.loadProducts(d), console.log("scroll")
			}), r.shoppingCart.doLoad()
		},
		on: function() {
			console.log("categoriesView on"), _yb.wxSharing(null)
		},
		before: function() {
			console.log("categoriesView before"), this.shoppingCart.subscribe(this.cartEventHandler)
		},
		after: function() {
			console.log("categoriesView after"), this.shoppingCart.subscribe(this.cartEventHandler)
		},
		itemClickHandler: function(t, e, i, a) {
			e.stopPropagation(), e.preventDefault();
			var s = p(i);
			if (s.hasClass("yb-item_goGroup")) window.location.href = t.config.groupPageUrl;
			else if (s.hasClass("yb-item_goBargain")) window.location.href = t.config.bargainPageUrl;
			else {
				var n = s.data("cuid");
				if (a !== n) {
					a = n;
					var o = s.data("category");
					t.switchToCategory(n, o)
				}
			}
		},
		cartEventHandler: function(t, e, i) {
			switch (e) {
			case "reload":
				this.updateAllItems();
				break;
			case "add":
			case "minus":
			case "update":
				this.updateItem(i)
			}
			this.updateSummary(t.summary())
		},
		updateSummary: function(t) {
			this.cartQty.text(t.quantity), this.cartAmount.text(_yb.ft_c(t.amount)), 0 == t.quantity ? this.cartContainer.removeClass("yb-cart-has").addClass("yb-cart-empty") : this.cartContainer.removeClass("yb-cart-empty").addClass("yb-cart-has")
		},
		updateItem: function(t) {
			console.log("list");
			var e = p("[p_uid='" + t.ProductId + "']", this.viewContainer);
			console.log(e), 0 < e.length && (p("input.yb-item-qty", e).val(t.ProductNum), t.ProductTotalNum ? (p("input.yb-item-qtys", e).val(t.ProductTotalNum), t.ProductNum > t.ProductTotalNum && p("input.yb-item-qtys", e).val(t.ProductNum)) : p("input.yb-item-qtys", e).val(t.ProductNum), 0 < t.ProductNum ? e.removeClass("yb-item-empty").addClass("yb-item-has") : e.removeClass("yb-item-has").addClass("yb-item-empty"))
		},
		updateAllItems: function() {
			console.log("list");
			var t = this.shoppingCart.find();
			0 == t.length && t && (p(".yb-item", ".yb-shopping").removeClass("yb-item-has"), p(".yb-item", "#categoriesView").removeClass("yb-item-has"));
			for (var e = 0; e < t.length; e++) {
				var i = t[e];
				this.updateItem(i)
			}
		},
		updateCategory: function(t) {
			var e = '[data-cuid="' + t.uid + '"]';
			p(".yb-deals_left .yb-item").removeClass("yb-act");
			var i = p(".yb-deals_left").find(e);
			i.addClass("yb-act");
			e = i.data("cuid");
			var a = i.data("category"),
				s = i.offset().top + i.offset().height - 110;
			p(".yb-deals_left .yb-items", this.viewContainer).scrollTop(s), this.switchToCategory(e, a)
		},
		loadCategoryAll: function() {
			var n = this;
			p.showLoading("姝ｅ湪鍔犺浇"), _yb.services.products.findAll({
				isMultiCategory: !0
			}, function(t) {
				var e = t.categories;
				if (e && 0 == e.length) p.alert("褰撳墠缃戝簵娌℃湁鍙樉绀虹殑鍟嗗搧锛岃鑱旂郴瀹㈡湇銆?");
				else {
					n.categeroyToView(e);
					for (var i = (n.allCategories = e)[0].CategoryUidTxt, a = e[0].DisplayName, s = 0; s < e.length; s++) if ("15" != e[s].CategoryUidTxt && "16" != e[s].CategoryUidTxt) {
						i = e[s].CategoryUidTxt, i = e[s].CategoryUidTxt;
						break
					}
					n.switchToCategory(i, a)
				}
			})
		},
		productsToView: function(t) {
			for (var e = [], i = t, a = 0; a < i.length; a++) {
				var s = i[a],
					n = s.id,
					o = s.defaultproductimage.imagepath.replace("_200x200", "_640x640"),
					r = s.name,
					c = s.sellPrice,
					d = s.minQuantity ? '<span class="yb-min-quantity"> (璧峰敭閲?' + s.minQuantity + (s.unitName ? s.unitName : "涓?") + ")</span>" : "",
					u = "";
				s.isOutOfStock && (u = "yb-isoutofstock"), void 0 !== s.isEffective && !1 === s.isEffective && (u = "yb-isoutofstock"), e.push('<div class="yb-item ', u, '" p_uid=', n, ">"), e.push('<div class="yb-item__hd">'), s.category && "10" == s.category.id && "10" == s.category.uid ? e.push('<a class="yb-item-img" href="#/packages/' + n + '/add">') : e.push('<a class="yb-item-img" href="#/details/', n, '">'), e.push("<img src=", o, ' alt=""  onerror="_yb.errProdImg(this)">'), (s.isOutOfStock || "yb-isoutofstock" == u) && e.push('<div class="yb-outofstock"></div>'), e.push("</a> "), e.push("</div>"), e.push('<div class="yb-item__bd">'), e.push('<div class="yb-product-title">', r + d, "</div>"), e.push('<div class="yb-product-decs">', s.description, "</div>"), e.push('<div class="yb-product-price">', _yb.ft_c(c)), s.unitName && e.push('<span class="yb-product-unit">/', s.unitName, "</span>"), s.productOriginalPrice > s.sellPrice && (e.push("<del>", _yb.ft_c(s.productOriginalPrice), "<del>"), s.unitName && e.push('<span class="yb-product-unit">/', s.unitName, "</span>")), e.push("</div>"), s.productSeries && 1 <= s.productSeries.length && e.push('<div class="yb-product-length">(鍏?', s.productSeries.length + 1, s.unitName ? s.unitName : "娆?", ")</div>");
				var l = s.baseQuantity ? 'data-buybase="' + s.baseQuantity + '"' : "",
					p = s.minQuantity ? 'data-minbuy="' + s.minQuantity + '"' : "";
				e.push("</div>"), e.push('<div class="yb-item__ft">'), s.productSeries && 1 <= s.productSeries.length ? (e.push('<div class="yb-cart-operate" data-uid="', n, '" data-price= "', c, ' " data-isseries="', !! (s.productSeries && 1 <= s.productSeries.length), '"', l, p, " >"), e.push('<span class="yb-series-btn">閫夎鏍?</span>')) : (s.category && "10" == s.category.uid ? e.push('<div class="yb-cart-operate" data-uid="', n, '" data-price= "', c, ' " data-iscombo="true" >') : e.push('<div class="yb-cart-operate" data-uid="', n, '" data-price= "', c, '"', l, p, " >"), e.push('<span class="yb-cart-remove_home ">&nbsp;</span>'), e.push('<input type="text" class="yb-item-qtys" pattern="[0-9]*" maxlength="3" value="1" disabled>'), e.push('<span class="yb-cart-add">&nbsp;</span>')), e.push("</div>"), e.push("</div>"), e.push("</div>")
			}
			return e.push("</div>"), e.join("")
		},
		categeroyToView: function(t) {
			for (var e = t, i = [], a = 0; a < e.length; a++) {
				"15" == (s = e[a].CategoryUidTxt) && (i.push('<div class="yb-item_goGroup yb-item " data-cuid="', s, '" data-category="', n, '">', '<img class="yb-category-image" onerror="javasrcipt:this.src=\'//imgw.pospal.cn/we/weidian/img/icons/categorynull.png\';this.onerror=null;" src=""/>', '<p class="yb-spw-showName">', "鍥㈣喘鐑棬", "</p></div>"), e.splice(a, 1))
			}
			for (a = 0; a < e.length; a++) {
				"16" == (s = e[a].CategoryUidTxt) && (i.push('<div class="yb-item_goBargain yb-item " data-cuid="', s, '" data-category="', n, '">', '<img class="yb-category-image" onerror="javasrcipt:this.src=\'//imgw.pospal.cn/we/weidian/img/icons/categorynull.png\';this.onerror=null;" src=""/>', '<p class="yb-spw-showName">', "鐮嶄环娲诲姩", "</p></div>"), e.splice(a, 1))
			}
			for (a = 0; a < e.length; a++) {
				var s = e[a].CategoryUidTxt,
					n = e[a].DisplayName,
					o = e[a].SubCategories,
					r = "",
					c = "",
					d = "//img.pospal.cn/EShopCategoryImage/",
					u = d + e[a].EShopCategoryImageUrl;
				if (0 == a && (r = "yb-act yb-act-color"), o && 0 < o.length) {
					c += '<div class="yb-left-container"><div class="yb-item-slide">';
					for (var l = 0; l < o.length; l++) c += '<div class="yb-item" data-cuid="' + o[l].CategoryUidTxt + '" data-category="' + o[l].DisplayName + '"><img class="yb-category-image" onerror="javasrcipt:this.src=\'//imgw.pospal.cn/we/weidian/img/icons/categorynull.png\';this.onerror=null;" src=" ' + d + o[l].EShopCategoryImageUrl + '"/><p class="yb-spw-showName">' + o[l].DisplayName + "</p> </div>";
					c += "</div></div>"
				}
				i.push('<div class="yb-item ', r, '" data-cuid="', s, '" data-category="', n, '">', '<img class="yb-category-image" onerror="javasrcipt:this.src=\'//imgw.pospal.cn/we/weidian/img/icons/categorynull.png\';this.onerror=null;" src=" ', u, '"/>', '<p class="yb-spw-showName">', n, "</p>", c, "</div>")
			}
			p(".yb-deals_left .yb-items", this.viewContainer).html(i.join(""))
		},
		switchToCategory: function(t, e) {
			var i = "",
				a = [];
			if (p("#categoriesContianer").hasClass("yb-deals_tpl_0") || p("#categoriesContianer").hasClass("yb-deals_tpl_3")) {
				var s = this.findCurrentSub(t);
				if (null !== s) if (s && 1 < s.length) {
					for (var n = 0; n < s.length; n++) i += '<div class="yb-item-sub" data-cuid="' + s[n].CategoryUidTxt + '" data-category="' + s[n].DisplayName + '"><p class="yb-spw-showName">' + s[n].DisplayName + "</p></div>";
					i = '<div class="yb-right-subBox"><div class="yb-item-slide">' + i + "</div></div>", 0 < p(".yb-right-subBox").length ? (p(".yb-right-subBox").html(i), p(".yb-right-subBox").height("2rem")) : p(".yb-deals_left").after(i)
				} else p(".yb-right-subBox").html(""), p(".yb-right-subBox").height(0)
			}
			a.push('<div class="c', t, '" data-cuid="', t, '"><div class="yb-category_name">', e, "</div></div>"), this.productListView.html(a.join("")), o[d = t] = {
				pageIndex: 0,
				isLastPage: !1,
				name: e
			}, this.loadProducts(t)
		},
		findCurrentSub: function(t) {
			var e = this.allCategories;
			console.log(e);
			for (var i = 0; i < e.length; i++) if (t == e[i].CategoryUidTxt) return console.log(t, e[i].CategoryUidTxt), e[i].SubCategories;
			return null
		},
		loadAddBanners: function() {
			var n = this;
			_yb.services.store.loadBanners(!1, function(t) {
				console.log("res,,,", t);
				for (var e = [], i = 0; i < t.length; i++) {
					var a = '<div class="swiper-slide">\n                                <img src="' + t[i].ImagePath + '" alt="" />\n                               </div>';
					e.push(a)
				}
				var s = '<div class="yb-category-swiper"><div class="yb-swiper swiper-container">\n                                <div class="swiper-wrapper">\n                                ' + e.join("") + '     \n                                </div>\n                                <div class="swiper-pagination"></div>\n                            </div></div>';
				p(".yb-deals_righ .yb-scrollable", n.viewContainer).prepend(s), p(".yb-swiper ", n.viewContainer).swiper({
					loop: !0,
					autoplay: 3e3
				})
			})
		},
		loadProducts: function(i) {
			var a = o[i];
			if (a && !a.isLastPage) {
				var s = a.pageIndex,
					n = this,
					t = function(t, e) {
						if (void 0 === t) return null;
						var i = r[t],
							a = null;
						i && (a = r[t][e]);
						return a
					}(i, s);
				if (void 0 === t || null == t) {
					c(i, s, !1, []);
					var e = {
						categoryUids: i,
						pageIdx: s
					};
					n.loadingIndicator.show(), _yb.services.products.search(e, function(t) {
						var e = t.data;
						c(i, s, !0, e), n.processProductData(i, e, a), p.hideLoading(), n.loadingIndicator.hide()
					})
				} else {
					if (!1 === t.status) return;
					n.processProductData(i, t.data, a)
				}
			}
		},
		processProductData: function(t, e, i) {
			var a = p(".c" + t, this.productListView);
			0 < e.length ? (e.length < 20 ? i.isLastPage = !0 : i.pageIndex = i.pageIndex + 1, a.append(this.productsToView(e)), this.updateAllItems()) : (i.isLastPage = !0, 0 == i.pageIndex && a.append('<div class="yb-searchWarning">                    <img src="//imgw.pospal.cn/we/weidian/img/icons/pageNull@2x.png" class="yb-searchWarning_img">                     <p class="yb-searchWarning_title">寰堟姳姝夛紝娌℃湁鎵惧埌涓庘€?' + i.name + '鈥濈浉鍏崇殑浜у搧銆?</p>                    <span class="yb-searchWarning_text">鍙互鍘荤湅鐪嬪叾浠栨浛浠ｅ晢鍝?</span>                    </div>'))
		},
		remindTimer: function(t, e, i) {
			if (t.offset().width <= e.offset().width) i && setTimeout(function() {
				i()
			}, 1e4);
			else {
				var a = {
					start: 0,
					end: t.offset().width,
					gap: 30,
					_count: 0,
					coun: function() {
						a.start++, a.start >= a.end ? t.offset({
							left: e.offset().width
						}) : 3 == a._count ? (t.offset({
							left: 0
						}), i && i()) : (a.start + 5 > a.end && (a._count++, a.start = -e.offset().width), t.offset({
							left: -a.start
						}), a.timeout())
					},
					timeout: function() {
						setTimeout(a.coun, a.gap)
					}
				};
				a.coun()
			}
		}
	}, p.extend(e.prototype, _yb.mixins.ShoppingCartFns), i = e.prototype.defaults = {
		viewContainer: "#categoriesView",
		orderPageUrl: YB_ORDERPAGEURL,
		orderLink: ".yb-order-link",
		groupPageUrl: window.YB_GROUPPAGEURL || "/m/group",
		bargainPageUrl: window.YB_BARGAINPAGEURL || "/m/bargain"
	}, t._yb.initCategoriesView = function(t) {
		return new e(t)
	}
}($, window), function(c, t) {
	var e, a = function(t, e) {
			this.container = c(t), this.initConfig(e)
		};
	e = (a.prototype = {
		initConfig: function(t) {
			this.config = c.extend({}, e, t), this.tpl = c.t7.compile(this.config.tpl), this.loadData()
		},
		loadData: function() {
			var e = this,
				i = e.container,
				t = i.data("keywords"),
				a = i.data("css"),
				s = i.data("display"),
				n = i.data("isswiper"),
				o = "banner" + ("wide" === s ? "w" : ""),
				r = i.data("isnoproduct");
			"wide" !== s && (s = "normal"), i.html(e.config.loading), _yb.services.store.loadBanners(t, function(t) {
				if (t) {
					if (i.html(e.tpl({
						className: a,
						banners: t,
						display: s,
						isNoProduct: r,
						paramName: o
					})), t.length <= 1 && !n) return;
					c(".yb-swiper", i).swiper({
						loop: !0,
						autoplay: 3e3
					})
				}
			})
		}
	}).defaults = {
		tpl: '<div class="yb-swiper {{className}} swiper-container yb-display-{{display}}">                <div class="swiper-wrapper">                    {{#banners}}                        <div class="swiper-slide">                             {{#if ../isNoProduct}}                                <img src="{{ImagePath}}" alt="" />                            {{else}}                                <a href="#/category/{{../../paramName}}_{{Id}}"><img src="{{ImagePath}}" alt="" /></a>                            {{/if}}                        </div>                    {{/banners}}                </div>                <div class="swiper-pagination"></div>            </div>',
		loading: '<div class="weui-loadmore">                <i class="weui-loading"></i>            </div>'
	}, c.fn.loadAds = function(i) {
		return this.each(function() {
			var t = c(this),
				e = t.data("sliderAds");
			if (e) return e;
			t.data("sliderAds", new a(this, i))
		})
	}
}($, window), function(n, t) {
	var e, a = function(t, e) {
			this.container = n(t), this.initConfig(e)
		};
	n.t7.registerHelper("ft_c", function(t) {
		return _yb.ft_c(t)
	}), e = (a.prototype = {
		initConfig: function(t) {
			this.config = n.extend({}, e, t), this.tpl = n.t7.compile(this.config.tpl), this.tplMedium = n.t7.compile(this.config.tplMedium), this.tplBrief = n.t7.compile(this.config.tplBrief), this.loadData()
		},
		loadData: function() {
			var a = this,
				t = a.container,
				e = {};
			e.categoryUids = t.data("cuids"), e.keywords = t.data("keywords"), e.tags = t.data("tags"), e.categories = t.data("categories"), e.pageIdx = t.data("pageIdx"), e.size = t.data("size");
			var s = t.data("display");
			a.container.html(a.config.loading), _yb.services.products.search(e, function(t) {
				if (t.data) {
					if (n.each(t.data, function(t, e) {
						e.hasDiscount = e.sellPrice != e.productOriginalPrice
					}), t.data.length && 0 < t.data.length) for (var e = 0; e < t.data.length; e++) {
						var i = t.data[e];
						i.isHasSeries = -1 != i.barcode.indexOf("-") && i.productSeries ? 'data-isSeries="true"' : "", i.isHasSeries && i.productSeries && (i.productsSeriesLength = i.productSeries.length + 1), i.isHasUnitName = !! i.unitName, i.isHasUnitName && (i.unitName = "/" + i.unitName)
					}
					"brief" === s ? a.container.html(a.tplBrief(t)) : "medium" === s ? a.container.html(a.tplMedium(t)) : ("wide" === s || "wtag" === s ? (a.container.addClass("yb-products-wide"), n.each(t.data, function(t, e) {
						e.defaultproductimage && e.defaultproductimage.imagepath && (e.defaultproductimage.imagepath = e.defaultproductimage.imagepath.replace("_200x200", "_640x640"))
					})) : "wide2" === s && (a.container.addClass("yb-products-wide2"), n.each(t.data, function(t, e) {
						e.defaultproductimage && e.defaultproductimage.imagepath && (e.defaultproductimage.imagepath = e.defaultproductimage.imagepath.replace("_200x200", ""))
					})), a.container.html(a.tpl(t)))
				}
			})
		}
	}).defaults = {
		tpl: '{{#data}}            <div class="yb-product " p_uid="{{id}}">                <div class="yb-product-inner{{#if isOutOfStock}} yb-outOfStock{{/if}}">                    <div class="yb-product__hd">                        <a class="yb-product-photo" href="#/details/{{id}}">                            <img src="{{defaultproductimage.imagepath}}" onerror="_yb.errProdImg(this)"/>                            {{#if isOutOfStock}}<div class="yb-outofstock"></div>{{/if}}                        </a>                    </div>                    <div class="yb-product__bd">                        <div class="yb-product-title">{{productDisplayName}}</div>                        <div class="yb-product-desc">{{description}}</div>                    </div>                    <div class="yb-product__ft">                        <div class="yb-product-price">{{ft_c sellPrice}} {{#if isHasUnitName}}<span class="yb-product-unit">{{unitName}}</span>{{/if}} {{#if hasDiscount}}<del>{{ft_c productOriginalPrice}}{{#if isHasUnitName}}<span class="yb-product-unit">{{unitName}}</span>{{/if}}</del>{{/if}}</div>                        {{#if isOutOfStock}}                            <div class="yb-cart-operate" data-uid="{{id}}" {{isHasSeries}}  data-price="{{sellPrice}}"></div>                        {{else}}                            <div class="yb-cart-operate" data-uid="{{id}}" {{isHasSeries}}  data-price="{{sellPrice}}"><span class="yb-cart-add"></span></div>                        {{/if}}                        {{#if isHasSeries}} <span class="yb-product-series">鍏? {{productsSeriesLength}} 娆?</span> {{/if}}                    </div>                </div>            </div>            {{/data}}',
		tplMedium: '{{#data}}            <div class="yb-product" p_uid="{{id}}">                <div class="yb-product-inner{{#if isOutOfStock}} yb-outOfStock{{/if}}">                    <div class="yb-product__hd">                        <a class="yb-product-photo" href="#/details/{{id}}">                            <img src="{{defaultproductimage.imagepath}}" onerror="_yb.errProdImg(this)"/>                            {{#if isOutOfStock}}<div class="yb-outofstock"></div>{{/if}}                        </a>                    </div>                    <div class="yb-product__bd">                        <div class="yb-product-title">{{productDisplayName}}</div>                    </div>                    <div class="yb-product__ft">                        <div class="yb-product-price">{{ft_c sellPrice}}{{#if isHasUnitName}}<span class="yb-product-unit">{{unitName}}</span>{{/if}} {{#if hasDiscount}}<del>{{ft_c productOriginalPrice}}{{#if isHasUnitName}}<span class="yb-product-unit">{{unitName}}</span>{{/if}}</del>{{/if}}</div>                        {{#if isOutOfStock}}                            <div class="yb-cart-operate" data-uid="{{id}}" {{isHasSeries}}  data-price="{{sellPrice}}"><span class="yb-cart-addDisabled"></span></div>                        {{else}}                            <div class="yb-cart-operate" data-uid="{{id}}" {{isHasSeries}}  data-price="{{sellPrice}}"><span class="yb-cart-add"></span></div>                        {{/if}}                        {{#if isHasSeries}} <span class="yb-product-series">鍏? {{productsSeriesLength}} 娆?</span> {{/if}}                    </div>                </div>            </div>            {{/data}}',
		tplBrief: '{{#data}}            <div class="yb-product yb-product-brief" p_uid="{{id}}">                <div class="yb-product-inner{{#if isOutOfStock}} yb-outOfStock{{/if}}">                    <div class="yb-product__hd">                        <a class="yb-product-photo" href="#/details/{{id}}">                            <img src="{{defaultproductimage.imagepath}}" onerror="_yb.errProdImg(this)"/>                            {{#if isOutOfStock}}<div class="yb-outofstock"></div>{{/if}}                        </a>                        {{#if isOutOfStock}}                        {{else}}                            <div {{isHasSeries}} class="yb-product-price">{{ft_c sellPrice}} {{#if hasDiscount}}<del>{{ft_c productOriginalPrice}}</del>{{/if}}</div>                        {{/if}}                    </div>                </div>            </div>            {{/data}}',
		loading: '<div class="weui-loadmore">                <i class="weui-loading"></i>            </div>'
	}, n.fn.loadProducts = function(i) {
		return this.each(function() {
			var t = n(this),
				e = t.data("products");
			if (e) return e;
			t.data("products", new a(this, i))
		})
	}
}($, window), function(g, t) {
	var e;

	function u(t, e) {
		return t ? t.replace("_200x200", e) : t
	}
	function d(t) {
		return !(void 0 === t || !t || "y" === t || "n" === t)
	}
	var i = function(t) {
			this.initConfig(t)
		};
	i.prototype = {
		initConfig: function(t) {
			var i = this;
			i.config = g.extend({}, e, t), i.viewContainer = g(i.config.viewContainer), i.viewContent = g(".yb-details-wrapper", i.config.viewContainer), i.productId = 0, i.comboId = 0, i.isPackages = !1, i.shoppingCart = t.shoppingCart, i.cartEventHandler = i.cartEventHandler.bind(i), i.cartContainer = g(i.config.cartContainer), i.cartMiniView = g(i.config.cartMiniView), i.cartQty = g(".yb-cart-qty", i.cartMiniView), i.cartAmount = g(".yb-cart-money", i.cartMiniView), i.products = [], i.combos = [], i.viewContainer.find(".yb-contact").on("click", function(t) {
				console.log("contact"), g(".yb-service", i.viewContainer).show()
			}), i.viewContainer.find(".yb-close-popup").on("click", function(t) {
				t.stopPropagation(), t.preventDefault(), g(".yb-service", i.viewContainer).hide()
			}), i.viewContainer.on("click", ".yb-cart-add a", function(t) {
				i.isOutOfStock || (i.productId || "鏈嶈闉嬪附" != window.YB_INDUSTRY || g.alert("璇烽€夋嫨鍟嗗搧瑙勬牸锛?"), i.isPackages && i.comboId ? location.href = " #/packages/" + i.comboId + "/add" : !i.isPackages && i.productId && _yb.services.products.checkAttr(i.productId, function(t) {
					"1" === t ? _yb.views.selectAttr.open(i.productId) : (g.toast("鍔犲叆璐墿杞?", 500), i.baseQuantity ? i.shoppingCart.addWithNum(i.productId, i.baseQuantity, "", i.productPrice, [], !1, function() {
						g.hideLoading()
					}, i.specifications) : i.shoppingCart.add(i.productId, "", i.productPrice, [], !1, function() {
						g.hideLoading()
					}, i.specifications))
				}))
			}), i.viewContainer.find(".yb-cart-order a").on("click", function(t) {
				i.productId ? i.isOutOfStock || (i.isPackages && i.comboId ? location.href = " #/packages/" + i.comboId + "/add" : i.isPackages || !i.productId || i.isOutOfStock || _yb.services.products.checkAttr(i.productId, function(t) {
					if ("1" === t) _yb.views.selectAttr.open(i.productId, function() {});
					else {
						if (_yb.services.store.handleBizClosed()) return !1;
						g.showLoading("鏁版嵁鍔犺浇涓?"), i.shoppingCart.add(i.productId, "", i.productPrice, [], !1, function(t) {
							if (g.hideLoading(), null === t || 0 == t.length) return g.alert("鍔犲叆璐墿杞﹀け璐ワ紒"), !1;
							i.shoppingCart.gotoOrderPage()
						}, i.specifications)
					}
				})) : window.YB_INDUSTRY && "鏈嶈闉嬪附" == window.YB_INDUSTRY && g.alert("璇烽€夋嫨鍟嗗搧瑙勬牸锛?")
			}), window.YB_INDUSTRY && "鏈嶈闉嬪附" == window.YB_INDUSTRY && (i.viewContainer.on("click", ".yb-series-color", function(t) {
				var e = g(this).data("name");
				i.showClothes(this, e)
			}), i.viewContainer.on("click", ".yb-series-size", function(t) {
				var e = g(this).data("name");
				i.showClothes(this, e)
			}))
		},
		tryGoingOrderPage: function() {
			return null !== this.shoppingCart.find(this.productId) && (g.showLoading("鏁版嵁鍔犺浇涓?"), setTimeout(function() {
				g.hideLoading()
			}, 2e3), window.location = this.config.orderPageUrl, !0)
		},
		cartEventHandler: function(t, e, i) {
			switch (e) {
			case "reload":
				this.updateAllItems();
				break;
			case "add":
			case "minus":
			case "update":
				this.updateItem(i)
			}
			this.updateSummary(t.summary())
		},
		once: function() {
			t.YB_CONTACTPAGE && g(".yb-service__bd", self.viewContainer).load(t.YB_CONTACTPAGE, function() {})
		},
		before: function(t) {
			console.log("details before", t), g.hideLoading(), self.productId = 0, this.shoppingCart.subscribe(this.cartEventHandler), this.viewContent.html(this.config.loadIndicator), this.shoppingCart.loadOnce()
		},
		on: function(i) {
			console.log("details on", i);
			var a = this;
			this.setCustomerService(), "c" == i.substring(0, 1) ? (console.log("鎴戣蛋濂楅"), _yb.services.products.loadCombo(i, function(t) {
				console.log("loadCombo result ", t);
				var e = t.data;
				a.comboId = i, a.comboPrice = e.comboPrice, a.isPackages = !0, a.renderComResult(e)
			})) : (console.log("鎴戣蛋鍗曞搧"), _yb.services.products.loadDetails(i, function(t) {
				var e = t.data;
				e && (_yb.wxSharing(e), a.productId = e.id, a.productPrice = e.sellPrice, a.isOutOfStock = e.isOutOfStock, a.baseQuantity = e.baseQuantity, a.minQuantity = e.minQuantity, a.isPackages = !1, a.renderResult(e))
			}))
		},
		showProductSeries: function(t, e) {
			if (!g(t).hasClass("product-selected")) {
				var i = g("#detailsView  .swiper-container");
				0 < i.length && i[0].swiper.slideTo(e + 1), g(".yb-details-item").removeClass("product-selected"), g(t).addClass("product-selected");
				var a = this.products[e];
				this.productId = a.id, this.productPrice = a.sellPrice, this.isOutOfStock = a.isOutOfStock, this.specifications = a.attribute6;
				a.isPromotionProduct;
				var s = a.productOriginalPrice,
					n = a.unitName || "",
					o = "";
				n && (o = '<span class="yb-product-unit">/' + n + "</span>");
				var r = g(".yb-details-inner .yb-details-price", this.viewContainer);
				r.text(_yb.ft_c(this.productPrice)), r.append(o), s > this.productPrice ? r.append("  <del>" + _yb.ft_c(s) + o + "</del>") : r.find("del").remove(), this.isOutOfStock ? (g(".yb-details-inner .yb-details-photo").append('<div class="yb-outofstock" style="z-index:1;"></div>'), this.viewContainer.addClass("yb-outOfStock")) : (g(".yb-details-inner .yb-details-photo").find(".yb-outofstock").remove(), this.viewContainer.removeClass("yb-outOfStock"))
			}
		},
		showClothes: function(t, e) {
			if (!g(t).hasClass("product-selected") && !g(t).hasClass("product-null")) {
				if (g(t).hasClass("yb-series-color")) {
					g(".yb-series-color").removeClass("product-selected"), g(".yb-series-size").removeClass("product-null");
					for (var i = g(".yb-series-size"), a = 0; a < i.length; a++) {
						var s = i[a],
							n = g(s).data("name"),
							o = g(t).data("name");
						this.products[o + "" + n] || g(s).addClass("product-null")
					}
				} else if (g(t).hasClass("yb-series-size")) {
					g(".yb-series-size").removeClass("product-selected"), g(".yb-series-color").removeClass("product-null");
					var r = g(".yb-series-color");
					for (a = 0; a < r.length; a++) {
						var c = r[a],
							d = g(c).data("name");
						o = g(t).data("name");
						this.products[d + "" + o] || g(c).addClass("product-null")
					}
				}
				g(t).addClass("product-selected");
				var u = g(".yb-color-items").find(".product-selected").data("name") + "" + g(".yb-size-items").find(".product-selected").data("name"),
					l = this.products[u];
				if (l) {
					this.productId = l.id, this.productPrice = l.sellPrice, this.isOutOfStock = l.isOutOfStock;
					var p = l.isPromotionProduct,
						h = l.productOriginalPrice,
						f = g("#detailsView  .swiper-container");
					0 < f.length && f[0].swiper.slideTo(l.swiperIndex + 1);
					var m = l.unitName || "",
						b = g(".yb-details-inner .yb-details-price", this.viewContainer);
					b.text(_yb.ft_c(this.productPrice)), m && b.append('<span class="yb-product-unit">/', m, "</span>"), p ? (b.append("  <del>" + h + "</del>"), m && b.find("del").append('<span class="yb-product-unit">/', m, "</span>")) : b.find("del").remove(), l.artNO && g(".yb-product-artNO span").text(l.artNO), this.isOutOfStock ? (g(".yb-details-inner .yb-details-photo").append('<div class="yb-outofstock" style="z-index:1;"></div>'), this.viewContainer.addClass("yb-outOfStock")) : (g(".yb-details-inner .yb-details-photo").find(".yb-outofstock").remove(), this.viewContainer.removeClass("yb-outOfStock"))
				}
			}
		},
		setCustomerService: function() {
			var o = this;
			_yb.services.products.findLoginInfo(function(t) {
				var e = t.storeWebsiteContacts,
					i = e.qq,
					a = e.tel,
					s = e.wxQrCodeImageUrl,
					n = "";
				void 0 !== i || void 0 !== a || void 0 !== s ? (void 0 !== a && (n += '         <div class="yb-service__item">            <div class="yb-service-phone">              瀹㈡湇鐑嚎            </div>            <div class="yb-service-call">              <a href="tel:' + a + '">' + a + "</a>            </div>          </div>"), void 0 !== i && (n += '          <div class="yb-service__item">            <div class="yb-service-qq">               瀹㈡湇QQ            </div>            <div class="yb-service-qq__text">              <a href="tencent://message/?uin=' + i + '">' + i + "</a>            </div>          </div>"), void 0 !== s && (n += '          <div class="yb-service__item">            <div class="yb-service-wechat">              瀹㈡湇寰俊            </div>            <div class="yb-service-qrcode">              <img src="' + s + '" alt="" />            </div>            <div>              闀挎寜璇嗗埆鍥句腑浜岀淮鐮佹坊鍔犲井淇?            </div>          </div>'), g(".yb-service__bd", o.viewContainer).html(n)) : o.viewContainer.find(".yb-contact").hide()
			})
		},
		neatenData: function(t) {
			for (var e = {}, i = {}, a = {}, s = 0; s < t.length; s++) {
				var n = t[s];
				e[n.attribute1] = n.attribute1, i[n.attribute2] = n.attribute2, n.swiperIndex = s, a[n.attribute1 + n.attribute2] = n
			}
			var o = [],
				r = [];
			for (var s in e) o.push(e[s]);
			for (var s in i) r.push(i[s]);
			return {
				colorArray: o,
				sizeArray: r,
				sizeProducts: a
			}
		},
		renderClothesResult: function(t) {
			var c = this;
			_yb.services.products.loadSeriesProduct(t, function(t) {
				var e = [],
					i = [];
				if (t.successed) {
					e.push('<div class="yb-details__barcode "> ');
					var a = c.sortBarcodeList(t.products),
						s = c.neatenData(a);
					c.products = s.sizeProducts, e.push('<div class="yb-details-items yb-color-items">'), e.push('<div class="yb-series-tilte">棰滆壊锛?</div>'), e.push('<div class="yb-series-contain">');
					for (var n = 0; n < s.colorArray.length; n++) {
						var o = s.colorArray[n];
						e.push(' <div class="yb-details-item yb-series-color" data-name="' + o + '">'), e.push(' <div class="yb-details-color">' + o + "</div>"), e.push("</div>")
					}
					e.push("</div></div>"), e.push('<div class="yb-details-items  yb-size-items">'), e.push('<div class="yb-series-tilte">灏虹爜锛?</div>'), e.push('<div class="yb-series-contain">');
					for (n = 0; n < s.sizeArray.length; n++) {
						o = s.sizeArray[n];
						e.push(' <div class="yb-details-item  yb-series-size" data-name="' + o + '">'), e.push(' <div class="yb-details-color ">' + o + "</div>"), e.push("</div>")
					}
					if (e.push("</div></div>"), e.push("</div>"), t.products && 0 < t.products.length) {
						i.push('<div class="yb-swiper_barcode swiper-container "> <div class="swiper-wrapper">');
						for (n = 0; n < t.products.length; n++) {
							var r = t.products[n];
							i.push('<div class="swiper-slide"><img src="', u(r.defaultproductimage.imagepath, "_640x640"), '" onerror="_yb.errProdImg(this)" alt="" /></div>')
						}
						i.push('</div><div class="swiper-pagination"></div></div>'), g(".yb-details-title", c.viewContainer).after('<div class="yb-product-artNO">璐у彿锛?<span>' + t.products[0].artNO + "</span></div>"), g(".yb-details-inner").append(e.join("")), g(".yb-details-photo").html(i.join("")), setTimeout(function() {
							g(".yb-swiper_barcode", c.viewContent).swiper({
								loop: !0
							}), c.productId = 0
						}, 200)
					}
				} else console.log("post barcode result ERR!!!!", t)
			})
		},
		renderBarcodeResult: function(t) {
			var c = this;
			_yb.services.products.loadSeriesProduct(t, function(t) {
				var e = [],
					i = "";
				if (e.push('<div class="yb-details__barcode_oths "> \n <div class="yb-details-items">'), t.successed) {
					var a = c.sortBarcodeList(t.products);
					if (a && 0 < a.length) {
						c.products = t.products;
						for (var s = 0; s < t.products.length; s++) {
							var n = t.products[s];
							e.push(' <div class="yb-details-item" data-index="' + s + '">');
							var o = [];
							d(n.attribute1) && o.push("<span>" + n.attribute1 + "</span>"), d(n.attribute2) && o.push("<span>" + n.attribute2 + "</span>"), d(n.attribute3) && o.push("<span>" + n.attribute3 + "</span>"), d(n.attribute4) && o.push("<span>" + n.attribute4 + "</span>"), 0 < o.length ? e.push(' <div class="yb-details-color">' + o.join(",") + "</div>") : e.push(n.productDisplayName), e.push("</div>"), i += '<div class="swiper-slide"><img src="' + u(n.defaultproductimage.imagepath, "_640x640") + '" onerror="_yb.errProdImg(this)" alt="" /></div>'
						}
						e.push("</div></div>"), g(".yb-details-inner").append(e.join(""));
						var r = '<div class="yb-swiper_barcode_oths swiper-container "> <div class="swiper-wrapper"> ' + i + '</div><div class="swiper-pagination"></div></div>';
						g(".yb-details-photo").html(r), setTimeout(function() {
							g(".yb-swiper_barcode_oths", c.viewContent).swiper({
								loop: !0
							})
						}, 200), g(g(".yb-details-item")[0]).addClass("product-selected"), g(".yb-details-item").on("click", function(t) {
							var e = g(this).data("index");
							c.showProductSeries(this, e)
						})
					}
				} else console.log("post barcode result ERR!!!!", t.successed)
			})
		},
		renderSPUResult: function(t) {
			var d = this;
			_yb.services.products.loadSeriesProduct(t, function(t) {
				var e = [],
					i = "";
				e.push('<div class="yb-details__barcode_oths "> \n <div class="yb-details-items">');
				var a = !1;
				if (t.successed) {
					if (t.products && 0 < t.products.length) {
						d.products = t.products;
						for (var s = 0; s < t.products.length; s++) {
							var n = t.products[s],
								o = "";
							1 == n.attribute7 && (o = "product-selected", d.specifications = n.attribute6, a = n.isOutOfStock), e.push(' <div class="yb-details-item  ' + o + '" data-index="' + s + '">');
							var r = n.attribute6;
							e.push(' <div class="yb-details-color">' + r + "</div>"), e.push("</div>"), i += '<div class="swiper-slide"><img src="' + u(n.defaultproductimage.imagepath, "_640x640") + '" onerror="_yb.errProdImg(this)" alt="" /></div>'
						}
						e.push("</div></div>"), g(".yb-details-inner").append(e.join(""));
						var c = '<div class="yb-swiper_barcode_oths swiper-container "> <div class="swiper-wrapper"> ' + i + '</div><div class="swiper-pagination"></div></div>';
						g(".yb-details-photo").html(c), setTimeout(function() {
							g(".yb-swiper_barcode_oths", d.viewContent).swiper({
								loop: !0
							})
						}, 200), a ? (g(".yb-details-inner .yb-details-photo").append('<div class="yb-outofstock" style="z-index:1;"></div>'), d.viewContainer.addClass("yb-outOfStock")) : (g(".yb-details-inner .yb-details-photo").find(".yb-outofstock").remove(), d.viewContainer.removeClass("yb-outOfStock")), g(".yb-details-item").on("click", function(t) {
							var e = g(this).data("index");
							d.showProductSeries(this, e)
						})
					}
				} else console.log("post barcode result ERR!!!!", t.successed)
			})
		},
		renderResult: function(e) {
			var t = [];
			if (t.push('<div class="yb-details" p_uid="', e.id, '">'), t.push('<div class="yb-details-inner">'), t.push('<div class="yb-details__hd">'), t.push('<div class="yb-details-photo">'), e.attribute5) this.renderSPUResult(e.attribute5);
			else if (e.barcode && -1 != e.barcode.indexOf("-")) window.YB_INDUSTRY && "鏈嶈闉嬪附" == window.YB_INDUSTRY ? this.renderClothesResult(e.barcode) : this.renderBarcodeResult(e.barcode);
			else if (e.productimages && 1 < e.productimages.length) {
				t.push('<div class="yb-swiper swiper-container">'), t.push('<div class="swiper-wrapper">');
				for (var i = 0; i < e.productimages.length; i++) {
					var a = e.productimages[i];
					t.push('<div class="swiper-slide"><img src="'), t.push(u(a.imagepath, "_640x640")), t.push('" onerror="_yb.errProdImg(this)" alt="" /></div>')
				}
				t.push("</div>"), t.push('<div class="swiper-pagination"></div>'), t.push("</div>")
			} else t.push('<img src="'), t.push(u(e.defaultproductimage.imagepath, "_640x640")), t.push('" onerror="_yb.errProdImg(this)" alt="" />');
			console.log("product....", e), e.isOutOfStock ? (t.push('<div class="yb-outofstock"></div>'), this.viewContainer.addClass("yb-outOfStock")) : this.viewContainer.removeClass("yb-outOfStock"), t.push("</div>"), t.push("</div>");
			var s = e.minQuantity ? '<span class="yb-min-quantity"> (璧峰敭' + e.minQuantity + (e.unitName ? e.unitName : "") + ")</span>" : "";
			t.push('<div class="yb-details__bd">'), t.push('<div class="yb-details-title">', e.productDisplayName, s, "</div>"), t.push('<div class="yb-details-price">', _yb.ft_c(e.sellPrice)), e.unitName && t.push('<span class="yb-product-unit">/', e.unitName, "</span>"), e.productOriginalPrice > e.sellPrice && (t.push(" <del>", _yb.ft_c(e.productOriginalPrice)), e.unitName && t.push('<span class="yb-product-unit">/', e.unitName, "</span>"), t.push("</del>")), t.push("</div>"), t.push("</div>"), e.description && (t.push('<div class="yb-details__ft yb-border_top">'), t.push('<div class="yb-details-desc">', e.description.split("\n").join("<br>"), "</div>"), t.push("</div>")), t.push("</div>"), t.push('<div  class="yb-details-promote" id="ybPromote', e.id, '"></div>'), t.push("</div>");
			var n = this;
			n.viewContent.hide(), n.viewContent.html(t.join("")), g.ajax({
				url: n.config.descUrl + e.id,
				type: "POST",
				success: function(t) {
					t && g("#ybPromote" + e.id, n.viewContent).html(t)
				},
				complete: function(t) {
					setTimeout(function() {
						n.viewContent.show(), e.productimages && 1 < e.productimages.length && g(".yb-swiper", n.viewContent).swiper({
							loop: !0,
							autoplay: 3e3
						})
					}, 100)
				}
			})
		},
		renderComResult: function(t) {
			var e = [];
			e.push('<div class="yb-details" p_uid="', t.id, '">'), e.push('<div class="yb-details-inner">'), e.push('<div class="yb-details__hd">'), e.push('<div class="yb-details-photo">'), e.push('<img src="'), void 0 !== t.defaultImagePath && e.push(u(t.defaultImagePath, "_640x640")), e.push('" onerror="_yb.errProdImg(this)" alt="" />'), e.push("</div>"), e.push("</div>"), e.push('<div class="yb-details__bd">'), e.push('<div class="yb-details-title">', t.comboName, "</div>"), e.push('<div class="yb-details-price">', _yb.ft_c(t.comboPrice)), t.productOriginalPrice > t.comboPrice && (e.push(" <del>", _yb.ft_c(t.productOriginalPrice)), t.unitName && e.push('<span class="yb-product-unit">/', t.unitName, "</span>"), e.push("</del>")), e.push("</div>"), e.push("</div>"), t.description && (e.push('<div class="yb-details__ft yb-border_top">'), e.push('<div class="yb-details-desc">', t.description.split("\n").join("<br>"), "</div>"), e.push("</div>")), this.viewContent.html(e.join(""))
		},
		after: function() {
			console.log("details after"), this.viewContent.empty(), this.shoppingCart.unsubscribe(this.cartEventHandler)
		},
		updateSummary: function(t) {
			this.cartQty.text(t.quantity), this.cartAmount.text(_yb.ft_c(t.amount)), 0 == t.quantity ? this.cartContainer.removeClass("yb-cart-has").addClass("yb-cart-empty") : this.cartContainer.removeClass("yb-cart-empty").addClass("yb-cart-has")
		},
		updateItem: function(t) {},
		updateAllItems: function() {},
		sortBarcodeList: function(t) {
			for (var e = 0; e < t.length; e++) {
				var i = t[e]; - 1 != i.barcode.indexOf("-") && (i.barcodeLater = i.barcode.split("-")[1])
			}
			return t[0].barcodeLater && t.sort(function(t, e) {
				return t.barcodeLater - e.barcodeLater
			}), t
		}
	}, e = {
		viewContainer: "#detailsView",
		cartContainer: ".yb-cart-view",
		cartMiniView: ".yb-cart-mini",
		orderPageUrl: YB_ORDERPAGEURL,
		cartPageUrl: "#/cart",
		descUrl: "/wxapi/product/readdesc/",
		loadIndicator: '<div class="weui-loadmore"><i class="weui-loading"></i> <span class="weui-loadmore__tips">姝ｅ湪鍔犺浇</span></div>'
	}, t._yb.initDetailsView = function(t) {
		return new i(t)
	}
}($, window), function(r, t) {
	var e;
	var i = function(t) {
			this.initConfig(t)
		};
	i.prototype = {
		initConfig: function(t) {
			var n = this;
			n.config = r.extend({}, e, t), n.viewContainer = r(n.config.viewContainer), n.viewContent = r(".yb-attr-wrapper", n.config.viewContainer), n.initData(), n.shoppingCart = t.shoppingCart, n.cartEventHandler = n.cartEventHandler.bind(n), n.cartContainer = r(n.config.cartContainer), n.cartMiniView = r(n.config.cartMiniView), n.cartQty = r(".yb-cart-qty", n.cartMiniView), n.cartAmount = r(".yb-cart-money", n.cartMiniView), n.viewContainer.on("click", ".yb-attr", function(t) {
				var e = r(this),
					i = String(e.data("uid"));
				n.selectAttr(i) ? (n.solveConflict(i) && r(".yb-attr-has", e.parent()).removeClass("yb-attr-has"), e.addClass("yb-attr-has")) : e.removeClass("yb-attr-has"), n.updateCurrentSelView()
			}), n.viewContainer.find(".yb-close-popup").on("click", function(t) {
				r.closePopup(), n.close()
			}), n.viewContainer.find(".yb-attr-add a").on("click", function(t) {
				n.addselection()
			}), n.viewContainer.on("click", ".yb-selected-group", function(t) {
				t.stopPropagation(), t.preventDefault();
				var e = r(this),
					i = parseInt(e.data("idx"), 10);
				if (0 <= i) {
					var a = n.prevSelections[i];
					if (!a) return;
					var s = r(t.target);
					if (s.hasClass("yb-item-plus")) a.ProductNum = a.ProductNum + 1;
					else if (s.hasClass("yb-item-minus")) {
						if (a.ProductNum <= 1) return n.prevSelections.splice(i, 1), void n.updateSelections();
						a.ProductNum = a.ProductNum - 1
					}
					console.log(a.SellPrice * a.ProductNum), r(".yb-item-qty", e).text(a.ProductNum), r(".yb-product-price span", e).text((a.SellPrice * a.ProductNum).toFixed(2)), n.processSelectionPrice(!0)
				}
			}), n.viewContainer.on("click", ".yb-cart-operate-one", function(t) {
				var e = r(t.target),
					i = n.viewContainer,
					a = parseInt(r(".yb-item-qty-one", i).text(), 10) || 1;
				if (e.hasClass("yb-item-plus-one")) a++;
				else if (e.hasClass("yb-item-minus-one")) {
					if (a <= 1) return;
					a--
				}
				r(".yb-item-qty-one", i).text(a), n.processSelectionPrice(!0)
			}), n.viewContainer.find(".yb-attr-confirm a").on("click", function(t) {
				t.stopPropagation(), t.preventDefault(), n.addSelToCart()
			})
		},
		cartEventHandler: function(t, e, i) {
			switch (console.log("attr"), e) {
			case "reload":
				this.updateAllItems();
				break;
			case "add":
			case "minus":
			case "update":
				this.updateItem(i)
			}
			this.updateSummary(t.summary())
		},
		open: function(t, e) {
			this.callback = e, this.before(), this.viewContainer.popup(), this.on(t)
		},
		initData: function() {
			this.productId = 0, this.productPrice = 0, this.isOutOfStock = !1, this.productId = 0, this.attrMapping = {}, this.selections = [], this.prevSelections = [], this.specifications = "", this.packages = []
		},
		close: function() {
			this.after(), this.callback && this.callback()
		},
		before: function() {
			console.log("attr before"), r.hideLoading(), this.initData(), this.shoppingCart.subscribe(this.cartEventHandler), this.viewContent.html(this.config.loadIndicator), this.shoppingCart.loadOnce()
		},
		on: function(t) {
			var e = this;
			_yb.services.products.loadDetails(t, function(t) {
				t.data && (e.productId = t.data.id, e.productPrice = t.data.sellPrice, e.isOutOfStock = t.data.isOutOfStock, e.specifications = t.data.attribute6, e.createMapping(t.data), e.renderResult(t.data))
			})
		},
		createMapping: function(t) {
			for (var e in t.productattributepackages) {
				var i = t.productattributepackages[e],
					a = t.productattributes[i.id];
				for (var s in a) {
					var n = a[s];
					i.attrs = a, this.packages.push(i), this.attrMapping[n.uid] = {
						attr: n,
						package: i
					}
				}
			}
			var o = this.shoppingCart.findItemsById(this.productId);
			for (var r in o) {
				var c = o[r],
					d = [];
				if (c.CartItemAttributes && 0 < c.CartItemAttributes.length) {
					for (var u in c.CartItemAttributes) {
						var l = c.CartItemAttributes[u];
						d.push(l.txtproductAttributeUid)
					}
					this.prevSelections.push({
						ProductNum: c.ProductNum,
						SellPrice: this.processSelectionPrice(),
						Selections: d
					})
				}
			}
		},
		selectAttr: function(t) {
			if (this.isOutOfStock) return !1;
			if (!this.attrMapping[t]) return !1;
			var e = this.selections.indexOf(t);
			return 0 <= e ? (this.selections.splice(e, 1), !1) : (this.selections.push(t), !0)
		},
		solveConflict: function(t) {
			var e = this.attrMapping[t];
			if (!e) return !1;
			var i = e.package.packageType;
			if (1 == i || 3 == i) return !1;
			var a = !1;
			for (var s in e.package.attrs) {
				var n = e.package.attrs[s].uid;
				if (t !== n && (a = this.removeSelection(n))) break
			}
			return a
		},
		findSelection: function(t) {
			return this.selections.indexOf(t)
		},
		removeSelection: function(t) {
			var e = this.findSelection(t);
			return 0 <= e && (this.selections.splice(e, 1), !0)
		},
		processSelectionPrice: function(t) {
			var e = this.productPrice;
			for (var i in this.selections) {
				var a = this.attrMapping[this.selections[i]].attr,
					s = Number(a.attributeValue);
				0 < s && (e += s)
			}
			var n = e * (parseInt(r(".yb-item-qty-one", this.viewContainer).text(), 10) || 1);
			return t && (r(".yb-product-subTotal span", this.viewContainer).text(_yb.ft_c(n.toFixed(2))), this.productPrice != n ? r(".yb-product-subTotal .del", this.viewContainer).hide() : r(".yb-product-subTotal .del", this.viewContainer).show()), n
		},
		addSelToCart: function() {
			if (0 < this.selections.length) {
				if (!this.confirmSelections()) return
			} else if (0 == this.prevSelections.length && !this.confirmSelections()) return;
			for (var t in this.shoppingCart.removeById(this.productId), this.prevSelections) {
				var e = this.prevSelections[t].Selections,
					i = [];
				for (var a in e) {
					var s = e[a];
					i.push({
						productAttributeUid: s,
						txtproductAttributeUid: s
					})
				}
				this.shoppingCart.add(this.productId, "", this.productPrice, i, !0).ProductNum = this.prevSelections[t].ProductNum
			}
			if (this.confirmSelections()) {
				this.processSelectionPrice(), i = [];
				for (var a in this.selections) {
					s = this.selections[a];
					i.push({
						productAttributeUid: s,
						txtproductAttributeUid: s
					})
				}
				var n = parseInt(r(".yb-item-qty-one", this.viewContainer).text(), 10),
					o = (this.shoppingCart.addWithNum(this.productId, n, "", this.productPrice, i, !0, !1, this.specifications), this);
				r.showLoading("鍔犲叆璐墿杞?"), this.shoppingCart.syncCart(function(t) {
					r.hideLoading(), !1 === t && r.alert("鍔犲叆璐墿杞﹀け璐ワ紒"), o.shoppingCart.notify("reload"), r.closePopup(), o.close()
				})
			}
		},
		confirmSelections: function() {
			var t = !1;
			for (var e in this.packages) {
				var i = this.packages[e];
				if (1 != i.packageType && 2 != i.packageType) {
					var a = !1;
					for (var s in i.attrs) if (0 <= this.findSelection(i.attrs[s].uid)) {
						a = !0;
						break
					}
					if (!a) {
						t = !0, r.alert("璇烽€夋嫨鈥?" + i.packageName + "鈥濋€夐」");
						break
					}
				}
			}
			return !t
		},
		addselection: function() {
			if (this.confirmSelections()) {
				var t = this.processSelectionPrice();
				this.prevSelections.push({
					ProductNum: 1,
					SellPrice: t,
					Selections: this.selections
				}), this.selections = [], r(".yb-attr-has", this.viewContainer).removeClass("yb-attr-has"), r(".yb-product-price span", this.viewContainer).text(this.productPrice), r(".yb-product-price .del", this.viewContainer).show(), this.updateCurrentSelView(), this.updateSelections()
			}
		},
		renderProduct: function(t, e) {
			e.push('<div class="yb-product">'), e.push('<div class="yb-product-inner">'), e.push('<div class="yb-product__hd">'), e.push('<div class="yb-product-photo">'), e.push('<img src="', t.defaultproductimage.imagepath, '" onerror="_yb.errProdImg(this)" alt="" />'), e.push("</div>"), t.isOutOfStock && e.push('<div class="yb-outofstock"></div>'), e.push("</div>"), e.push('<div class="yb-product__bd">'), e.push('<div class="yb-product-title">', t.productDisplayName, "</div>"), e.push("</div>"), e.push('<div class="yb-product__ft">'), e.push('<div class="yb-product-price yb-product-subTotal"><span>', _yb.ft_c(t.sellPrice), "</span>"), t.unitName && e.push('<small  class="yb-product-unit">/', t.unitName, "</small >"), t.productOriginalPrice > t.sellPrice && (e.push(" <del>", _yb.ft_c(t.productOriginalPrice)), t.unitName && e.push('<small  class="yb-product-unit">/', t.unitName, "</small >"), e.push("</del>")), e.push("</div>"), e.push("</div>"), e.push("</div>"), e.push("</div>")
		},
		updateCurrentSelView: function() {
			var t = [];
			this.renderCurrentSel(t), this.processSelectionPrice(!0), r(".yb-current-sels", this.viewContainer).html(t.join(""))
		},
		renderCurrentSel: function(t) {
			var e = this.selections;
			if (e && 0 < e.length) for (var i in e) {
				var a = e[i],
					s = this.attrMapping[a].attr;
				t.push(" ["), t.push(s.attributeName), t.push("]")
			} else t.push("<i>", _yb.t("attr.select"), "</i>")
		},
		updateSelections: function() {
			var t = [];
			this.renderSelections(t), r(".yb-other-sels", this.viewContainer).html(t.join(""))
		},
		renderSelections: function(t) {
			var e = this.prevSelections;
			if (0 != e.length) {
				t.push('<div class="yb-selected-title">宸查€?</div>');
				var i = 0;
				for (var a in e) {
					var s = e[a];
					if (0 != s.ProductNum) {
						if (i++, t.push('<div class="yb-selected-group" data-idx="', a, '">'), t.push('<div class="yb-selected-group__hd">' + i, "銆?", "</div>"), t.push('<div class="yb-selected-group__bd">'), s.Selections && 0 < s.Selections.length) {
							for (var n in t.push('<div class="yb-selected-desc">'), s.Selections) {
								var o = this.attrMapping[s.Selections[n]].attr;
								t.push(" ["), t.push(o.attributeName), t.push("]")
							}
							t.push("</div>")
						} else t.push("<i>娌℃湁閫夐」</i>");
						t.push('<div class="yb-product-price">楼<span>', (s.SellPrice * s.ProductNum).toFixed(2), "</span></div>"), t.push("</div>"), t.push('<div class="yb-selected-group__ft">'), t.push('<div class="yb-cart-operate">'), t.push('<span class="yb-item-minus">&nbsp;</span>'), t.push('<span class="yb-item-qty">', s.ProductNum, "</span>"), t.push('<span class="yb-item-plus">&nbsp;</span>'), t.push("</div>"), t.push("</div>"), t.push("</div>")
					}
				}
			}
		},
		renderAttibutes: function(t, e, i) {
			for (var a in e.push('<div class="yb-attr-packages">'), t.productattributepackages) {
				var s = t.productattributepackages[a];
				for (var n in e.push('<div class="yb-attrs" data-attrtype="', s.packageType, '">'), e.push('<div class="yb-attrs-title">', s.packageName), 1 != s.packageType && 2 != s.packageType && e.push("锛堝繀閫夛級"), e.push("</div>"), t.productattributes[s.id]) {
					var o = t.productattributes[s.id][n],
						r = this.isAttrSelected(o);
					e.push('<div data-uid="', o.uid, '" class="yb-attr', r ? " yb-attr-has" : "", '" >'), e.push(o.attributeName), o.attributeValue && 0 < o.attributeValue && e.push("<i>&yen;", o.attributeValue, "</i>"), e.push("</div>")
				}
				e.push('<div class="clear"></div>'), e.push("</div>")
			}
			e.push("</div>")
		},
		isAttrSelected: function(t) {
			var e = !1,
				i = this.selections;
			if (i && 0 < i.length) for (var a = 0; a < i.length; a++) if (i[a] == t.uid) {
				e = !0;
				break
			}
			return e
		},
		renderResult: function(t) {
			var e = [];
			e.push('<div class="yb-attrs__hd">'), this.renderProduct(t, e), e.push('<div class="yb-current">'), e.push('<div class="yb-current-sels">'), this.renderCurrentSel(e), e.push("</div>"), e.push('<div class="yb-cart-operate-one">'), e.push('<span class="yb-item-minus-one">&nbsp;</span>'), e.push('<span class="yb-item-qty-one">', 1, "</span>"), e.push('<span class="yb-item-plus-one">&nbsp;</span>'), e.push("</div>"), e.push("</div>"), e.push('<div class="yb-attrs__bd">'), e.push('<div class="yb-other-sels">'), e.push("</div>"), e.push("</div>"), e.push('<div class="yb-attrs__ft">'), this.renderAttibutes(t, e), e.push("</div>");
			this.viewContent.html(e.join(""))
		},
		after: function() {
			console.log("attr after"), this.viewContent.empty(), this.shoppingCart.unsubscribe(this.cartEventHandler), this.updateSummary(this.shoppingCart.summary())
		},
		updateSummary: function(t) {
			this.cartQty.text(t.quantity), this.cartAmount.text(_yb.ft_c(t.amount)), 0 == t.quantity ? this.cartContainer.removeClass("yb-cart-has").addClass("yb-cart-empty") : this.cartContainer.removeClass("yb-cart-empty").addClass("yb-cart-has")
		},
		updateItem: function(t) {},
		updateAllItems: function() {}
	}, e = {
		viewContainer: "#attrView",
		cartContainer: ".yb-cart-view",
		cartMiniView: ".yb-cart-mini",
		orderPageUrl: YB_ORDERPAGEURL,
		cartPageUrl: "#/cart",
		descUrl: "/wxapi/product/readdesc/",
		loadIndicator: '<div class="weui-loadmore"><i class="weui-loading"></i> <span class="weui-loadmore__tips">姝ｅ湪鍔犺浇</span></div>'
	}, t._yb.initAttrView = function(t) {
		_yb.views.selectAttr = new i(t)
	}
}($, window), function(d, t) {
	var e, i = function(t) {
			this.initConfig(t)
		};
	i.prototype = {
		initConfig: function(t) {
			var c = this;
			c.config = d.extend({}, e, t), c.shoppingCart = t.shoppingCart, c.eventHandler = c.eventHandler.bind(c), c.viewContainer = d(c.config.viewContainer), c.cartContentView = d(".yb-cart-content", c.viewContainer), c.cartQty = d(".yb-cart-qty", c.cartMiniView), c.cartAmount = d(".yb-cart-money", c.cartMiniView), c.viewContainer.on("click", ".pltbl", function() {
				$this = d(this), $this.next("div").toggle().toggleClass("zoomIn"), d(".scToggle", $this).toggleClass("fold")
			}), c.viewContainer.on("click", ".scDelBtn", function() {
				var t = d(this);
				if ($c = t.parent().parent().parent().parent().parent(), 0 < $c.length) {
					var e = $c.attr("p_uid");
					c.shoppingCart.update(e, 0)
				}
			}), c.viewContainer.on("click", ".edit-taste", function() {
				var t = d(this).data("pid");
				c.shoppingCart.chooseData(d(this).data("ps")), location.href = " #/packages/" + t + "/edit"
			}), c.viewContainer.on("click", ".yb-cart-operate", function(t) {
				t.stopPropagation(), t.preventDefault();
				var e = d(this),
					i = e.data("uid"),
					a = e.data("cid"),
					s = e.data("idx"),
					n = e.data("buybase");
				e.data("minbuy");
				if (i) {
					e.attr("price");
					(o = d(t.target)).hasClass("yb-item-plus") ? n ? c.shoppingCart.addByCartIdxWithNum(s, n, !0, function() {
						c.shoppingCart.notify("reload")
					}) : c.shoppingCart.addByCartIdx(s, !0, function() {
						c.shoppingCart.notify("reload")
					}) : o.hasClass("yb-item-minus") && (n ? c.shoppingCart.minusByCartIdxWithNum(s, n, !0, function() {
						c.shoppingCart.notify("reload")
					}) : c.shoppingCart.minusByCartIdx(s, !0, function() {
						c.shoppingCart.notify("reload")
					}))
				} else if (a) {
					var o;
					(o = d(t.target)).hasClass("yb-item-plus") ? c.shoppingCart.addCombosByCartIdx(s, !0, function() {
						c.shoppingCart.notify("reload")
					}) : o.hasClass("yb-item-minus") && c.shoppingCart.minusCombosByCartIdx(s, !0, function() {
						c.shoppingCart.notify("reload")
					})
				}
			}), c.viewContainer.on("change", ".yb-item-qty", function(t, e) {
				var i = d(this),
					a = parseFloat(i.val(), 10);
				if (0 <= a) {
					var s = i.parent(".yb-cart-operate"),
						n = (e = s.data("uid"), s.data("cid")),
						o = s.data("idx"),
						r = s.data("buybase");
					s.data("minbuy");
					if (e) {
						if (r && a % r != 0) return void d.alert("璇疯緭鍏ュ€嶆暟涓哄熀鏁? " + r + " 鐨勬暟鍊硷紒");
						c.shoppingCart.updateByCartIdx(o, a)
					} else n && c.shoppingCart.updateCombosByCartIdx(o, a)
				}
			}), c.viewContainer.on("click", ".yb-cart-order", function() {
				var t = c.shoppingCart.find();
				return !_yb.services.store.handleBizClosed() && (0 == t.length ? (d.alert("褰撳墠璐墿杞︿负绌猴紒"), !1) : void c.shoppingCart.gotoOrderPage())
			}), d(".yb-cart-clear", c.viewContainer).on("click", function(t) {
				return t.stopPropagation(), t.preventDefault(), d.confirm(_yb.t("cart.clearConfirmText"), _yb.t("cart.clearConfirmTitle"), function() {
					d.showLoading(_yb.t("cart.clearProcessing")), c.shoppingCart.clear(function() {
						d.hideLoading()
					})
				}, function() {}), !1
			})
		},
		eventHandler: function(t, e, i, a) {
			switch (e) {
			case "reload":
				this.createAllItems();
				break;
			case "add":
			case "minus":
			case "update":
				this.updateItem(i, a)
			}
			this.updateSummary(t.summary())
		},
		refresh: function() {
			this.cartContentView.html(this.config.loadIndicator), this.shoppingCart.load()
		},
		once: function() {
			console.log("cart once")
		},
		before: function(t) {
			console.log("cart before"), this.shoppingCart.subscribe(this.eventHandler)
		},
		on: function(t) {
			console.log("cart on"), this.refresh(), _yb.wxSharing(null)
		},
		after: function(t) {
			console.log("cart after"), this.shoppingCart.unsubscribe(this.eventHandler)
		},
		createItem: function(t, e, i) {
			var a = [];
			if (1 == i) {
				console.log("comboInfo", []), a.push('<div class="weui-cell" p_idx="', t, '">'), a.push('<div class="weui-cell__hd"><img class="yb-cart-image" src="'), a.push(e[0].PackageImg), a.push('" onerror="_yb.errProdImg(this)" alt="" /></div>'), a.push('<div class="weui-cell__bd">'), a.push("<p>" + e[0].PackageName + "</p>"), a.push('<div class="yb-product-price">');
				var s = e[0].PackagePrice;
				for (var n in a.push(_yb.ft_c(s)), a.push("</div>"), e) {
					if (a.push('<div class="yb-attr-names">' + e[n].ProductName), e[n].CartItemAttributes && 0 < e[n].CartItemAttributes.length) {
						for (var o in a.push("("), e[n].CartItemAttributes) {
							var r = e[n].CartItemAttributes[o];
							a.push('<span class="yb-attr-cart-name">' + r.attributeName + "</span>")
						}
						a.push(")")
					}
					a.push("*" + e[n].PackageUnitNum + "</div>")
				}
				return a.push("</div>"), a.push('<div class="weui-cell__ft">'), a.push('<div class="yb-cart-operate" data-cid=' + e[0].PackageId + " data-idx=" + t + ">"), a.push('<span class="yb-item-minus">&nbsp;</span>'), a.push('<input type="text" class="yb-item-qty" type="tel" pattern="[0-9]*" maxlength="3" value="', e[0].PackageNum, '"/>'), a.push('<span class="yb-item-plus">&nbsp;</span>'), a.push("</div>"), a.push("</div>"), a.push('<span class="edit-taste"data-pid=' + e[0].PackageId + " data-ps=" + e[0].PackageSerial + ">淇敼鍙ｅ懗</span>"), a.push("</div>"), a.join("")
			}
			a.push('<div class="weui-cell" p_idx="', t, '">'), a.push('<div class="weui-cell__hd"><img class="yb-cart-image" src="'), a.push(e.ImageName), a.push('" onerror="_yb.errProdImg(this)" alt="" /></div>'), a.push('<div class="weui-cell__bd">');
			var c = e.MinQuantity ? '<span class="yb-min-quantity"> (璧峰敭閲?' + e.MinQuantity + (e.UnitName ? e.UnitName : "涓?") + ")</span>" : "";
			a.push("<p>", e.ProductName, c, "</p>"), a.push('<div class="yb-product-price">');
			s = this.shoppingCart.totalPrice(e);
			if (a.push(_yb.ft_c(s)), e.UnitName && a.push('<small  class="yb-product-unit">/', e.UnitName, "</small >"), e.SellPrice < e.ProductSellPrice && (a.push("<del>", _yb.ft_c(e.ProductSellPrice)), e.UnitName && a.push('<small  class="yb-product-unit">/', e.UnitName, "</small >"), a.push("</del>")), a.push("</div>"), e.CartItemAttributes && 0 < e.CartItemAttributes.length) {
				for (var d in a.push('<div class="yb-attr-names">'), this.makeManySizesAttrs(e, !1, !1) && this.makeManySizesAttrs(e, !1, a), e.CartItemAttributes) {
					r = e.CartItemAttributes[d];
					a.push(" ["), a.push(r.attributeName), a.push("]")
				}
				a.push("</div>")
			} else this.makeManySizesAttrs(e, !1, !1) && this.makeManySizesAttrs(e, !0, a);
			a.push("</div>"), a.push('<div class="weui-cell__ft">');
			var u = e.BaseQuantity ? 'data-buybase="' + e.BaseQuantity + '"' : "",
				l = e.MinQuantity ? 'data-minbuy="' + e.MinQuantity + '"' : "";
			return a.push('<div class="yb-cart-operate" data-uid="', e.ProductId, '" data-idx="', t, '"', u, l, ">"), a.push('<span class="yb-item-minus">&nbsp;</span>'), a.push('<input type="text" class="yb-item-qty" type="tel" pattern="[0-9]*" maxlength="3" value="', e.ProductNum, '"/>'), a.push('<span class="yb-item-plus">&nbsp;</span>'), a.push("</div>"), a.push("</div>"), a.push("</div>"), a.join("")
		},
		makeManySizesAttrs: function(t, e, i) {
			var a = "";
			if (t.Specifications) a = " [" + t.Specifications + "]";
			else {
				var s = [];
				s.push(t.Attribute1), s.push(t.Attribute2), s.push(t.Attribute3), s.push(t.Attribute4);
				for (var n = 0; n < s.length; n++) {
					var o = s[n];
					void 0 !== o && o && "y" !== o && "n" !== o && (a += " [" + o + "]")
				}
			}
			return "" != a && (void 0 === i || !1 === i || void(!0 === e ? (i.push('<div class="yb-attr-names">'), i.push(a), i.push("</div>")) : i.push(a)))
		},
		createAllItems: function() {
			var t = this.shoppingCart.find();
			if (console.log("createAllItems", t), 0 != t) {
				var e = [];
				e.push('<div class="weui-cells">');
				for (var i = 0; i < t.length; i++) {
					var a = t[i];
					null != a[0].PackageSerial ? 0 < a[0].ProductNum && e.push(this.createItem(i, a, !0)) : 0 < a[0].ProductNum && e.push(this.createItem(i, a[0]))
				}
				e.push("</div>"), d(".yb-footer-cart").attr("style", ""), this.cartContentView.html(e.join(""))
			} else this.showEmpty()
		},
		showEmpty: function() {
			var t = [],
				e = window.DefaultRoute ? "#" + window.DefaultRoute : "#/home";
			window.CartViewReturnPage && (e = window.CartViewReturnPage);
			var i = '<div class="yb-cartNone">                        <div class="yb-cartNone-img" ></div>                        <p class="yb-cartNone-title" >' + _yb.t("cart.cartNoneTitle") + '</p>                        <p class="yb-cartNone-text" >' + _yb.t("cart.cartNoneText") + '</p>                        <a class="yb-cartNone-ago" href="' + e + '">' + _yb.t("cart.cartNoneGo") + "</a>                    </div>";
			t.push(i), d(".yb-footer-cart").attr("style", "display:none;"), this.cartContentView.html(t.join(""))
		},
		updateSummary: function(t) {
			this.cartQty.text(t.quantity), this.cartAmount.text(_yb.ft_c(t.amount)), 0 < t.quantity ? this.viewContainer.removeClass("yb-cart-empty").addClass("yb-cart-has") : (this.viewContainer.removeClass("yb-cart-has").addClass("yb-cart-empty"), this.showEmpty())
		},
		updateItem: function(t, e, i) {
			var a = d("[p_idx='" + e + "']", this.viewContainer);
			t[0] && null != t[0].PackageSerial ? 0 < a.length && (d("input.yb-item-qty", a).val(t[0].PackageNum), 0 < t[0].PackageNum ? a.removeClass("yb-item-empty").addClass("yb-item-has") : (a.hide(), a.removeClass("yb-item-has").addClass("yb-item-empty"))) : 0 < a.length && (d("input.yb-item-qty", a).val(t.ProductNum), 0 < t.ProductNum ? a.removeClass("yb-item-empty").addClass("yb-item-has") : (a.hide(), a.removeClass("yb-item-has").addClass("yb-item-empty")))
		}
	}, e = {
		viewContainer: "#cartView",
		loadIndicator: '<div class="weui-loadmore"><i class="weui-loading"></i> <span class="weui-loadmore__tips">姝ｅ湪鍔犺浇</span></div>',
		orderPageUrl: YB_ORDERPAGEURL
	}, t._yb.initCartView = function(t) {
		return new i(t)
	}
}($, window), function(t, e) {
	var i = function(t, e, i) {
			var a = t.replace("-", "/").replace("-", "/"),
				s = -1 == e.indexOf(".") ? "." + e : e;
			this.className = document.querySelector(s), this.callback = i, this.offTime = !0, this.timeover = !0, this.isMiniSec = !1, this.isShowUi1 = !1;
			var n = new Date(a || 1e3 * (new Date / 1e3 + 1e4));
			this.futureDate = Date.UTC(n.getFullYear(), n.getMonth(), n.getDate(), n.getHours(), n.getMinutes(), n.getSeconds()), this.obj = {
				msec: this.e(".msec", this.className),
				sec: this.e(".sec", this.className),
				mini: this.e(".mini", this.className),
				hour: this.e(".hour", this.className),
				day: this.e(".day", this.className),
				month: this.e(".month", this.className),
				year: this.e(".year", this.className)
			}, this.timeContanter = this.e(".yb-countdown-contant", this.className)
		};
	i.prototype = {
		ui1: function() {
			var t = [];
			this.dv().day && 0 < this.dv().day && t.push('<span class="yb-countdown_n1">', this.dv().day, "</span>澶?"), this.dv().hour && t.push('<span class="yb-countdown_n1">', this.dv().hour, "</span>"), this.dv().mini && t.push(':<span class="yb-countdown_n1">', this.dv().mini, "</span>"), this.dv().sec && t.push(':<span class="yb-countdown_n1">', this.dv().sec, "</span>"), this.dv().msec && this.isMiniSec && t.push('.<span class="yb-countdown_n1">' + this.dv().msec + "</span>"), this.timeContanter.innerHTML = t.join("")
		},
		ui2: function() {
			this.obj.msec && (this.obj.msec.innerHTML = this.dv().msec), this.obj.sec && (this.obj.sec.innerHTML = this.dv().sec), this.obj.mini && (this.obj.mini.innerHTML = this.dv().mini), this.obj.hour && (this.obj.hour.innerHTML = this.dv().hour), this.obj.day && 31 < this.dv().day ? this.obj.day.innerHTML = "30+" : this.obj.day && this.dv().day <= 31 && (this.obj.day.innerHTML = this.dv().day), this.obj.month && 0 < this.dv().month && (this.obj.month.innerHTML = this.dv().month), this.obj.year && 0 < this.dv().year && (this.obj.year.innerHTML = this.dv().year)
		},
		start: function() {
			var e = this,
				i = this.isMiniSec ? 100 : 1e3;
			setTimeout(function t() {
				e.isShowUi1 ? e.ui1() : e.ui2(), e.timeover || e.callback && e.callback(), e.offTime && e.timeover && setTimeout(t, i)
			}, i)
		},
		setMIniSec: function(t) {
			this.isMiniSec = t
		},
		setShowUi: function(t) {
			this.isShowUi1 = t
		},
		end: function() {
			this.offTime = !1
		},
		e: function(t, e) {
			return e.querySelector(t)
		},
		zero: function(t) {
			return 0 < (t = parseInt(t, 10)) ? (t <= 9 && (t = "0" + t), String(t)) : "00"
		},
		dv: function() {
			var t = this.futureDate,
				e = new Date(t),
				i = new Date,
				a = Math.round((e.getTime() - i.getTime()) / 1e3) + 60 * e.getTimezoneOffset();
			if (this.timeover = 0 < a, this.isMiniSec) var s = Math.round((e.getTime() - i.getTime()) / 100) + 600 * e.getTimezoneOffset();
			var n = {
				sec: "00",
				mini: "00",
				hour: "00",
				day: "00",
				month: "00",
				year: "0"
			};
			return 0 < a && (this.isMiniSec && (n.msec = s % 10), n.sec = this.zero(a % 60), n.mini = 0 < Math.floor(a / 60) ? this.zero(Math.floor(a / 60) % 60) : "00", n.hour = 0 < Math.floor(a / 3600) ? this.zero(Math.floor(a / 3600) % 24) : "00", n.day = 0 < Math.floor(a / 86400) ? this.zero(Math.floor(a / 86400) % 30) : "00", n.month = 0 < Math.floor(a / 2629744) ? this.zero(Math.floor(a / 2629744) % 12) : "00", n.year = 0 < Math.floor(a / 31556926) ? Math.floor(a / 31556926) : "0", 0 < n.month && (n.day = Number(n.day) + 30 * n.month)), n
		}
	};
	var a = {
		checkcustomerName: function(t) {
			if ("string" != typeof t) return t;
			var e = t[0],
				i = t.length;
			return "1" == e && 11 == i ? t.slice(0, 3) + "****" + t.slice(7, 11) : t
		},
		getQueryString: function(t) {
			var e = new RegExp("(^|&)" + t + "=([^&]*)(&|$)", "i"),
				i = window.location.search.substr(1).match(e);
			return null != i ? unescape(i[2]) : null
		},
		setUrlQueryString: function(t) {
			var e = [],
				i = "";
			for (var a in t) {
				var s = a + "=" + t[a];
				if (Array.isArray(t[a])) {
					var n = t[a],
						o = [];
					if (Array.isArray(n)) for (var r in n) o.push(n[r].join("+"));
					s = a + "=" + o.join("^")
				}
				e.push(s)
			}
			return i += e.join("&")
		},
		checkTimeOver: function(t) {
			var e = t.replace("-", "/").replace("-", "/");
			return !(0 <= new Date(e) - new Date)
		},
		checkTimeStart: function(t) {
			var e = t.replace("-", "/").replace("-", "/");
			return 0 <= new Date(e) - new Date
		}
	};
	e._yb.groupFn = {
		FnTimeCountDown: i,
		fnGroupComm: a
	}
}($, window), function(a, e) {
	var i, s = function(t, e) {
			this.container = a(t), this.initConfig(e)
		};
	a.t7.registerHelper("ft_c", function(t) {
		return _yb.ft_c(t)
	}), i = (s.prototype = {
		initConfig: function(t) {
			this.config = a.extend({}, i, t), this.tplGroupon = a.t7.compile(this.config.tplGroupon), this.currencySign = _yb.ft_c(0).slice(0, 1), this.loadData()
		},
		loadData: function() {
			var a = this,
				t = a.container,
				e = {},
				i = (t.data("display"), t.data("size")),
				s = t.data("mode");
			e.takeNum = i, e.groupMode = s, a.container.html(a.config.loading), _yb.services.products.loadGroupList(e, function(t) {
				if (a.container.addClass("yb-products-groupon"), t.data && 0 == t.data.length) {
					a.container.html('<div class="yb-searchWarning">                    <img src="//imgw.pospal.cn/we/weidian/img/icons/pageNull@2x.png" class="yb-searchWarning_img">                     <p class="yb-searchWarning_title">寰堟姳姝夛紝鏆傛椂鍥㈣喘娌℃湁鐩稿叧鐨勪骇鍝併€?</p>                    <span class="yb-searchWarning_text">鍙互鍘荤湅鐪嬪叾浠栧晢鍝?</span>                    </div> ')
				} else {
					for (var e = 0; e < t.data.length; e++) {
						var i = t.data[e];
						a.setResultData(i)
					}
					a.container.html(a.tplGroupon(t));
					for (e = 0; e < t.data.length; e++) {
						i = t.data[e];
						a.startCountdown(i)
					}
				}
			})
		},
		setResultData: function(t) {
			t.defaultproductimage && t.defaultproductimage.imagepath && (t.defaultproductimage.imagepath = t.defaultproductimage.imagepath.replace("_200x200", "_640x640")), t.productImageUrl = t.productImageUrl ? t.productImageUrl.replace("_200x200", "_640x640") : t.productImageUrl, t.isSellConfine = 0 < t.maxBuyNumber, t.sellNum = t.maxProductNumber - t.sellProductNumber, t.sellNum = 0 < t.sellNum ? t.sellNum : 1, t.onePrice = String(t.purchasePrice.toFixed(2)).split(".")[0], t.twoPrice = String(t.purchasePrice.toFixed(2)).split(".")[1], t.toText = 0 == t.groupMode ? "鍘诲弬鍥?" : "鍘诲紑鍥?", t.currencySign = this.currencySign, t.isTimeStart = _yb.groupFn.fnGroupComm.checkTimeStart(t.startDatetime), t.toTimeStartText = t.isTimeStart ? "璺濆紑濮嬩粎鍓?" : "璺濈粨鏉熶粎鍓?"
		},
		startCountdown: function(t) {
			t.endDatetime && t.uid && (t.isTimeStart ? t.countdown = new e._yb.groupFn.FnTimeCountDown(t.startDatetime, "p" + t.uid, function() {
				a(".yb-countdown-text", ".p" + t.uid).text("璺濈粨鏉熶粎鍓?"), t.countdown1 = new e._yb.groupFn.FnTimeCountDown(t.endDatetime, "p" + t.uid, function() {
					a(".yb-groupon-foot", ".p" + t.uid).html('<div class="yb-groupon-overText">宸茬粡缁撴潫鍟︼紒</div>'), a(".p" + t.uid).addClass("yb-gorupon-timeisover")
				}), t.countdown1.setShowUi(!0), t.countdown1.start()
			}) : t.countdown = new e._yb.groupFn.FnTimeCountDown(t.endDatetime, "p" + t.uid, function() {
				a(".yb-groupon-foot", ".p" + t.uid).html('<div class="yb-groupon-overText">宸茬粡缁撴潫鍟︼紒</div>'), a(".p" + t.uid).addClass("yb-gorupon-timeisover")
			}), t.countdown.setShowUi(!0), t.countdown.start())
		}
	}).defaults = {
		tplGroupon: '{{#data}}            <div class=" yb-products-groupon p{{uid}}"  p_uid="{{productUid}}">                <div class="yb-product-inner{{#if isOutOfStock}} yb-outOfStock{{/if}}">                    <div class="yb-product__hd">                        <a class="yb-product-photo" href="/m/group#/details/{{uid}}">                            <img src="{{productImageUrl}}" onerror="_yb.errProdImg(this)"/>                            {{#if isOutOfStock}}<div class="yb-outofstock"></div>{{/if}}                        </a>                        <div class="yb-groupon-content">                        <div class="yb-groupon-head">                            <span class="yb-currency">{{currencySign}}</span>                            <span class="yb-product-price">{{onePrice}}</span>                            <span class="yb-decimals">.{{twoPrice}}</span>                        </div>                        <div class="yb-groupon-body">                            <div class="yb-product-sellNum">                            {{ft_c sellPrice}}                            </div>                            <div class="yb-surplus-text">                                鍐嶅敭{{sellNum}}浠舵仮澶? {{ft_c sellPrice}}                            </div>                        </div>                        <div class="yb-groupon-foot">                            <div class="yb-countdown-text">{{toTimeStartText}}</div>                            <div class="yb-countdown-num yb-countdown-contant">                                <span>姝ｅ湪鐢熸垚鏃堕棿..</span>                            </div>                        </div>                    </div>                    </div>                    <div class="yb-product__bd">                        <div class="yb-product-title">{{productName}}</div>                        <div class="yb-product-desc">{{description}}</div>                    </div>                    <div class="yb-product__ft">                        <div class="yb-product-quota">                        {{#if isSellConfine}}姣忎釜浼氬憳闄愯喘 {{maxBuyNumber}} 浠? {{else}}  {{/if}} </div>                        {{#if isOutOfStock}}                            <div class="yb-group-operate" data-uid="{{uid}}"  data-isGroup="true"  data-price="{{sellPrice}}"><span class="yb-groupGo-btn">{{toText}}</span></div>                        {{else}}                            <div class="yb-group-operate" data-uid="{{uid}}"  data-isGroup="true"  data-price="{{sellPrice}}"><a href="/m/group#/details/{{uid}}?isGroup" class="yb-groupGo-btn">{{toText}}</a></div>                        {{/if}}                    </div>                </div>            </div>            {{/data}}',
		loading: '<div class="weui-loadmore">                <i class="weui-loading"></i>            </div>'
	}, a.fn.loadGroupProducts = function(i) {
		return this.each(function() {
			var t = a(this),
				e = t.data("groupproducts");
			if (e) return e;
			t.data("groupproducts", new s(this, i))
		})
	}
}($, window), function(e, t) {
	var i = function(t) {
			this.defaultSettings = {
				ms: !0,
				time_distance: 36e5,
				withDay: !0,
				eleId: "",
				timer: null,
				endCallBack: function() {},
				callback: function() {}
			}, this.config = e.extend(this.defaultSettings, t), this.config.ms || (this.config.time_distance = 1e3 * this.config.time_distance)
		};
	i.prototype = {
		run: function() {
			var t, e, i, a, s, n = this;
			t = this.config.time_distance, this.config.time_distance = this.config.time_distance - 1e3, 0 < t ? (t -= 864e5 * (e = Math.floor(t / 864e5)), t -= 36e5 * (i = Math.floor(t / 36e5)), t -= 6e4 * (a = Math.floor(t / 6e4)), e < 10 && (e = "0" + e), i < 10 && (i = "0" + i), a < 10 && (a = "0" + a), (s = Math.floor(t / 1e3)) < 10 && (s = "0" + s), n.config.callback(e, i, a, s), n.config.timer = setTimeout(function() {
				n.run()
			}, 1e3)) : n.config.endCallBack()
		},
		clear: function() {
			clearTimeout(this.config.timer)
		}
	};
	var a = {
		checkTimeStart: function(t) {
			var e = t.replace("-", "/").replace("-", "/");
			return 0 <= new Date(e) - new Date
		},
		checkTimeOver: function(t) {
			var e = t.replace("-", "/").replace("-", "/");
			return !(0 <= new Date(e) - new Date)
		},
		getTimeDistance: function(t, e, i) {
			var a = /-/g,
				s = new Date(t.replace(a, "/")).getTime(),
				n = new Date(e.replace(a, "/")).getTime(),
				o = null;
			return (o = i ? new Date(i.replace(a, "/")).getTime() : (new Date).getTime()) < s ? s - o : s < o && o < n ? n - o : n < o ? 0 : void 0
		},
		accSub: function(t, e) {
			var i, a, s;
			try {
				i = t.toString().split(".")[1].length
			} catch (t) {
				i = 0
			}
			try {
				a = e.toString().split(".")[1].length
			} catch (t) {
				a = 0
			}
			return ((t * (s = Math.pow(10, Math.max(i, a))) - e * s) / s).toFixed(a <= i ? i : a)
		},
		accAdd: function(t, e) {
			var i, a, s, n;
			try {
				i = t.toString().split(".")[1].length
			} catch (t) {
				i = 0
			}
			try {
				a = e.toString().split(".")[1].length
			} catch (t) {
				a = 0
			}
			if (n = Math.abs(i - a), s = Math.pow(10, Math.max(i, a)), 0 < n) {
				var o = Math.pow(10, n);
				a < i ? (t = Number(t.toString().replace(".", "")), e = Number(e.toString().replace(".", "")) * o) : (t = Number(t.toString().replace(".", "")) * o, e = Number(e.toString().replace(".", "")))
			} else t = Number(t.toString().replace(".", "")), e = Number(e.toString().replace(".", ""));
			return (t + e) / s
		},
		accDiv: function(t, e) {
			var i = 0,
				a = 0;
			try {
				i = t.toString().split(".")[1].length
			} catch (t) {}
			try {
				a = e.toString().split(".")[1].length
			} catch (t) {}
			return Number(t.toString().replace(".", "")) / Number(e.toString().replace(".", "")) * pow(10, a - i)
		},
		GetQueryString: function(t) {
			var e = new RegExp("(^|&)" + t + "=([^&]*)(&|$)"),
				i = window.location.search.substr(1).match(e);
			return null != i ? unescape(i[2]) : null
		}
	};
	t._yb.bargainFn = {
		BargainTimer: i,
		bargainUntil: a
	}
}($, window), function(o, e) {
	var i;
	e.timerList = [];
	var a = function(t, e) {
			this.container = o(t), console.log("bargainProducts", arguments), this.initConfig(e)
		};
	o.t7.registerHelper("ft_c", function(t) {
		return _yb.ft_c(t)
	}), i = (a.prototype = {
		initConfig: function(t) {
			this.config = o.extend({}, i, t), this.tplBargain = o.t7.compile(this.config.tplBargain), this.loadData()
		},
		loadData: function() {
			var s = this,
				t = s.container,
				e = {},
				i = (t.data("display"), t.data("size"));
			e.takeNum = i, s.container.html(s.config.loading), _yb.services.products.loadBargainList(e, function(t) {
				var e = t.result;
				if (e && 0 == e.length) {
					s.container.html('<div class="yb-searchWarning">                    <img src="//imgw.pospal.cn/we/weidian/img/icons/pageNull@2x.png" class="yb-searchWarning_img">                     <p class="yb-searchWarning_title">寰堟姳姝夛紝鏆傛椂鐮嶄环娌℃湁鐩稿叧鐨勪骇鍝併€?</p>                    <span class="yb-searchWarning_text">鍙互鍘荤湅鐪嬪叾浠栧晢鍝?</span>                    </div> ')
				} else {
					for (var i = 0; i < e.length; i++) {
						var a = e[i];
						s.setResultData(a)
					}
					e = e.sort(function(t, e) {
						return e.sort - t.sort
					}), s.container.html(s.tplBargain({
						data: e
					}));
					for (i = 0; i < e.length; i++) {
						a = e[i];
						s.startCountdown(a)
					}
				}
			})
		},
		setResultData: function(t) {
			switch (t.productImage && (t.productImage = t.productImage.replace("_200x200", "_640x640")), t.onePrice = String(t.basePrice.toFixed(2)).split(".")[0], t.twoPrice = String(t.basePrice.toFixed(2)).split(".")[1], t.isTimeStart = _yb.bargainFn.bargainUntil.checkTimeStart(t.startDateTime), t.toTimeStartText = t.isTimeStart ? "璺濇椿鍔ㄥ紑濮?" : "璺濇椿鍔ㄧ粨鏉?", t.time_distance = _yb.bargainFn.bargainUntil.getTimeDistance(t.startDateTime, t.endDateTime), t.YB_CURRENCYSYMBOL = window.YB_CURRENCYSYMBOL, t.statusName) {
			case "宸茬粨鏉?":
				t.sort = 0;
				break;
			case "鏈紑濮?":
				t.sort = 1;
				break;
			case "杩涜涓?":
				t.sort = 2;
				break;
			default:
				t.sort = 0
			}
		},
		startCountdown: function(n) {
			var t = new e._yb.bargainFn.BargainTimer({
				ms: !0,
				time_distance: n.time_distance,
				callback: function(t, e, i, a) {
					var s = [];
					s.push(n.toTimeStartText), s.push('<div class="yb-countdown-num  yb-countdown-contant">'), s.push('<span class="yb-countdown_n1">', t, "</span> 澶?"), s.push('<span class="yb-countdown_n1">', e, "</span> 鏃?"), s.push('<span class="yb-countdown_n1">', i, "</span> 鍒?"), s.push('<span class="yb-countdown_n1">', a, "</span>"), s.push("</div>"), o(".yb-bargainEle_time", ".p" + n.uidTxt).html(s.join(""))
				},
				endCallBack: function() {
					o(".yb-bargainEle_time", ".p" + n.uidTxt).html("娲诲姩宸茬粨鏉?").css({
						background: "#ccc"
					})
				}
			});
			t.run(), e.timerList.push(t)
		}
	}).defaults = {
		tplBargain: '{{#data}}            <div class="yb-bargainEle p{{uidTxt}}"  p_uid="{{productUid}}"">                <div class="yb-bargainEle_img">                    <img src="{{productImage}}" onerror="_yb.errProdImg(this)" alt="">                    <div class="yb-bargainEle_time">                        璺濈娲诲姩缁撴潫                        <div class="yb-countdown-num  yb-countdown-contant">                            <span class="yb-countdown_n1">78</span> 澶?                            <span class="yb-countdown_n1">09</span> 鏃?                            <span class="yb-countdown_n1">40</span> 鍒?                            <span class="yb-countdown_n1">54</span>                        </div>                    </div>                    <a href="/m/bargain#/details/{{uidTxt}}"></a>                </div>                <div class="yb-bargainEle_tit">                    <span class="yb-bargainTit_icon">鐮嶄环</span>                    <span>{{title}}</span>                </div>                <div class="yb-bargainEle_price">                    <div class="yb-bargainEle_sale">搴曚环锛歿{YB_CURRENCYSYMBOL}}<span class="mainPrice">{{onePrice}}</span>.{{twoPrice}}</div>                    <div class="yb-bargainEle_origin">{{ft_c productSellPrice}}</div>                    <div class="yb-bargainEle_num">                        闄愰噺{{totalProductNum}}浠? 闄愯喘{{limitLaunchTimes}}浠?                    </div>                </div>            </div>            {{/data}}',
		loading: '<div class="weui-loadmore">                <i class="weui-loading"></i>            </div>'
	}, o.fn.loadBargainProducts = function(t) {
		return this.each(function() {
			o(this).data("bargainproducts", new a(this, t))
		})
	}
}($, window), function(p, t) {
	var i, e = function(t) {
			this.initConfig(t)
		};
	e.prototype = {
		initConfig: function(t) {
			var e = this;
			e.config = p.extend({}, i, t), e.shoppingCart = t.shoppingCart, e.cartEventHandler = e.cartEventHandler.bind(e), e.viewContainer = p(e.config.viewContainer), e.viewContent = p(".yb-package-container", e.config.viewContainer), e.comboId = 0, e.isPackages = !0, e.comboArr = [], e.oldData = [], e.comboInfo = [], e.isEdit = "add", e.cachePrice = 0, e.comboProducts = {}, e.isEffective = !0
		},
		once: function() {
			var l = this;
			console.log("packagesView once"), l.viewContainer.find(".yb-package-sure a").on("click", function(t) {
				if (l.isEffective && l.isFinish()) {
					var e = "edit" == l.isEdit ? l.editPackageSerial : (new Date).getTime(),
						i = Number(p(".yb-package-money").text().substring(1, p(".yb-package-money").text().length)),
						a = l.comboId,
						s = l.comboInfo.comboName,
						n = l.comboInfo.defaultImagePath;
					if (console.log("PackageName", s), l.comboInfo.PackageSerial = e, l.comboInfo.PackagePrice = i, l.comboInfo.PackageId = a, l.comboInfo.PackageName = s, l.comboInfo.PackageImg = n, void 0 !== l.comboArr) for (var o in l.comboArr) l.comboArr[o].PackageSerial = e, l.comboArr[o].PackagePrice = i, l.comboArr[o].PackageId = a, l.comboArr[o].PackageName = s, l.comboArr[o].PackageImg = n, "edit" != l.isEdit ? l.comboArr[o].PackageNum = 1 : (l.comboArr[o].PackageNum = l.editPagesNum, l.comboArr[o].ProductNum = l.editPagesNum * l.comboArr[o].PackageUnitNum);
					"edit" == l.isEdit ? l.shoppingCart.updateCombos(l.comboArr, e) : (console.log("self.comboArr,.,,", l.comboArr), l.shoppingCart.addCombos(l.comboArr))
				}
			}), l.viewContainer.on("click", ".yb-package-content li", function(t) {
				t.stopPropagation(), t.preventDefault();
				var e = p(this).data("pid"),
					i = p(this).data("psell"),
					a = p(this).data("fixednum"),
					s = p(this).data("cname"),
					n = p(this).parents(".yb-package-item").data("cnum"),
					o = p(this),
					r = p(t.target),
					c = parseInt(p(".yb-item-qty", o).val(), 10) || 0,
					d = 1;
				if ("edit" == l.isEdit && (d = l.editPagesNum), r.hasClass("yb-item-plus")) if (void 0 !== a) {
					var u = l.shoppingCart.combosFind(e);
					console.log("pronum..", u), _yb.services.products.checkAttr(e, function(t) {
						"1" == t ? _yb.views.comboAttr.open(e, s, a, l.comboArr, !1, function() {}, l.comboProducts[e]) : p.alert("鍥哄畾鎼厤涓嶆敮鎸佸鍔?")
					})
				} else 0 < l.canAdd(n, o) ? _yb.services.products.checkAttr(e, function(t) {
					"1" == t ? _yb.views.comboAttr.open(e, s, l.canAdd(n, o), l.comboArr, !0, function() {}, l.comboProducts[e]) : (l.shoppingCart.combosClear(e), l.shoppingCart.combosAdd(e, o.find("p").text(), i, 0, "", c + 1, d))
				}) : p.alert("鈥?" + s + "鈥濈被閫夐」宸茬粡瓒呭嚭鏈€澶ф暟閲?");
				else r.hasClass("yb-item-minus") && (void 0 !== a ? p.alert("鍥哄畾鎼厤涓嶆敮鎸佸鍔?") : _yb.services.products.checkAttr(e, function(t) {
					if ("1" == t) l.shoppingCart.combosMinus(e, 1);
					else {
						if (c < 1) return;
						c--, l.shoppingCart.combosMinus(e, "minus")
					}
				}))
			})
		},
		before: function() {
			console.log("packagesView  before"), this.shoppingCart.subscribe(this.cartEventHandler), this.shoppingCart.combosEmpty()
		},
		on: function(i, t) {
			console.log("packagesView  on pid & edit", i, t);
			var a = this;
			"edit" == t ? (a.isEdit = "edit", _yb.services.products.loadCombo(i, function(t) {
				a.comboInfo = t.data, a.comboProducts = a.changeComboPrducts(t), a.comboId = i, a.renderComResult(a.comboInfo);
				var e = a.shoppingCart.getEditItems();
				console.log("editItems", e), a.editPagesNum = e[0].PackageNum, a.editPackageSerial = e[0].PackageSerial
			})) : _yb.services.products.loadCombo(i, function(t) {
				a.comboInfo = t.data, a.comboId = i, a.comboProducts = a.changeComboPrducts(t), p(".yb-package-money", a.viewContainer).html("锟?" + a.comboInfo.comboPrice), a.renderComResult(a.comboInfo), a.directAdd()
			})
		},
		after: function() {
			console.log("packagesView after"), this.cachePrice = 0, this.isEdit = "add", this.isEffective = !0, p(".yb-package-select", this.viewContainer).text("宸查€夛細"), p.closePopup()
		},
		changeComboPrducts: function(t) {
			for (var e = {}, i = 0; i < t.data.Packages.length; i++) for (var a = t.data.Packages[i], s = 0; s < a.Combos.length; s++) {
				var n = a.Combos[s];
				n.defaultproductimage = {
					imagepath: n.productImagePath
				}, n.name = n.productName, n.sellPrice = n.productSellPrice, n.id = n.productId, e[n.productId] = n
			}
			return e
		},
		cartEventHandler: function(t, e, i, a) {
			switch (e) {
			case "updateCombo":
				this.updateCombo(i, a);
				break;
			case "editCombo":
				this.updateAllItems(i)
			}
		},
		canAdd: function(t, e) {
			e.data("pid");
			for (var i = 0, a = 0; a < e.parent().find("li").length; a++) i += parseInt(e.parent().find("li").eq(a).find(".yb-item-qty").val());
			return t - i
		},
		directAdd: function() {
			var t = this.comboInfo,
				e = 1;
			"edit" == this.isEdit && (e = this.oldData[0].PackageNum);
			for (var i = 0, a = t.Packages.length; i < a; i++) if (void 0 === t.Packages[i].optionQuantity) for (var s = 0, n = t.Packages[i].Combos.length; s < n; s++) {
				var o = t.Packages[i].Combos[s];
				o.productattributepackages && 0 < o.productattributepackages.length && o.productattributes || o.isOutOfStock || this.shoppingCart.combosAdd(o.productId, o.productName, o.productSellPrice, 0, "", o.productQuantity, e)
			}
		},
		updateAllItems: function(t) {
			for (var e = 0; e < t.length; e++) {
				t[e];
				this.updateCombo(t, t[e].ProductId)
			}
			this.updateSelect(t)
		},
		updateCombo: function(t, e) {
			this.comboArr = t, this.oldData = t, console.log("self.olddata....", t), this.updatePrice(t, e)
		},
		updateSelect: function(t) {
			var e = [];
			for (var i in p(".yb-package-select", this.config.viewContainer).html(""), e.push("宸查€夛細"), t) {
				for (var a = 0; a < t[i].PackageUnitNum; a++) e.push('<span class="yb-combos-prname">' + t[i].ProductName + _yb.ft_c(t[i].ProductSellPrice) + "</span>"), e.push("锛?");
				if (e[e.length - 1] = e[e.length - 1].substring(0, e[e.length - 1].lastIndexOf("+")), 0 < t[i].CartItemAttributes.length) {
					for (var s in e.push('<span class="yb-combos-prattr">('), t[i].CartItemAttributes) {
						var n = t[i].CartItemAttributes[s];
						e.push(n.attributeName), 0 != n.attributeValue && e.push("+锟?" + n.attributeValue), e.push("銆?"), e[e.length - 1] = e[e.length - 1].substring(0, e[e.length - 1].lastIndexOf("銆?")), s != t[i].CartItemAttributes.length - 1 && e.push("锛?")
					}
					e.push(")</span>")
				}
				e.push("锛? ")
			}
			e[e.length - 1] = e[e.length - 1].substring(0, e[e.length - 1].lastIndexOf("+")), p(".yb-package-select", this.config.viewContainer).html(e.join(""))
		},
		updatePrice: function(t, e) {
			var i = [];
			for (var a in i.push("锟?"), this.cachePrice = 0, t) this.cachePrice += this.shoppingCart.totalPrice(t[a], !0);
			i.push(this.comboInfo.comboPrice + this.cachePrice), p(".yb-package-money", self.viewContainer).html(i.join(""));
			for (var s = [], n = !0, o = 0; o < t.length; o++) {
				s[(r = t[o]).ProductId] = 0
			}
			p(".yb-package-content li", this.viewContainer).removeClass("on");
			for (a = 0; a < t.length; a++) {
				var r;
				(r = t[a]).ProductId == e && (n = !1);
				var c = p('[data-pid="' + r.ProductId + '"]', this.viewContainer);
				c.removeClass("on"), s[r.ProductId] += r.PackageUnitNum, 0 < s[r.ProductId] ? (c.addClass("on"), c.find("input").val(s[r.ProductId])) : c.removeClass("on")
			}
			if (void 0 !== e && n) {
				var d = p("[data-pid='" + e + "']", this.viewContainer);
				d.find("input").val(0), d.removeClass("on")
			}
		},
		renderComResult: function(t) {
			for (var e = [], i = this, a = 0, s = t.Packages.length; a < s; a++) {
				var n = t.Packages[a],
					o = n.packageName ? n.packageName : a + 1,
					r = n.optionQuantity ? n.optionQuantity : "hasNo";
				if ("hasNo" == r) {
					var c = 0;
					n.Combos.forEach(function(t) {
						c += t.productQuantity
					}), r = c
				}
				e.push('<div class="yb-package-item" data-cname="' + o + '" data-cnum="' + r + ' ">'), void 0 !== t.Packages[a].optionQuantity ? e.push('<div class="yb-package-title">' + o + " <span>(" + n.Combos.length + "閫?" + n.optionQuantity + " 蹇呴€夛級</span></div>") : e.push('<div class="yb-package-title">' + o + " <span>(鍥哄畾鎼厤 蹇呴€夛級</span></div>"), e.push('<ul class="yb-package-content">');
				for (var d = 0, u = n.Combos.length; d < u; d++) {
					var l = n.Combos[d];
					void 0 !== n.optionQuantity ? e.push("<li ") : e.push("<li  data-fixedNum=" + l.productQuantity), l.productattributepackages && i.isNeed(l.productattributepackages) && e.push(" data-isNeed=true"), e.push(" data-pid=" + l.productId + " data-psell=" + l.productSellPrice + " data-cname=" + n.packageName + '><img src="' + l.productImagePath + '"  onerror="_yb.errProdImg(this)" /><p>' + l.productName + '</p><div class="yb-operate-bg"><div class="yb-cart-operate" data-uid="58503802" data-idx="0"><span class="yb-item-minus">&nbsp;</span>'), void 0 !== n.optionQuantity ? e.push('<input type="text" class="yb-item-qty" pattern="[0-9]*" maxlength="3" value="0" disabled>') : l.productattributepackages && 0 < l.productattributepackages.length ? e.push('<input type="text" class="yb-item-qty" pattern="[0-9]*" maxlength="3" value="0" disabled>') : e.push('<input type="text" class="yb-item-qty" pattern="[0-9]*" maxlength="3" value="' + l.productQuantity + '" disabled>'), e.push('<span class="yb-item-plus">&nbsp;</span></div></div>'), 1 == l.isOutOfStock && e.push('<div class="yb-outofstock"></div>'), e.push("</li>")
				}
				e.push("</ul> </div>")
			}
			i.isEffective = t.isEffective, i.isEffective ? i.viewContainer.find(".yb-package-sure a").removeClass("yb-unEffective__on") : i.viewContainer.find(".yb-package-sure a").addClass("yb-unEffective__on"), i.viewContent.html(e.join(""))
		},
		isNeed: function(t) {
			for (var e in t) if (1 != t[e].packageType && 2 != t[e].packageType) return !0;
			return !1
		},
		isFinish: function() {
			for (var t = 0; t < p(".yb-package-item").length; t++) {
				var e = 0,
					i = p(p(".yb-package-item")[t]).data("cname");
				if ("undefined" != p(p(".yb-package-item")[t]).data("cnum")) {
					for (var a = parseInt(p(p(".yb-package-item")[t]).data("cnum")), s = 0; s < p(p(".yb-package-item")[t]).find("li").length; s++) e += parseInt(p(p(".yb-package-item")[t]).find("li").eq(s).find(".yb-item-qty").val());
					if (console.log(e, a), e != a) return console.log(i), p.alert(i + "鍝佺被鐗╁搧閫夋嫨涓嶅叏"), !1
				} else for (s = 0; s < p(p(".yb-package-item")[t]).find("li").length; s++) {
					var n = p(p(".yb-package-item")[t]).find("li").eq(s).data("pid"),
						o = !1;
					for (var r in this.comboArr) this.comboArr[r].ProductId == n && (o = !0);
					if (!o && p(p(".yb-package-item")[t]).find("li").eq(s).data("isneed")) return p.alert(p(p(".yb-package-item")[t]).find("li").eq(s).find("p").text() + "鐨勫繀閫夊彛鍛虫湭閫?"), !1
				}
			}
			return !0
		}
	}, i = {
		viewContainer: "#packagesView"
	}, _yb.initPackagesView = function(t) {
		return new e(t)
	}
}($, window), function(r, t) {
	var e, i = function(t) {
			this.initConfig(t)
		};
	i.prototype = {
		initConfig: function(t) {
			var o = this;
			o.config = r.extend({}, e, t), o.viewContainer = r(o.config.viewContainer), o.viewContent = r(".yb-taste-wrapper", o.config.viewContainer), o.shoppingCart = t.shoppingCart, o.cartEventHandler = o.cartEventHandler.bind(o), o.initData(), o.viewContainer.find(".yb-btn_secondary,.weui-popup__overlay").on("click", function(t) {
				r.closePopup(), o.close(), o.selectId = []
			}), o.viewContainer.on("click", ".yb-taste-item li", function(t) {
				var e = r(this).data("uid"),
					i = o.attrMapping[e].package.packageType,
					a = r(this).parents(".yb-taste-item").data("sort");
				if (1 == i || 3 == i) r(this).hasClass("on") ? (r(this).removeClass("on"), -1 < o.selectId[a].indexOf(e) && o.selectId[a].splice(o.selectId[a].indexOf(e), 1)) : (r(this).addClass("on"), o.selectId[a].push(e));
				else if (r(this).hasClass("on")) r(this).removeClass("on"), -1 < o.selectId[a].indexOf(e) && o.selectId[a].splice(o.selectId[a].indexOf(e), 1);
				else {
					r(this).addClass("on").siblings("li").removeClass("on");
					for (var s = o.attrMapping[e].package.attrs, n = 0; n < s.length; n++) - 1 < o.selectId[a].indexOf(s[n].uid) && o.selectId[a].splice(o.selectId[a].indexOf(s[n].uid), 1);
					o.selectId[a].push(e)
				}
				o.showSelections(o.productInfo)
			}), o.viewContainer.find(".yb-attr-confirm a").on("click", function(t) {
				t.stopPropagation(), t.preventDefault();
				var e = parseInt(r(".yb-item-qty-one", o.viewContainer).text(), 10);
				0 == e ? (o.shoppingCart.combosAdd(o.productInfo.id, o.productInfo.name, o.productInfo.sellPrice, 0, "", e), o.packages = {}, r.closePopup(), o.close()) : o.addToCombos(), this.selectId = {}
			}), o.viewContainer.on("click", ".yb-cart-operate-one", function(t) {
				var e = r(t.target),
					i = parseInt(r(".yb-item-qty-one", o.viewContainer).text(), 10) || 1;
				if (e.hasClass("yb-item-plus-one")) 0 < o.lastNum ? (i++, o.lastNum--, o.appendGroup(i - 1)) : r.alert("宸茬粡瓒呭嚭鏈€澶ф暟閲?");
				else if (e.hasClass("yb-item-minus-one")) {
					if (i <= 1) return;
					i--, o.lastNum++, o.removeGroup(i), o.showSelections(o.productInfo)
				}
				console.log("operate-one-mins. __", o.selectId), r(".yb-item-qty-one", o.viewContainer).text(i)
			})
		},
		initData: function() {
			this.productInfo = [], this.selections = [], this.attrMapping = {}, this.packages = {}, this.selectId = {}, this.combos = [], this.lastNum = 0, this.canOper = !0
		},
		before: function() {
			this.shoppingCart.subscribe(this.cartEventHandler), console.log("shopping before")
		},
		open: function(t, e, i, a, s, n, o) {
			this.callback = n, this.before(), this.viewContainer.popup(), console.log("detailsDat....", o), this.on(t, e, i, a, s, o)
		},
		on: function(t, e, i, a, s, n) {
			console.log("pid , cname ,comboinfo__", t, e, a, n);
			var o = this;
			this.lastNum = o.canAdd(t, i, a), this.canOper = s, this.selectId = {}, o.productInfo = n, o.createMapping(a, i), o.renderResult(o.productInfo, e, i, a)
		},
		close: function() {
			this.after(), this.callback && this.callback()
		},
		after: function() {
			console.log("attr after"), this.initData(), this.viewContent.empty()
		},
		canAdd: function(t, e, i) {
			for (var a in i) if (i[a].ProductId == t) return e;
			return e - 1
		},
		appendGroup: function(t) {
			var e = [];
			e.push(this.renderGroup(t, "2")), this.selectId[t] = [], this.viewContent.append(e.join("")), this.createMappingFn(t)
		},
		removeGroup: function(t) {
			if (t < 1) {
				for (var e in this.selectId) 0 != e ? delete this.selectId[e] : this.selectId[0] = [];
				if (void 0 !== this.packages) for (var e in this.packages) 0 != e ? delete this.packages[e] : this.packages[0] = []
			} else r(".yb-taste-item").last().remove(), delete this.selectId[Object.keys(this.selectId).length - 1], void 0 !== this.packages && delete this.packages[Object.keys(this.packages).length - 1];
			console.log("this.packages2", this.packages)
		},
		cartEventHandler: function(t, e, i) {
			e
		},
		addToCombos: function() {
			var t = {},
				e = 0;
			parseInt(r(".yb-item-qty-one", this.viewContainer).text());
			for (var i in this.selectId) this.selectId[i].length;
			if (!this.confirmSelectId()) {
				for (var i in this.shoppingCart.combosClear(this.productInfo.id), this.selectId) {
					for (var a in t[i] = [], this.selectId[i]) t[i].push({
						productAttributeUid: this.selectId[i][a],
						txtproductAttributeUid: this.selectId[i][a],
						attributeName: this.attrMapping[this.selectId[i][a]].attr.attributeName,
						attributeValue: this.attrMapping[this.selectId[i][a]].attr.attributeValue
					}), e += parseInt(this.attrMapping[this.selectId[i][a]].attr.attributeValue);
					this.shoppingCart.combosAdd(this.productInfo.id, this.productInfo.name, this.productInfo.sellPrice, e, t[i], 1)
				}
				this.packages = {}, r.closePopup(), this.close()
			}
		},
		confirmSelectId: function() {
			var t = !1;
			for (var e in this.packages) {
				for (var i in this.packages[e]) {
					var a = this.packages[e][i];
					if (1 != a.packageType && 2 != a.packageType) {
						var s = !1;
						for (var n in a.attrs) if (0 < this.selectId[e].length && 0 <= this.selectId[e].indexOf(a.attrs[n].uid)) {
							s = !0;
							break
						}
						if (!s) {
							t = !0, r.alert("璇烽€夋嫨鈥?" + a.packageName + "鈥濋€夐」");
							break
						}
					}
				}
				if (t) break
			}
			return t
		},
		showSelections: function(t) {
			var e = this,
				i = [];
			for (var a in i.push('<div class="yb-choose-product">宸查€?:'), e.selectId) if (0 < e.selectId[a].length) {
				for (var s in i.push(t.name + "锟?" + t.sellPrice + "("), e.selectId[a]) i.push(e.attrMapping[e.selectId[a][s]].attr.attributeName + "+");
				i[i.length - 1] = i[i.length - 1].substring(0, i[i.length - 1].lastIndexOf("+")), i.push(");")
			}
			return i.push("</div>"), 4 == i.length && i.splice(2, 1), r(".yb-choose-product", e.config.viewContainer).html(i.join("")), i.join("")
		},
		renderAttr: function(t, e, i) {
			var a = [],
				s = 0;
			if (void 0 !== i && 0 < i.length) {
				for (var n in i) if (i[n].ProductId == t.id) for (var o = 0; o < i[n].PackageUnitNum; o++) a.push(this.renderGroup(s, e)), s++
			} else if (0 == this.canOper) for (n = 0; n < e; n++) a.push(this.renderGroup(n, e));
			else a.push(this.renderGroup(0, e));
			return a.join("")
		},
		renderGroup: function(t, e) {
			var i = [],
				a = this.productInfo;
			for (var s in i.push('<div class="yb-taste-item" data-sort="' + t + '">'), 1 < e && i.push('<div class="yb-taste-title">' + a.name + (parseInt(t) + 1) + "</div>"), a.productattributepackages) {
				var n = a.productattributepackages[s];
				for (var o in i.push('<div class="yb-taste-option" data-attrtype="', n.packageType, '"><div class="yb-option-item"><div class="yb-option-title">', n.packageName), 1 != n.packageType && 2 != n.packageType && i.push("锛堝繀閫夛級"), i.push(":</div>"), i.push('<ul class="yb-option-content" >'), a.productattributes[n.id]) {
					var r = a.productattributes[n.id][o],
						c = this.isAttrSelected(r, t);
					i.push('<li data-uid="', r.uid, '" class="', c ? " on " : "", '" >'), i.push(r.attributeName), r.attributeValue && 0 < r.attributeValue && i.push("<span>+楼", r.attributeValue, "</span>"), i.push("</li>")
				}
				i.push('</ul><div class="clear"></div></div></div>')
			}
			return i.push("</div></div>"), i.join("")
		},
		renderResult: function(t, e, i, a) {
			var s = [],
				n = this.isAddCombos(t.id, a),
				o = 1,
				r = [];
			if (this.selectId[0] = [], r.push("宸查€?:" + t.name + "锟?" + t.sellPrice), void 0 !== n && 0 < n.length) {
				var c = 0,
					d = 0;
				for (var u in n) c += parseInt(n[u].PackageUnitNum);
				for (u = 0; u < c; u++) this.selectId[u] = [];
				for (var u in o = c, r = [], n) for (var l = 0; l < n[u].PackageUnitNum; l++) {
					for (var p in n[u].CartItemAttributes) this.selectId[d].push(n[u].CartItemAttributes[p].txtproductAttributeUid);
					d++
				}
				console.log("i", this.selectId), r = this.showSelections(t, n, i)
			} else if (0 == this.canOper) for (d = 0; d < i; d++) this.selectId[d] = [];
			s.push('<div class="yb-taste-product"><img src="' + t.defaultproductimage.imagepath + '"/><div class="yb-product-container"><div class="yb-cart-operate-one">'), 0 == this.canOper ? s.push('<span class="yb-item-qty-one">' + i + "</span>") : s.push('<span class="yb-item-minus-one">&nbsp;</span><span class="yb-item-qty-one">' + o + '</span><span class="yb-item-plus-one">&nbsp;</span>'), s.push("</div><p>" + e + '</p><div class="yb-choose-product">' + r + "</div></div></div>"), s.push(this.renderAttr(t, i, n)), this.viewContent.html(s.join(""))
		},
		isAddCombos: function(t, e) {
			if (void 0 !== e) {
				for (var i = [], a = 0; a < e.length; a++) {
					var s = e[a];
					s.ProductId == t && i.push(s)
				}
				return i
			}
		},
		isAttrSelected: function(t, e) {
			var i = !1,
				a = this.selectId[e];
			if (a && 0 < a.length) for (var s = 0; s < a.length; s++) if (a[s] == t.uid) {
				i = !0;
				break
			}
			return i
		},
		createMapping: function(t, e) {
			var i = this.productInfo,
				a = this.isAddCombos(i.id, t);
			if (this.attrMapping = [], void 0 !== a && 0 < a.length) for (var s in a) this.createMappingFn(s);
			else if (0 == this.canOper) for (var n = 0; n < e; n++) this.createMappingFn(n);
			else this.createMappingFn(0)
		},
		createMappingFn: function(t) {
			var e = this.productInfo;
			for (var i in this.packages[t] = [], e.productattributepackages) {
				var a = e.productattributepackages[i],
					s = e.productattributes[a.id],
					n = e.productattributepackages[i];
				for (var o in n.attrs = e.productattributes[a.id], this.packages[t].push(n), s) {
					var r = s[o];
					a.attrs = s, this.attrMapping[r.uid] = {
						attr: r,
						package: a
					}
				}
			}
		},
		selectAttr: function(t) {
			return !this.productInfo.isOutOfStock && ( !! this.attrMapping[t] && void 0)
		},
		solveConflict: function(t) {}
	}, e = {
		viewContainer: "#tasteView"
	}, _yb.initTasteView = function(t) {
		_yb.views.comboAttr = new i(t)
	}
}($, window), function(o, r) {
	var i, e = function(t) {
			this.initConfig(t)
		};
	e.prototype = {
		initConfig: function(t) {
			var e = this;
			e.config = o.extend({}, i, t), e.viewContainer = o(e.config.viewContainer), e.configCart(), e.configSearch(), e.configCategory()
		},
		once: function() {
			console.log("shopping once");
			var n = this;
			r.YB_CONTACTPAGE && (0 < o(".yb-service__bd", n.viewContainer).length && o(".yb-service__bd", n.viewContainer).load(r.YB_CONTACTPAGE, function() {}));
			r.YB_FOOTERPAGE && (0 < o(".yb-footer", n.viewContainer).length && o(".yb-footer", n.viewContainer).load(r.YB_FOOTERPAGE, function() {
				n.shoppingCart.doLoad()
			}));
			r.YB_SHOPPINGPAGE && o(".yb-shopping", n.viewContainer).load(r.YB_SHOPPINGPAGE, function() {
				o(".yb-directAds", n.viewContainer).swiper({
					loop: !0,
					autoplay: 3e3
				}), o(".yb-ads", n.viewContainer).loadAds(), o(".yb-query", n.viewContainer).loadProducts(), o(".yb-groupQuery", n.viewContainer).loadGroupProducts(), o(".yb-bargainQuery", n.viewContainer).loadBargainProducts(), o(".yb-category-lnk", n.viewContainer).click(function() {
					var t = o(this).data("categories"),
						e = o(this).data("display");
					e && (t = e + "_" + t), window.location = "#/category/" + encodeURIComponent(t)
				});
				var t = o(".ybRemindMssage", n.viewContainer),
					e = t.text();
				if (null != e && "string" == typeof e && e.replace(/\s+/g, ""), 0 < t.length && (void 0 !== r.YB_REMINDMESSAGE && "" != r.YB_REMINDMESSAGE || "" != e)) {
					t.addClass("yb-remind-message");
					var i = [];
					i.push('<div class="yb-remind-connet" >'), i.push('<span class="yb-remind-text"><span class="yb-remind-icons"></span> ', e || r.YB_REMINDMESSAGE, "</span>"), i.push("</div>"), t.html(i.join(""));
					var a = o(".yb-remind-connet", t),
						s = o(".yb-remind-text", t);
					n.remindTimer(s, a)
				}
				n.shoppingCart.doLoad(), n.customCouponBind(), 0 < o(".yb-swiper-noPorduct", n.viewContainer).length && o(".yb-swiper-noPorduct", n.viewContainer).swiper({
					loop: !0,
					autoplay: 3e3
				})
			}), n.viewContainer.on("click", ".yb-contact", function(t) {
				console.log("contact"), o(".yb-service", n.viewContainer).show()
			}), n.viewContainer.find(".yb-close-popup").on("click", function(t) {
				t.stopPropagation(), t.preventDefault(), o(".yb-service", n.viewContainer).hide()
			})
		},
		remindTimer: function(t, e) {
			var i = this;
			if (!(t.offset().width <= e.offset().width)) {
				var a = {
					start: 0,
					end: t.offset().width,
					gap: 30,
					coun: function() {
						a.start++, a.start >= a.end ? t.offset({
							left: e.offset().width
						}) : i.isStopTime ? i.isStopTime = !1 : (a.start + 5 > a.end && (a.start = -e.offset().width), t.offset({
							left: -a.start
						}), a.timeout())
					},
					timeout: function() {
						setTimeout(a.coun, a.gap)
					}
				};
				a.coun()
			}
		},
		customCouponBind: function() {
			var t = o("#CustomCoupons", self.viewContainer);
			0 < t.length && t.on("click", ".yb-coupon-button", function(t) {
				var e = o(this),
					i = e.data("cid"),
					a = e.parent(".yb-coupon-contian");
				a.hasClass("yb-coupon-null") || _yb.services.products.getFreeCoupons(i, function(t) {
					t.successed ? (a.addClass("yb-coupon-null"), o.alert("棰嗗彇浼樻儬鍒告垚鍔?! 鍙互鍦ㄤ釜浜轰腑蹇冩垜鐨勫崱鍒告煡鐪?")) : "璇峰厛鐧诲綍浼氬憳" == t.message ? o.confirm({
						title: "鎻愮ず",
						text: "棰嗗彇浼樻儬鍒搁渶瑕佸厛鐧诲綍浼氬憳",
						onOK: function() {
							window.location.href = "/m/account/signin"
						},
						onCancel: function() {}
					}) : "鎮ㄥ凡棰嗗彇浼樻儬鍒?" == t.message ? (o.alert(t.message), a.addClass("yb-coupon-null")) : o.alert(t.message)
				})
			})
		},
		before: function() {
			console.log("shopping before"), this.shoppingCart.subscribe(this.cartEventHandler), this.shoppingCart.loadOnce()
		},
		on: function(t) {
			_yb.wxSharing(null), console.log("shopping on")
		},
		after: function() {
			console.log("shopping after"), this.shoppingCart.unsubscribe(this.cartEventHandler)
		}
	}, o.extend(e.prototype, _yb.mixins.ShoppingCartFns), o.extend(e.prototype, _yb.mixins.ShoppingSearchFns), o.extend(e.prototype, _yb.mixins.CategoryFns), i = {
		viewContainer: "#homeView",
		cartContainer: ".yb-cart-view",
		cartMiniView: ".yb-cart-mini",
		movesc: ".yb-cart-movesc",
		movescbox: ".yb-cart-movescbox",
		cartPageUrl: "#/cart",
		orderPageUrl: YB_ORDERPAGEURL,
		orderLink: ".yb-order-link",
		loadIndicator: '<div class="weui-loadmore"><i class="weui-loading"></i> <span class="weui-loadmore__tips">姝ｅ湪鍔犺浇</span></div>'
	}, _yb.initShoppingView = function(t) {
		return new e(t)
	}
}($, window);